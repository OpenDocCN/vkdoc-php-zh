# 十二、日期和时间

基于时间和日期的信息在我们的生活中扮演着重要的角色，因此，程序员通常必须在他们的网站中与时态数据争论。一个教程是什么时候出版的？最近是否更新了产品的定价信息？办公助理是什么时候登录会计系统的？公司网站在一天中的哪个时段访问量最大？这些问题以及无数其他与时间相关的问题经常出现，这使得对这些问题的适当考虑对于编程工作的成功至关重要。

本章介绍了 PHP 强大的日期和时间操作能力。在提供了一些关于 Unix 如何处理日期和时间值的初步信息之后，在“Date Fu”一节中，您将学习如何以多种有用的方式处理时间和日期。最后，介绍了改进的日期和时间操作功能。

## Unix 时间戳

将我们世界中经常不协调的方面融入编程环境的严格约束中可能是一件乏味的事情。这类问题在处理日期和时间时尤为突出。例如，假设您的任务是计算两个时间点之间的天数差，但是日期以格式*2010 年 7 月 4 日下午 3:45*和*2011 年 12 月 7 日 18:17* 提供。正如您可能想象的那样，弄清楚如何以编程方式做到这一点将是一件令人生畏的事情。你需要的是一种标准格式，某种关于所有日期和时间如何呈现的协议。优选地，该信息将以某种标准化的数字格式提供，例如 20100704154500 和 20111207181700。在编程领域，以这种方式格式化的日期和时间值通常被称为*时间戳。*

然而，即使这种改善的情况也有其问题。例如，这个提议的解决方案仍然没有解决时区、夏令时或日期格式的文化差异带来的挑战。您需要根据单个时区进行标准化，并设计一种不可知的格式，这种格式可以很容易地转换成任何需要的格式。以秒为单位表示时态值并以协调世界时(UTC)为基础怎么样？事实上，早期的 Unix 开发团队采用了这种策略，使用世界协调时 1970 年 1 月 1 日 00:00:00 作为计算所有日期的基础。这个日期通常被称为 *Unix 纪元* *。*因此，上例中格式不一致的日期实际上分别表示为 1278258300 和 1323281820。

Unix 时间戳表示为一个整数值。整数的实际大小取决于操作系统的版本和 PHP 运行的版本。在 32 位版本的 PHP 中，整数值的范围从-2，147，483，648 到 2，147，483，647。这些值对应于 12/13/1901 20:45:52 和 01/19/2038 03:14:07，这两个值都采用 UTC 格式。对于 64 位系统，整数值的范围从–9，223，372，036，854，775，808 到 9，223，372，036，854，775，807，对应于 01/27/-292277022657 08:29:52 到 12/04/2922277026596 15:30:07 之间的日期这对大多数 PHP 开发人员来说已经足够宽了。

函数`time()`将返回当前日期和时间的时间戳。该函数不接受任何参数。

### 警告

您可能想知道是否可以使用 Unix 纪元之前的日期(世界协调时 1970 年 1 月 1 日 00:00:00)。1970 年之前的日期时间值将由负数表示。

## PHP 的日期和时间库

即使是最简单的 PHP 应用也至少包含一些 PHP 的日期和时间相关函数。无论是验证日期、以某种特定方式格式化时间戳，还是将人类可读的日期值转换为相应的时间戳，这些函数在处理相当复杂的任务时都非常有用。

### 注意

你的公司可能位于俄亥俄州，但公司网站可以托管在任何地方，无论是德克萨斯州、加利福尼亚州，甚至是东京。如果您希望日期和时间的表示和计算基于东部时区，这可能会带来问题，因为默认情况下，PHP 将依赖于操作系统的时区设置。事实上，如果您没有通过配置`date.timezone`指令在`php.ini`文件中正确设置系统的时区，或者没有使用`date_default_timezone_set()`函数设置时区，就会产生不同的错误级别。更多信息参见 PHP 手册。

### 验证日期

虽然大多数读者可能记得在小学时学过“九月三十日”这首诗 <sup>[1](#Fn1)</sup> ，但我们中的许多人不太可能会背诵它，包括在场的人。幸运的是，`checkdate()`函数很好地完成了验证日期的任务，如果提供的日期有效，则返回`TRUE`,否则返回`FALSE`。其原型如下:

```php
Boolean checkdate(int month, int day, int year)

```

让我们考虑几个例子:

```php
echo "April 31, 2017: ".(checkdate(4, 31, 2017) ? 'Valid' : 'Invalid');
// Returns false, because April only has 30 days

echo "February 29, 2016: ".(checkdate(02, 29, 2016) ? 'Valid' : 'Invalid');
// Returns true, because 2016 is a leap year

echo "February 29, 2015: ".(checkdate(02, 29, 2015) ? 'Valid' : 'Invalid');
// Returns false, because 2015 is not a leap year

```

### 格式化日期和时间

`date()`函数返回一个日期和/或时间的字符串表示形式，该表示形式根据预定义格式指定的指令和当前选择的时区进行格式化。其原型如下:

```php
string date(string format [, int timestamp])

```

如果没有提供可选的第二个参数，系统将使用与调用函数的时间相对应的时间戳(当前时间戳)。

表 [12-1](#Tab1) 突出了最有用的格式化参数。(原谅我们放弃 Swatch 互联网时间参数的决定。 <sup>[2](#Fn2)</sup>

表 12-1

`date()`功能的格式参数

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"></colgroup> 
| 

参数

 | 

描述

 | 

例子

 |
| --- | --- | --- |
| `A` | 小写的午前和午后 | 上午或下午 |
| `A` | 大写的午前和午后 | 上午或下午 |
| `D` | 一个月中的某一天，带前导零 | 01 至 31 |
| `D` | 一天的三个字母的文本表示 | 周一至周日 |
| `E` | 时区标识符 | 美国/纽约 |
| `F` | 月份的完整文本表示 | 一月到十二月 |
| `G` | 12 小时格式，不带零 | 1 到 12 岁 |
| `G` | 24 小时格式，不带零 | 0 到 23 |
| `H` | 12 小时格式，带零 | 01 到 12 |
| `H` | 24 小时格式，带零 | 00 到 23 |
| `i` | 分钟，带零 | 01 到 60 |
| `I` | 夏令时 | 0 表示否，1 表示是 |
| `j` | 一个月中的某一天，不带零 | 1 至 31 |
| `l` | 日期的文本表示 | 周一到周日 |
| `L` | 闰年 | 0 表示否，1 表示是 |
| `m` | 月份的数字表示，带零 | 01 到 12 |
| `M` | 月份的三个字母的文本表示 | 一月到十二月 |
| `n` | 月份的数字表示，不带零 | 1 到 12 岁 |
| `O` | 与格林威治标准时间(GMT)的时差 | –0500 |
| `r` | 根据 RFC 2822 格式化的日期 | 2010 年 4 月 19 日 22:37:00-0500 |
| `S` | 秒，带零 | 00 到 59 |
| `S` | 日的序数后缀 | 第一，第二，第三，第四 |
| `t` | 一个月的总天数 | 28 至 31 岁 |
| `T` | 时区 | PST、MST、CST、EST 等。 |
| `U` | 自 Unix 纪元以来的秒数(时间戳) | One billion one hundred and seventy-two million three hundred and forty-seven thousand nine hundred and sixteen |
| `w` | 工作日的数字表示 | 0 表示周日到 6 表示周六 |
| `W` | ISO-8601 年的周数 | 1 到 52 或 1 到 53，取决于一周结束的那一天。更多信息参见 ISO 8601 标准。 |
| `Y` | 年份的四位数表示 | 从 1901 年到 2038 年 |
| `z` | 一年中的某一天 | 0 到 364 |
| `Z` | 时区偏移量(秒) | –43200 至 50400 |

如果传递可选的时间戳，用 Unix 时间戳格式表示，`date()`将返回该日期和时间的相应字符串表示。如果没有提供时间戳，将使用当前的 Unix 时间戳。

尽管多年来经常使用 PHP，许多 PHP 程序员仍然需要访问文档来刷新他们对表 [12-1](#Tab1) 中提供的参数列表的记忆。因此，尽管你不一定能通过简单回顾几个例子来记住如何使用这个函数，但是让我们来看看这些例子，让你更清楚地了解`date()`到底能完成什么。

第一个例子演示了`date()`最常见的用法之一，它只是向浏览器输出一个标准日期:

```php
echo "Today is ".date("F d, Y");
// Today is April  20, 2017

```

下一个示例演示了如何输出工作日:

```php
echo "Today is ".date("l");
// Today is Thursday

```

让我们尝试更详细地呈现当前日期:

```php
$weekday = date("l");
$daynumber = date("jS");
$monthyear = date("F Y");

printf("Today is %s the %s day of %s", $weekday, $daynumber, $monthyear);

```

这将返回以下内容:

```php
Today is Thursday the 20th day of April 2017

```

请记住，输出将根据脚本执行的日期而变化。您可能想将与参数无关的字符串直接插入到`date()`函数中，就像这样:

```php
echo date("Today is l the ds day of F Y");

```

事实上，这在某些情况下确实有效；然而，结果可能是不可预测的。例如，执行上述代码会产生以下结果:

```php
UTC201822am18 5919 Monday 3103UTC 2219 22am18 2018f January 2018

```

注意，标点符号与任何参数都不冲突，所以在必要时可以随意插入。例如，要将日期格式化为 mm-dd-yyyy，请使用以下内容:

```php
echo date("m-d-Y");
// 04-20-2017

```

#### 与时间一起工作

`date()`函数也可以产生与时间相关的值。让我们看几个例子，从简单地输出当前时间开始:

```php
echo "The time is ".date("h:i:s");
// The time is 07:44:53

```

但是现在是早上还是晚上？只需添加`a`参数:

```php
echo "The time is ".date("h:i:sa");
// The time is 07:44:53pm

```

或者您可以通过使用 H 而不是 H 来切换到 24 小时格式:

```php
echo "The time is ".date("H:i:s");
// The time is 19:44:53

```

#### 了解当前时间的更多信息

`gettimeofday()`函数返回一个由当前时间元素组成的关联数组。其原型如下:

```php
mixed gettimeofday([boolean return_float])

```

默认行为是返回由以下四个值组成的关联数组:

*   `dsttime` **:** 使用夏令时算法，因地理位置而异。有 11 个可能的值:`0`(不实施夏令时)`1`(美国)`2`(澳大利亚)`3`(西欧)`4`(中欧)`5`(东欧)`6`(加拿大)`7`(英国和爱尔兰)`8`(罗马尼亚)`9`(土耳其)`10`(澳大利亚 1986 年版本)。

*   `minuteswest` **:** 格林威治以西的分钟数。

*   `sec`**:**Unix 纪元以来的秒数。

*   `usec` **:** 时间分数取代整秒值的微秒数。

在美国东部时间 2018 年 1 月 21 日 15:21:30 从测试服务器执行`gettimeofday()`会产生以下输出:

```php
Array (
  [sec] => 1274728889
  [usec] => 619312
  [minuteswest] => 240
  [dsttime] => 1
)

```

当然，可以将输出分配给一个数组，然后根据需要引用每个元素:

```php
$time = gettimeofday();
$UTCoffset = $time['minuteswest'] / 60;
printf("Server location is %d hours west of UTC.", $UTCoffset);

```

这将返回以下内容:

```php
Server location is 5 hours west of UTC.

```

可选参数`return_float`使`gettimeofday()`以浮点值的形式返回当前时间。

### 将时间戳转换为用户友好的值

`getdate()`函数接受一个时间戳并返回一个由它的组件组成的关联数组。除非提供了 Unix 格式的时间戳，否则返回的组件基于当前日期和时间。其原型如下:

```php
array getdate([int timestamp])

```

总共返回 11 个数组元素，包括:

*   `hours` **:** 小时的数字表示。范围是 0 到 23。

*   `mday` **:** 一个月中某一天的数字表示。范围是 1 到 31。

*   `minutes` **:** 分钟的数值表示。范围是 0 到 59。

*   `mon` **:** 月份的数字表示。范围是 1 到 12。

*   `month` **:** 表示月份的完整文本，例如，七月。

*   `seconds` **:** 秒的数值表示。范围是 0 到 59。

*   `wday` **:** 星期几的数字表示，例如，0 表示星期日。

*   `weekday` **:** 一周中某一天的完整文本表示，例如，星期五。

*   `yday` **:** 一年中某一天的数值偏移量。范围是 0 到 364。

*   `year` **:** 四位数字表示年份，例如 2018。

*   `0` **:** 自 Unix 纪元(时间戳)以来的秒数。

考虑时间戳 1516593843(2018 年 1 月 21 日 20:04:03 PST)。让我们将它传递给`getdate()`并检查数组元素:

```php
Array (
    [seconds] => 3
    [minutes] => 4
    [hours] => 4
    [mday] => 22
    [wday] => 1
    [mon] => 1
    [year] => 2018
    [yday] => 21
    [weekday] => Monday
    [month] => January
    [0] => 1516593843
)

```

### 使用时间戳

PHP 提供了两个处理时间戳的函数:`time()`和`mktime()`。前者用于检索当前时间戳，而后者用于检索对应于特定日期和时间的时间戳。本节将介绍这两种功能。

#### 确定当前时间戳

`time()`函数对于检索当前的 Unix 时间戳非常有用。其原型如下:

```php
int time()

```

以下示例在 2017 年 4 月 20 日 21:19:00 PDT 执行:

```php
echo time();

```

这会产生相应的时间戳:

```php
1516593843

```

使用前面介绍的`date()`函数，这个时间戳可以在以后转换回人类可读的日期:

```php
echo date("F d, Y H:i:s", 1516593843);

```

这将返回以下内容:

```php
January 22, 2018 04:04:03

```

#### 基于特定的日期和时间创建时间戳

`mktime()`函数对于根据给定的日期和时间生成时间戳非常有用。如果没有提供日期和时间，则返回当前日期和时间的时间戳。其原型如下:

```php
int mktime([int hour [, int minute [, int second [, int month
            [, int day [, int year]]]]]])

```

每个可选参数的目的应该是显而易见的，所以我不会一一赘述。例如，如果您想知道 2018 年 1 月 22 日晚上 8:35 的时间戳，您只需输入适当的值:

```php
echo mktime(20,35,00,1,22,2018);

```

这将返回以下内容:

```php
1516653300

```

这对于计算两个时间点之间的差异特别有用(在本章的后面，我将向您展示计算日期差异的另一种解决方案)。例如，今天的午夜(2018 年 1 月 22 日)和 2018 年 4 月 15 日的午夜之间有多少小时？

```php
<?php
$now = mktime();
$taxDeadline = mktime(0,0,0,4,15,2018);

// Difference in seconds
$difference = $taxDeadline - $now;

// Calculate total hours
$hours = round($difference / 60 / 60);

echo "Only ".number_format($hours)." hours until the tax deadline!";

```

这将返回以下内容:

```php
Only 1,988 hours until the tax deadline!

```

## 日期福

本节演示了几个最常请求的与日期相关的任务，其中一些只涉及一个函数，而另一些涉及几个函数的某种组合。

### 显示本地化的日期和时间

在这一章，实际上也是这本书，美国化的时间和货币格式被普遍使用，例如 04-12-10 和$2，600.93。然而，世界上的其他地方使用不同的日期和时间格式、货币，甚至字符集。鉴于互联网的全球影响力，你可能不得不创建一个能够遵守本地化格式的应用。事实上，忽略这一点会造成相当大的混乱。例如，假设您要创建一个网站，预订佛罗里达州奥兰多的一家酒店。这家酒店很受各国公民的欢迎，所以您决定创建几个本地化版本的网站。你应该如何处理大多数国家使用他们自己的货币和日期格式的事实，更不用说不同的语言了？虽然您可以创建一个繁琐的方法来管理这些事情，但它可能容易出错，并且需要一些时间来部署。幸运的是，PHP 提供了一组内置的特性来本地化这种类型的数据。

PHP 不仅可以方便日期、时间、货币等的正确格式化，还可以相应地翻译月份名称。在这一节中，您将了解如何利用这一特性根据您喜欢的任何地点来格式化日期。这样做本质上需要两个函数:`setlocale()`和`strftime()` `.`接下来将介绍这两个函数，并给出几个例子。

#### 设置默认区域设置

`setlocale()`函数通过赋予一个新值来改变 PHP 的本地化默认值。区域设置信息是按进程而不是按线程维护的。如果您在多线程配置中运行，您可能会遇到区域设置的突然更改。如果另一个脚本也在更改区域设置，就会发生这种情况。其原型如下:

```php
string setlocale(integer category, string locale [, string locale...])
string setlocale(integer category, array locale)

```

本地化字符串正式遵循以下结构:

```php
language_COUNTRY.characterset

```

例如，如果您想要使用意大利语本地化，那么区域设置字符串应该设置为`it_IT.utf8`。以色列本地化将被设置为`he_IL.utf8`，英国本地化为`en_GB.utf8`，美国本地化为`en_US.utf8`。当一个给定的地区有几个字符集可用时，`characterset`组件就开始发挥作用了。例如，区域设置字符串`zh_CN.gb18030`用于处理蒙古语、藏语、维吾尔语和彝语字符，而`zh_CN.gb3212`用于简体中文。

您将看到 locale 参数可以作为几个不同的字符串或一个 locale 值数组来传递。但是为什么要传递不止一个地区呢？这一特性是为了应对不同操作系统的地区代码之间的差异。鉴于绝大多数 PHP 驱动的应用都以特定平台为目标，这应该很少成为问题；但是，该功能会在您需要时出现。

最后，如果您在 Windows 上运行 PHP，请记住微软已经设计了自己的本地化字符串集。您可以在 [`https://msdn.microsoft.com/en-us/library/ee825488(v=cs.20).aspx`](https://msdn.microsoft.com/en-us/library/ee825488(v=cs.20).aspx) 检索语言和国家代码列表。

### 小费

在一些基于 Unix 的系统上，您可以通过运行命令`locale -a`来确定支持哪些语言环境。

支持六种不同的本地化类别:

*   `LC_ALL` **:** 这为以下五个类别设置了本地化规则。

*   `LC_COLLATE` **:** 字符串比较。这对于使用-和é等字符的语言非常有用。

*   `LC_CTYPE` **:** 人物分类与转换。例如，设置这个类别允许 PHP 使用`strtolower()`函数正确地转换成相应的大写表示。

*   `LC_MONETARY` **:** 货币表示法。例如，美国人用这种格式表示美元:$ 50.00；欧洲人用这种格式表示欧元:50，00。

*   `LC_NUMERIC` **:** 数值表示。例如，美国人用这种格式表示大数:1，412.00；欧洲人用这种格式表示大数:1.412，00。

*   `LC_TIM` **E** **:** 表示日期和时间。例如，美国人表示日期的方式是月，然后是日，最后是年。2010 年 2 月 12 日，将被表示为 2010 年 2 月 12 日。然而，欧洲人(以及世界其他地方的大部分人)将这个日期表示为 2010 年 2 月 12 日。一旦设置好，您就可以使用`strftime()`函数来产生本地化的格式。

假设您正在处理日期，并希望确保日期的格式符合意大利语言环境:

```php
setlocale(LC_TIME, "it_IT.utf8");
echo strftime("%A, %d %B, %Y");

```

这将返回以下内容:

```php
Venerdì, 21 Aprile, 2017

```

并非所有操作系统都支持区域设置字符串中使用的. utf8 符号。这是 macOS 的情况，你应该用“it_IT”来表示意大利语。您必须确保在操作系统上安装了所有的语言包。

要本地化日期和时间，您需要将`setlocale()`与`strftime()`结合使用，这将在下面介绍。

#### 本地化日期和时间

`strftime()`功能根据`setlocale()`指定的本地化设置格式化日期和时间。其原型如下:

```php
string strftime(string format [, int timestamp])

```

`strftime()`的行为非常类似于`date()`函数，接受决定所请求日期和时间布局的转换参数。但是，这些参数与`date()`使用的参数不同，需要复制所有可用的参数(如表 [12-2](#Tab2) 所示，供您参考)。请记住，所有参数都将根据设置的语言环境产生输出。另请注意，其中一些参数在 Windows 上不受支持。

表 12-2

`strftime()`功能的格式参数

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"></colgroup> 
| 

参数

 | 

描述

 | 

示例或范围

 |
| --- | --- | --- |
| `%a` | 缩写的每周名称 | 老兄，杀了他 |
| `%A` | 完整的工作日名称 | 星期一，星期二 |
| `%b` | 缩写月份名 | 一月，二月 |
| `%B` | 完整的月份名称 | 一月，二月 |
| `%c` | 标准日期和时间 | 04/26/07 21:40:46 |
| `%C` | 世纪号 | Twenty-one |
| `%d` | 一个月中的第几天，带前导零 | 01, 15, 26 |
| `%D` | 相当于`%m` / `%d` / `%y` | 04/26/07 |
| `%e` | 一个月中的第几天，没有前导零 | Twenty-six |
| `%g` | 与`%G`的输出相同，但没有世纪 | 05 |
| `%G` | 数字年，根据`%V`设定的规则运行 | Two thousand and seven |
| `%h` | 与`%b`相同的输出 | 一月，二月 |
| `%H` | 数字小时(24 小时制)，带前导零 | 00 到 23 |
| `%I` | 数字小时(12 小时制)，带前导零 | 01 到 12 |
| `%j` | 一年中的数字日 | 001 到 366 |
| `%l` | 12 小时制，一位数小时前有空格 | 1 到 12 岁 |
| `%m` | 数字月份，带前导零 | 01 到 12 |
| `%M` | 数字分钟，带前导零 | 00 到 59 |
| `%n` | 换行符 | \n |
| `%p` | 午前和午后 | 上午，下午 |
| `%P` | 小写的午前和午后 | 上午，下午 |
| `%r` | 相当于%I:%M:%S %p | 下午 05 时 18 分 21 秒 |
| `%R` | 相当于%H:%M | nineteen past five p.m. |
| `%S` | 数字秒，带前导零 | 00 到 59 |
| `%t` | 制表符 | \t |
| `%T` | 相当于`%H` : `%M` : `%S` | 22:14:54 |
| `%u` | 数字工作日，其中 1 =星期一 | 1 到 7 |
| `%U` | 数字周数，其中一年的第一个星期日是一年的第一周的第一天 | Seventeen |
| `%V` | 数字周数，其中第 1 周=第一周> = 4 天 | 01 到 53 |
| `%W` | 数字周数，其中第一个星期一是第一周的第一天 | 08 |
| `%w` | 数值工作日，其中 0 =星期日 | 0 到 6 |
| `%x` | 基于区域设置的标准日期 | 04/26/07 |
| `%X` | 基于区域设置的标准时间 | 22:07:54 |
| `%y` | 数字年，无世纪 | 05 |
| `%Y` | 数字年，带世纪 | Two thousand and seven |
| `%Z`或`%z` | 时区 | 东部夏令时 |
| `%%` | 百分比字符 | % |

通过将`strftime()`与`setlocale()`结合使用，可以根据用户的当地语言、标准和习俗来格式化日期。例如，向旅游网站用户提供带有日期和票价的本地化路线是很简单的:

```php
Benvenuto abordo, Sr. Sanzi<br />
<?php
   setlocale(LC_ALL, "it_IT.utf8");
   $tickets = 2;
   $departure_time = 1276574400;
   $return_time = 1277179200;
   $cost = 1350.99;
?>
Numero di biglietti: <?= $tickets; ?><br />
Orario di partenza: <?= strftime("%d %B, %Y", $departure_time); ?><br />
Orario di ritorno: <?= strftime("%d %B, %Y", $return_time); ?><br />
Prezzo IVA incluso: <?= money_format('%i', $cost); ?><br />

```

此示例返回以下内容:

```php
Benvenuto abordo, Sr. Sanzi
Numero di biglietti: 2
Orario di partenza: 15 giugno, 2010
Orario di ritorno: 22 giugno, 2010
Prezzo IVA incluso: EUR 1.350,99

```

### 显示网页的最近修改日期

仅仅过了十年，网络已经开始看起来像一个包装工的办公室。文件到处都是，其中许多都是旧的、过时的，而且往往完全不相关。帮助访问者确定文档有效性的常见策略之一是在页面上添加时间戳。当然，手动这样做只会招致错误，因为页面管理员最终会忘记更新时间戳。然而，可以使用`date()`和`getlastmod()` `.`来自动化这个过程。`getlastmod()`函数返回与执行的主脚本的最后修改时间相对应的时间戳，或者在出错的情况下返回`FALSE`。其原型如下:

```php
int getlastmod()

```

如果将它与`date()` `,`结合使用，那么提供关于页面上次修改时间和日期的信息是微不足道的:

```php
$lastmod = date("F d, Y h:i:sa", getlastmod());
echo "Page last modified on $lastmod";

```

这将返回类似于以下内容的输出:

```php
Page last modified on January 22, 2018 04:24:53am

```

`getlastmod()`函数查看处理请求的主脚本的最后修改时间。如果您的内容存储在一个数据库或一个单独的 HTML 文件中，只有当 PHP 文件被修改时，这个函数才会给出更新的日期和时间。您总是可以在数据库中存储一个修改时间，并随内容一起更新它来解决这个问题。

### 确定当月的天数

要确定当月的天数，请使用`date()`函数的`t`参数。考虑以下代码:

```php
printf("There are %d days in %s.", date("t"), date("F"));

```

如果在四月份执行，将会输出以下结果:

`There are 30 days in April.`

### 确定任何给定月份中的天数

有时，您可能想确定某个月而不是本月的天数。单独使用`date()`函数是不行的，因为它需要时间戳，而您可能只有月份和年份。然而，`mktime()`功能可与`date()`结合使用，以产生所需的结果。假设您想确定 2018 年 2 月的天数:

```php
$lastday = mktime(0, 0, 0, 2, 1, 2018);
printf("There are %d days in February 2018.", date("t",$lastday));

```

执行此代码片段会产生以下输出:

```php
There are 28 days in February 2018.

```

### 从当前日期开始计算日期 X 天

确定未来或过去特定天数的精确日期通常很有用。使用`strtotime()`函数和 GNU date 语法，这样的请求是微不足道的。`strtotime()`函数不仅仅支持日期。它可以用来获取绝对或相对日期/时间的文本表示，并返回对应于该确切值的时间戳。假设您想知道 45 天后的日期，基于今天的日期 2018 年 1 月 21 日:

```php
$futuredate = strtotime("+45 days");
echo date("F d, Y", $futuredate);

```

这将返回以下内容:

`March 08, 2018`

通过前置一个负号，您可以确定过去 45 天的日期(今天是 2018 年 1 月 21 日):

```php
$pastdate = strtotime("-45 days");
echo date("F d, Y", $pastdate);

```

这将返回以下内容:

```php
December 08, 2017

```

从今天(2018 年 1 月 21 日)算起 10 周零 2 天呢？

```php
$futuredate = strtotime("10 weeks 2 days");
echo date("F d, Y", $futuredate);

```

这将返回以下内容:

```php
April 04, 2018

```

## 日期和时间类

增强的日期和时间类提供了一个方便的面向对象的界面，还提供了管理不同时区的日期和时间的能力。虽然这个 DateTime 类也提供了一个函数接口，但是本节将重点介绍它的面向对象接口。

### 介绍 DateTime 构造函数

在使用`DateTime class'`特性之前，您需要通过 date 对象的类构造函数实例化它。这个构造函数的原型如下:

```php
object DateTime([string time [, DateTimeZone timezone]])

```

`DateTime()`方法是类构造函数。您可以在实例化时设置日期，也可以稍后使用各种赋值函数(setters)来设置日期。要创建一个空的日期对象(将对象设置为当前日期)，只需像这样调用`DateTime()`:

```php
$date = new DateTime();

```

要创建一个对象并将日期设置为 2018 年 1 月 21 日，请执行以下命令:

```php
$date = new DateTime("21 January 2018");

```

您也可以设置时间，例如设置为晚上 9:55，如下所示:

```php
$date = new DateTime("21 January 2018 21:55");

```

或者你可以这样设定时间:

```php
$date = new DateTime("21:55");

```

事实上，您可以使用本章前面介绍的 PHP 的`strtotime()`函数支持的任何格式。关于支持的格式的其他例子，请参考 PHP 手册。

可选的`timezone`参数是指由 DateTimeZone 类定义的时区。如果此参数被设置为无效值或为空，将会生成 E_NOTICE 级别的错误，如果 PHP 被强制引用系统的时区设置，则可能会生成 E_WARNING 级别的错误。

### 格式化日期

为了格式化输出的日期和时间，或者方便地检索单个组件，可以使用`format()`方法。该方法接受与`date()`函数相同的参数。例如，要使用格式 *2010-05-25 09:55:00pm* 输出日期和时间，您可以这样调用`format()`:

```php
echo $date->format("Y-m-d h:i:sa");

```

### 设置实例化后的日期

一旦 DateTime 对象被实例化，就可以用`setDate()`方法设置它的日期。`setDate()`方法设置日期对象的日期、月份和年份，如果成功则返回`TRUE`，否则返回`FALSE`。其原型如下:

```php
Boolean setDate(integer year, integer month, integer day)

```

我们把日期定在 2018 年 5 月 25 日:

```php
$date = new DateTime();
$date->setDate(2018,5,25);
echo $date->format("F j, Y");

```

这将返回以下内容:

```php
May 25, 2018

```

### 设置实例化后的时间

正如您可以在`DateTime`实例化之后设置日期一样，您也可以使用`setTime()`方法设置时间。`setTime()`方法设置对象的小时、分钟和秒，如果成功则返回`TRUE`，否则返回`FALSE`。其原型如下:

```php
Boolean setTime(integer hour, integer minute [, integer second])

```

让我们把时间定在晚上 8 点 55 分；

```php
$date = new DateTime();
$date->setTime(20,55);
echo $date->format("h:i:s a");

```

这将返回以下内容:

```php
08:55:00 pm

```

### 修改日期和时间

您可以使用`modify()`方法修改`DateTime`对象。此方法接受与构造函数中使用的相同的用户友好语法。例如，假设您创建了一个值为`May 25, 2018 00:33:00`的`DateTime`对象。现在您想将日期向前调整 27 小时，将其更改为`May 26, 2018 3:33:00`:

```php
$date = new DateTime("May 25, 2018 00:33");
$date->modify("+27 hours");
echo $date->format("Y-m-d h:i:s");

```

这将返回以下内容:

```php
2018-05-26 03:33:00

```

### 计算两个日期之间的差异

例如，计算两个日期之间的差异通常是有用的，以便为用户提供一种直观的方式来衡量即将到来的截止日期。考虑一个应用，其中用户支付订阅费来访问在线培训材料。一个用户的订阅即将结束，所以您想给他发一封提醒邮件，大意是“您的订阅将在 5 天后结束！立即续订！”

要创建这样的消息，您需要计算从今天到订阅终止日期之间的天数。您可以使用`diff()`方法来执行任务:

```php
$terminationDate = new DateTime('2018-05-30');
$todaysDate = new DateTime('today');
$span = $terminationDate->diff($todaysDate);
echo "Your subscription ends in {$span->format('%a')} days!";

```

本节中描述的类和方法只涵盖了部分新的日期和时间特性，除了在前面的例子中使用了`diff()`方法。请务必查阅 PHP 文档以获得完整的摘要。

## 摘要

这一章涵盖了相当多的内容，首先概述了在典型的 PHP 编程任务中几乎每天都会出现的几个日期和时间函数。接下来是对古代日期赋艺术的一次旅行，在那里你学会了如何结合这些功能的能力来执行有用的时间任务。在本章的最后，我介绍了 PHP 面向对象的数据操作特性。

下一章关注的主题可能会激起你学习 PHP 的兴趣:用户交互性。我将通过表单进入数据处理，演示基本特性和高级主题，比如如何使用多值表单组件和自动化表单生成。

<aside class="FootnoteSection" epub:type="footnotes">Footnotes [1](#Fn1_source)

三十天有九月、四月、六月和十一月；

所有其他人都有 31 天，只有二月除外，它有 28 天，每个闰年有 29 天。

  [2](#Fn2_source)

您实际上可以使用`date()`来格式化 Swatch 互联网时间。手表制造商斯沃琪( [`www.swatch.com`](http://www.swatch.com) )在网络热潮中创立了“互联网时间”的概念，旨在摒弃陈腐的时区概念，而是根据“斯沃琪节拍”设置时间毫不奇怪，维护斯沃琪互联网时间的通用基准是通过位于斯沃琪公司办公室的子午线建立的。

 </aside>