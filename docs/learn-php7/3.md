# 三、模块化程序设计

Electronic supplementary material The online version of this chapter (doi:[10.​1007/​978-1-4842-1730-6_​3](http://dx.doi.org/10.1007/978-1-4842-1730-6_3)) contains supplementary material, which is available to authorized users.

“是的，我是一个糟糕的程序员，但我可能还是比你强:)”——拉斯马斯·勒德尔夫

## 章节目标/学生学习成果

完成本章后，学生将能够:

*   创建一个没有错误的简单面向对象(OO)的模块化 PHP 程序
*   创建一个 PHP 类并创建该类的一个实例(object)
*   创建一个 OO PHP 封装程序，包括 GET 和 SET 方法
*   创建接受参数并返回信息的 PHP 方法(函数)
*   创建 PHP 公共和私有属性(变量)
*   将现有的 PHP 代码从另一个文件或库中导入到程序中
*   使用三元(条件)运算符验证收到的信息

## PHP 库、扩展、类和对象

PHP 的优势之一是能够轻松地在库中存储代码模块。一旦代码被安装到一个库中，它就可以很容易地在其他程序中重用。对已经在“真实”环境中测试和使用过的代码的重用大大减少了程序错误并提高了生产率，因为您不必重新发明轮子。不需要重新创建已经成功运行的代码。这是浪费时间和精力，并且可能导致不必要的程序错误。程序员实际上可能不知道在一个代码模块(类)中实际存在什么代码。但是，程序员知道什么参数(比如数字)可以传入“黑盒”，从黑盒返回什么(数字的总和)。

您可能会担心程序员盲目地将信息传递到黑盒中，并盲目地接收信息。但是，这是优点，不是缺点。这允许模块的创建者在不影响模块使用方式的情况下更新代码。只要模块接受相同的输入并返回相同的输出，使用该模块的程序员就不会注意到任何变化。可以对模块进行更新，以便更有效、更安全，或者纠正任何程序代码问题，而不会导致用户改变他们在代码中处理模块的方式。

## PHP 扩展

Example 3-1\. Extensions in the php.ini file

`extension=php_bz2.dll`

`extension=php_curl.dll`

`;extension=php_fileinfo.dll`

`extension=php_gd2.dll`

`;extension=php_gettext.dll`

`;extension=php_gmp.dll`

`;extension=php_intl.dll`

`;extension=php_imap.dll`

`;extension=php_interbase.dll`

`;extension=php_ldap.dll`

`extension=php_mbstring.dll`

`;extension=php_exif.dll`

`extension=php_mysql.dll`

`extension=php_mysqli.dll`

`;extension=php_oci8.dll`

> For a complete list and explanation of PHP extensions, please visit: [`http://php.net/manual/en/extensions.alphabetical.php`](http://php.net/manual/en/extensions.alphabetical.php) `.`

PHP 有大量可用的库，有数千行经过良好测试的代码。示例 [3-1](#FPar1) 是`php.ini`文件的部分副本，显示了几个可以在 PHP 中激活的扩展(库)。每个库都是带有 PHP 包装器的 C 代码(为了更好地与 PHP 程序通信)。代码已经编译好了(注意`.dll`扩展)。存在于 PHP 环境中的库可以通过删除`php.ini`文件中扩展语句前面的注释符号(`;`)来激活。一旦保存了 INI 文件，必须重新加载 PHP 和 Apache(关于`php.ini`文件的位置和重新加载 PHP 和 Apache 的例子，参见[第 1 章](1.html))。添加库的简便性是 PHP 如此受欢迎的原因之一。可以使用几种方法将附加的库“安装”到 PHP 中。比较流行的方法之一 Pear (PHP 扩展和应用库)处理第三方库的代码分发和维护。

> The use of Pear and other third-party library installation methods is beyond the scope of this book. However, you can find more information in the links below. [`http://pear.php.net/manual/en/about.pear.php`](http://pear.php.net/manual/en/about.pear.php)

此外，程序员可以通过`require`或`require_once`语句将他们自己的代码库(尚未编译)直接“安装”到应用中。在公司中，包含可以多次重用的代码是一种常见的做法(比如访问数据库)。通过在本地库中提供这种(经过良好测试的)代码，任何更改(比如将数据库移动到另一个服务器)都可以在一个位置(本地库文件)进行处理，而不需要更改多个文件。这也减少了代码冗余并增加了其可靠性。

虽然本地库可以只包含代码的方法(函数)，但更常见的是模块(类)存在于这些库中。这允许程序员用前面提到的“黑盒”概念进行编码。三层架构(在[第二章](2.html)中解释)就是基于这个前提。通过引用包含代码的库，可以从库中访问代码类(通过`require`或`require_once`语句)。一旦进行了引用，就创建了类(对象)的一个实例。一旦创建了实例，程序代码就可以访问该对象的所有功能。

### 类和对象

一个类类似于一个房子的蓝图。蓝图包含建造房屋所需的所有要素的描述(特征)。然而，蓝图并不是实际的房子本身。它描述了如果我们雇佣一个团队来建造房子会发生什么。蓝图被认为是不存在的(就像房子会存在一样)。然而，它描述了建造房屋所需的物品(钉子、干墙和木材)和建造房屋的过程。

类描述了代码模块的特征(属性)以及代码中可能发生的动作(方法或函数)。但是，在创建该类的实例(称为对象)之前，它实际上并不存在(在内存中)。一旦创建了实例，就可以访问特征和方法。类和对象(当正确创建时)保护特征(属性)不被直接访问。这为对象提供了在更改发生之前验证任何更改属性值的请求是否有效的机会。这通常被称为封装。为了保护属性不被外界直接访问，应该使用`private`访问类型来声明它们。`Private`访问将只允许类中的方法能够更改属性中的值。`Set`方法(在本章后面讨论)被用来改变属性。`Get`方法(也将在本章后面讨论)通常用于检索属性值。

## 创建 PHP 类

让我们从创建一个类的基本结构开始。您将创建一个`dog`类，它将允许您设置狗的一些特征(大小、品种、颜色和名字),并且您将为狗提供说话和显示保存在每个属性中的值的能力。您将在一个单独的文件(库)中创建 dog 类，该文件可以在需要时加载到程序(或任何其他程序)中。

要创建一个 PHP 类，可以使用`class`关键字，并将类中的所有代码封装在`{}`中。

Example 3-2\. Basic class structure in the dog.php file

`<?php`

`class Dog`

`{`

`// all code is placed here`

`}`

`?>`

如例 [3-2](#FPar2) 所示，`class`关键字是小写的。但是，类名`Dog`以大写字母开头。PHP 将允许你创建一个首字母小写的类。然而，通常的做法是通过使用大写的第一个字母来容易地识别类。包含您的类的实际文件名(`dog.php`)也应该匹配类名(`Dog`)。

> For more information about classes, methods and properties, please visit PHP.net: [`http://php.net/manual/en/classobj.examples.php`](http://php.net/manual/en/classobj.examples.php) `.` For videos, please visit "New Boston: `https://www.thenewboston.com/videos.php?cat=11&video=17175` `.`

类名不能包含空格。您还应该避免使用特殊字符。然而，`_`是允许的，通常用于连接两个单词(`set_name`)。您可能会注意到，一些类名在实际类名(`__Myclass`)前包含两个下划线(`__`)。然而，由于存在使用这种格式的“神奇的”类(我们将在本章后面讨论其中的两个类),这不是一种推荐的技术。

如前所述，类包含属性。属性也称为变量。属性包括类的特征。创建类的实例时，属性对于该对象是唯一的。操作系统会在内存中保留一个空间来保存这些属性。操作系统为我们处理内存管理，包括清理不再需要的属性。在 PHP 中，每当到达右括号(`}`)时，操作系统的垃圾收集器就会安排删除已经创建的属性。此时，程序将无法再访问该属性。

属性可以保存许多不同类型的数据。在大多数语言中，当创建属性时，还必须包含一个数据类型来描述所存储的数据类型(如 string)。然而，PHP 不需要定义数据类型。第一次将数据放入属性中时，PHP 确定要存储在属性中的数据类型。属性是用一个首字母`$`和属性名创建的。属性名可以包括字母字符、数字和 _。_ 可以用在属性的开头(在`$`之后)或者单词之间。不允许有空格。属性通常用小写字母创建。然而，PHP 允许大写字母。PHP 是区分大小写的，并且会考虑一个小写属性(`speak`)和一个大写属性(`Speak`)两种不同的属性。

Example 3-3\. Basic class structure with properties in dog.php file

`<?php`

`class Dog`

`{`

`private $dog_size = 0;`

`private $dog_breed = "no breed";`

`private $dog_color = "no color";`

`private $dog_name = "no name";`

`}`

`?>`

程序设计建议——在 PHP 中动态创建属性。属性是在第一次使用时创建的。这既是帮助也是痛苦。如果你拼错了一个属性名，PHP 不会产生错误。相反，它将使用拼写错误的名称创建一个新属性。建议(如果可能的话)在程序(或方法，或类)的顶部用初始值创建属性，以便更容易地确定您的属性名是什么以及它是否已被创建。

如例 [3-3](#FPar3) 所示，`Dog`类的每个属性(除了`$dog_size`之外)都被声明为`private`，并且初始设置为一个字符串(文本)。`$dog_size`属性已经被设置为数字零(我们知道它是一个数字而不是一个字符串，因为零周围没有`""`)。操作系统将以 ASCII 格式将字符串值存储在属性`($dog_breed`、`$dog_color`和`$dog_name`中(用 0 和 1 的组合来表示每个字符)，并将数值以数字格式存储在`$dog_size`属性中。当在程序中使用变量时，操作系统创建内存表来查找变量中值的实际内存地址。

Note

代码的格式还必须在代码语句的末尾包含分号(所有执行的代码行都必须包含分号)。

正如您可能注意到的，在这一点上，这个例子并不十分有用。即使要创建类的实例，也不能访问类中的任何内容或显示属性中的值。让我们向类中添加一个方法，让您可以显示类中包含的内容。为此，您需要创建一个使用`print`语句显示值的方法。您还可以借此机会使用字符串连接构建一个单独的输出字符串。

在 PHP 中，字符串连接有几种方式。在许多语言中，构建带有属性的字符串需要不断地打开和关闭一个字符串(使用`""`)。

`print "Dog_weight is " . $this->dog_weight  . ". Dog breed is " . $this->dog_breed . "Dog color is " . $this->dog_color;`

上面的`print`代码行在 PHP 中是有效的。然而，正如你所看到的，你有很多引号和很多句号。很难让一切都匹配正确。句点在 PHP 中是一个字符串连接字符，如果您选择使用这种技术，它将是必需的(在许多语言中，您将不得不使用类似的 madness)。但是，PHP 比这个友好多了。

> This pointer-`$this` pointer is used to access the attributes contained in the object. `this` indicates that the code wants to retrieve the value contained in the attribute existing in a specific object (instance of class). Soon we will create an instance of the class named `$lab`. When the code that will exist in the `$lab` instance is executed, the `$this` pointer will tell the operating system that it only wants the values in the attributes (such as `dog_weight`) that exist in the `$lab` instance. Note that the format of this statement includes a `$` symbol for the `$this` pointer, but does not include a symbol for the variable (`$this->dog_weight`). You may ask, why do we need the T10 pointer? The short answer is that you can create a property (called a static property) for each instance of the class. If the property of this type changes, it will change for all instances of the class. Our private property changes only in the specific instance (`$lab`) of the class that references it.

`print "Dog weight is $this->dog_weight. Dog breed is $this->dog_breed. Dog color is $this->dog_color.";`

PHP 允许在字符串(引号)中放置属性。这允许你使用更少的句号和引号(也许还能减少拔头发的次数)。

> For an example of `$this` pointer, please visit: [`http://php.net/manual/en/language.oop5.basic.php`](http://php.net/manual/en/language.oop5.basic.php) For a video of `$this` pointer, please visit: `https://www.thenewboston.com/videos.php?cat=11&video=17177`

现在您已经有了生成输出所需的代码，您需要在类中添加一个方法来执行`print`行。一个类中发生的所有“动作”都必须包含在一个方法中。方法的创建方式与类类似(除了它们实际上包含在类中)。使用关键字`function`声明方法，后跟方法名和`()`。虽然 PHP 接受大写字符，但是方法名小写是常见的做法。`_`也可以包含在方法名的开头或内部。所有带有方法的代码都包含在`{}`中。

Example 3-4\. Basic class structure with properties and a method in dog.php file

`<?php`

`class Dog`

`{`

`private $dog_weight = 0;`

`private $dog_breed = "no breed";`

`private $dog_color = "no color";`

`private $dog_name = "no name";`

`function display_properties()`

`{`

`print "Dog weight is $this->dog_weight. Dog breed is $this->dog_breed. Dog color is $this->dog_color.";`

`}`

`}`

`?>`

> Program design suggestion-As shown in example [3-4](#FPar5) , it becomes more important to know the correct use of opening brackets and closing brackets ({and}). For every left parenthesis, there must be a right parenthesis. It's hard to know if you missed something. The editor (discussed in the first chapter) can help color-code everything to make it easier to see. In addition, indentation (as shown in example [3-4](#FPar5) ) helps to visually align the brackets. The PHP engine ignores extra spaces (called whitespace). Therefore, programmers can make the code look more comfortable and easier to debug.

这个类现在有能力执行一个动作(通过`display_properties`方法)。这样你就可以最终测试它的功能了。为此，来自示例 [3-4](#FPar5) 的代码必须放在`dog.php`文件(与类名相同)中，与将使用它的程序在同一位置。

我们现在需要创建一个程序来拉进这个库(通过`require_once`语句)。然后程序需要创建一个类的实例(`Dog`)。最后，程序将需要调用方法(`display_properties`)来显示属性的内容。

> Programming suggestion-PHP will allow `include`, `include_once`, `require` and `require_once` statements to be used anywhere in the program code. This may lead to potential problems if it is used in the wrong place or used many times. It is strongly recommended to include these statements as close to the top of the code as possible, so as to facilitate viewing and determine whether the library has been installed. And security-PHP has several ways to introduce libraries into PHP programs. `include` The method will try to pull into a library. However, if the library does not exist, the program will continue to run (or crash). `include` The method does not care about the possibility that the library may have been attached to the code. A large program may accidentally try to pull into the same library several times (this will cause the program to crash due to duplicate methods and/or class names). `include_once` The method eliminates the possibility of multiple attempts to pull into the warehouse. If the library is already included, the statement will not be executed. If the library cannot be found, the `require` method does not allow the program to continue running. However, like the `include` method, it can try to pull into the same library several times. `require_once` method solves these potential problems. If you can't find the library, close the program; if you haven't installed the library, just install the library.

`require_once`语句的格式很简单。关键字`require_once`后面是库名(`dog.php`)。该语句应该包含在代码的顶部附近，并且在创建该类的实际实例之前(`Dog`)。

`require_once("dog.php");`

> You can include the pathname in the `require_once` statement. However, it is recommended that you do not include absolute paths. For more information, please visit: [`http://php.net/manual/en/function.require-once.php`](http://php.net/manual/en/function.require-once.php) For examples, please visit: `https://www.thenewboston.com/videos.php?cat=11&video=17028` For videos, please visit: `https://www.thenewboston.com/videos.php?cat=11&video=17029`.

要创建一个类的实例，需要创建一个“指向”内存中该类实例的属性。包含关键字`new`是为了通知操作系统应该在内存中创建该类的一个实例(并且应该执行构造函数方法，后面会提到)。包含实际的类名是为了确定将哪个类构建到对象中。

`$lab = new Dog;`

这段代码将创建一个`Dog`类的实例，并用`$lab`属性(指针)引用它。为类的每个实例创建每个属性`($dog_size`、`$dog_breed`、`$dog_color`和`$dog_name`的实际副本。这允许您更改该实例的属性(`$lab`)，而不更改其他实例的属性。

`$lab->display_properties();`

一旦创建了实例，就可以通过使用对象名(`$lab`)和方法名(`display_properties`)来访问任何方法。

Example 3-5\. Basic program structure including a library, object, and method call in lab.php

`<?php`

`require_once('dog.php');`

`$lab = new Dog;`

`$lab->display_properties();`

`?>`

图 [3-1](#Fig1) 显示了`lab.php`程序的成功输出，其中包含了`dog.php`文件中的`Dog`类。

> For more examples of creating an object (an instance of a class), please visit: Example: [`http://php.net/manual/en/language.oop5.basic.php`](http://php.net/manual/en/language.oop5.basic.php) Video: `https://www.thenewboston.com/videos.php?cat=11&video=17181.`

![A978-1-4842-1730-6_3_Fig1_HTML.jpg](img/A978-1-4842-1730-6_3_Fig1_HTML.jpg)

图 3-1。

Output of lab.php

### 做它

Add a `speak` method to the `Dog` class to give each instance the ability to “bark”. Hint: Include a `print` (or `echo`) statement in your method. Add a call to your `speak` method after the call to the `display_properties` method in the `lab.php` file.   Create a second object from the `Dog` class in the `lab.php` file called `$chow`. Call the `speak` method (#1) to make him “bark”.   Create a new library file that contains a class of another animal of your choice. Within that class, create four properties that provide characteristics of that animal. Include a method that will print each of these characteristics. Also include a method that will cause the animal to speak. Create another file that will use this library file to create an instance of the class. The program should also call the method to display the properties and the method to cause the animal to speak.  

> Error—If you encounter an error when trying this example, please check the following: Do you name the class (`Dog`) and the file name (`dog.php`) the same name? Make sure that the end of `dog.php` and `lab.php` files is `.php` instead of `.txt`. Is the file name exactly the same as that of `dog.php` in `require_once` statement in `lab.php` file? Are `dog.php` and `lab.php` files in the same folder? Are there the same number of left ({) and right (}) brackets in the two programs? Have you forgotten any semicolons (; )? For each statement of `$thi`, make sure that `$` is a part of `this`, not a part of the attribute (`$this->dog_weight`). For any other errors, copy and paste your errors into the search engine to find possible solutions. Remember, errors may appear in Apache or PHP error logs (see Chapter 1 [](1.html)for details).

## 返回方法

在第 2 章的[中，业务规则层被定义为包含返回请求信息的代码模块，但不提供显示返回数据的接口或格式。在前面的例子中，`Dog`类违反了这个要求。然而，您可以通过对`dog.php`和`lab.php`文件进行一些代码修改来解决这个问题。](2.html)

应该替换`Dog`类中的`print`语句。但是，您希望将多个值(`dog_weight`、`dog_color`、`dog_breed`和`dog_name`)传递回调用它的程序。有许多方法可以完成这项任务。不过，既然你是刚开始编程，那就简单点吧。通过重新格式化原始字符串，我们可以很容易地创建一个逗号分隔的字符串。您可以将`print`语句替换为

`Return "$this->dog_weight, $this->dog_breed, $this->dog_color.";`

新的`Dog`类现在将包含示例 [3-6](#FPar7) 中显示的内容。

Example 3-6\. Basic Dog class with return statement—dog.php

`<?php`

`class Dog`

`{`

`private $dog_weight = 0;`

`private $dog_breed = "no breed";`

`private $dog_color = "no color";`

`private $dog_name = "no name";`

`function get_properties()`

`{`

`return "$this->dog_weight,$this->dog_breed,$this->dog_color.";`

`}`

`}`

`?>`

Note

在 PHP 7 中，可以启用标量类型提示。PHP 7 为开发人员提供了声明预期返回的数据类型的能力。示例 [3-6](#FPar7) 中的函数可以编码如下。

`declare(strict_types=1);`

`function get_properties() : string`

`{`

`return "$this->dog_weight,$this->dog_breed,$this->dog_color.";`

`}`

如果不包含`declare`语句或`strict_types=0`，则不会强制数据类型。当前可以使用的有效数据类型有`string`、`int`、`float`和`bool`。

由于标量类型提示不是向后兼容的，所以在本书的例子中没有使用它们。

您现在需要调整`lab.php`文件，以便能够接受从`get_properties`方法传回的内容(`display_properties`被重命名为`get_properties`，以反映它不再显示属性；它现在返回它们)。您可以通过在`lab.php`文件中创建一个属性来接收从`get_properties`方法传回的内容，从而实现这一点。

`$dog_properties = $lab->get_properties();`

如果您要使用`print`函数在此时显示`$dog_properties`，您将显示:

`no weight, no breed, no color`

然而，我们打算产生一个类似的结果，如前所示。您可以这样做，但是您需要能够根据分隔符“，”将字符串分成三部分。幸运的是，有一些 PHP 方法可以轻松完成这项任务。`explode`方法将根据分隔符断开一个字符串。然后可以使用一个`list`对象将子字符串(字符串片段)放入单独的属性中。根据我们的需要，您可以将`$dog_properties`字符串拆分如下。

`list($dog_weight, $dog_breed, $dog_color) = explode(',', $dog_properties);`

> For more information about the function of `explode`, please visit: [`http://php.net/manual/en/function.explode.php`](http://php.net/manual/en/function.explode.php)

这将使`no weight`变成`$dog_weight`，`no breed`变成`$dog_breed`，`no color`变成`$dog_color`。这三个属性也是在同一行代码中的`lab.php`程序中创建的。我碰巧给他们起了和他们在`Dog`类中的同伴一样的名字。然而，请记住，如果您没有创建`Dog`类，您就不会知道原始的变量名。这没关系，因为你可以叫他们任何你想叫的名字，并完成同样的任务。

现在您已经有了包含信息的变量，您可以在`lab.php`程序中而不是在`dog.php`库中重新创建原始的`print`语句。

`print "Dog weight is $dog_weight. Dog breed is $dog_breed. Dog color is $dog_color.";`

请注意，您没有包括`$this`指针。您没有在类中执行该语句。您不创建`lab.php`程序的实例。程序只有一个实例(因为它不是一个类，不能有多个实例)。所以`$this`指针是不必要的。

新的`lab.php`程序现在看起来像示例 [3-7](#FPar9) 。

Example 3-7\. The lab.php program with print statement

`<?php`

`require_once("dog.php");`

`$lab = new Dog;`

`$dog_properties = $lab->get_properties();`

`list($dog_weight, $dog_breed, $dog_color) = explode(',', $dog_properties);`

`print "Dog weight is $dog_weight. Dog breed is $dog_breed. Dog color is $dog_color.";`

`?>`

假设您的程序中没有错误，输出将与图 [3-1](#Fig1) 相同，与之前版本的程序没有变化。然而，`Dog`类现在满足了业务规则层的一个标准，它将信息返回给调用它的程序，而不试图格式化输出。lab.php 程序现在处理输出的格式化。

### 做它

Adjust the `speak` method in the `dog.php` file to return the `bark` string but not `print` it. Also adjust the call to the method in the `lab.php` file to display the output of the string. You can accept the string from the method and `print` the string in one line of code using syntax similar to the following: `print $lab->speak();`   Adjust the `$chow` object in the `lab.php` file to properly handle the return of the properties string and the `speak` string.   Adjust the `animal` class to return any strings instead of printing them. Adjust the program that makes an instance of the `animal` class to accept and display the strings that are returned.  

## 设置方法

这个例子仍然非常有限，因为您目前不能调整属性中的值来关联您创建的实际对象(比如`$lab`)。为了调整这些属性，您必须能够从使用该对象的程序中访问这些属性(`lab.php`)。但是，出于封装和安全方面的考虑，您不希望公开由调用程序直接操作的属性。面向对象的编程标准要求您将属性创建为“私有的”(正如您已经做的那样)，然后使用类中的实际方法来更改任何值。

> And security-creating a set method in a class provides the class with the ability to verify whether the information placed in the property is valid before the property is updated. If this verification is not performed before changing the attribute value, data corruption may occur. Afterwards, it may be impossible or very difficult to correct the accepted invalid data. `Set` The method can reject invalid data and return an error message to the caller.

一个`set`方法允许值被传递到方法中。然后，在更新对象中的属性之前，可以验证这些值。参数(值)被传递到方法调用中括号`()`之间的方法中。

`$dog_error_message = $lab->set_dog_name('Fred');`

如果`set_dog_name`方法存在于`Dog`类中，并且接受一个代表狗的名字的字符串，那么您可以使用一个类似于前面代码的方法调用。这个调用将把字符串`"Fred"`传递给`set_dog_name`方法。它还为`set`方法提供了向属性`$dog_error_message`返回值的能力，以指示属性是否被正确更新。您可以简单地从该方法返回一个'`TRUE'`或' FALSE '布尔值来指示更新的状态。然后，调用程序可以确定如何处理更新的状态。

如果你简单地传回一个'`TRUE'`或'`FALSE'`,你可以使用 PHP 条件语句的简化版本，称为三元运算符来检查`$dog_error_message`。

`print $dog_error_message == TRUE ? 'Name update successful<br/>' : 'Name update not successful<br/>';`

> For more information about ternary conditional operators, please visit [`http://php.net/manual/en/language.operators.comparison.php`](http://php.net/manual/en/language.operators.comparison.php) Security and Performance-be careful when displaying error messages to actual users of applications. You can provide too much information to expose your program code unnecessarily. It may be safer to display general error messages to users. In real-time applications, log files should be created to record errors and access to the application itself.

使用这种格式，调用程序(`lab.php`)可以很容易地确定更新的状态并显示相应的消息。如果`$dog_error_message`中的字符串为“”)，将显示`?`和`:`(“`Name update successful`”)之间的信息。如果`$dog_error_message`中的值为'`FALSE'`，将显示`:`和`;`之间的字符串(“`Name update not successful`”)。

Example 3-8\. The lab.php file with set methods and error checking

`<?php`

`require_once("dog.php");`

`$lab = new Dog;`

`// -------------------Set Properties--------------------------`

`$dog_error_message = $lab->set_dog_name('Fred');`

`print $dog_error_message == TRUE ? 'Name update successful<br/>' : 'Name update not successful<br/>';`

`$dog_error_message = $lab->set_dog_weight(50);`

`print $dog_error_message == TRUE ? 'Weight update successful<br />' : 'Weight update not successful<br />';`

`$dog_error_message = $lab->set_dog_breed('Lab');`

`print $dog_error_message == TRUE ? 'Breed update successful<br />' : 'Breed update not successful<br />';`

`$dog_error_message = $lab->set_dog_color('Yellow');`

`print $dog_error_message == TRUE ? 'Color update successful<br />' : 'Color update not successful<br />';`

`//-----------------------------Get Properties---------------------------`

`$dog_properties = $lab->get_properties();`

`list($dog_weight, $dog_breed, $dog_color) = explode(',', $dog_properties);`

`print "Dog weight is $dog_weight. Dog breed is $dog_breed. Dog color is $dog_color.";`

`?>`

在示例 [3-8](#FPar10) 中，`lab.php`现在能够将信息传递到`Dog`类的`$lab`对象的属性中。它还确定每个属性的更新是否成功，并做出相应的响应。在这个例子中，您有机会更有效地利用您创建的大量代码。然而，我们将推迟效率，直到你收集了更多的技能。

`lab.php`代码现在为每个要更新的属性(`set_dog_name`、`set_dog_breed`、`set_dog_weight`和`set_dog_color`)调用一个`set`方法，并将信息传递给每个方法。注意，字符串被传递到每个方法中，除了`set_dog_weight`方法，它接受一个整数。

现在您需要在`Dog`类中创建`set`方法。每个方法现在接受一个参数(字符串或整数)并返回一个'`TRUE'`或'`FALSE'`值。该方法的创建风格类似于您之前创建的`get_properties`方法。现在让我们保持验证过程简单，您将在后面的章节中学习如何改进它。

`function set_dog_name($value)`

`{`

`$error_message = TRUE;`

`(ctype_alpha($value) && strlen($value) < 21) ? $this->dog_name = $value : $error_message = FALSE;`

`return $error_message;`

`}`

`set_dog_name`方法将接受一个字符串到函数头(`function set_dog_name($value)`)中定义的`$value`属性(参数)中。接下来，该方法创建属性`$error_message`，并提供初始值`TRUE`。该属性(连同`$value`属性)将只在方法执行时存在。一旦执行碰到了`}`右括号，这些属性将不再可用。

> Programming considerations-`TRUE` and `FALSE` are constants and are part of PHP language. Constants cannot be changed, all of which are capitalized. `TRUE` is actually indicated internally as `1`, while `FALSE` is indicated internally as `0`.

Note

在 PHP 7 中，标量类型提示可以用来强制传递和返回的数据类型。

`declare(strict_types = 1);`

`function set_dog_name(string $value) : string`

`{`

`$error_message = TRUE;`

`(ctype_alpha($value) && strlen($value) < 21) ? $this->dog_name = $value : $error_message = FALSE;`

`return $error_message;`

`}`

如果不包括声明行或`strict_types = 0`，数据类型将不会被强制。为了向后兼容，本教材中的例子不会显示标量类型提示的使用。

> Programming considerations-`&&` is a `AND` operator. In order for (`ctype_alpha($value) && strlen($value) < 21)` statement to become `TRUE`, `$value` must contain only alphabetic characters and be less than 21 characters.

三元运算符查看`$value`属性的两种可能状态(包含传递给方法的任何内容)。

The `ctype` method is used to determine if the characters in `$value` are alphabetic (`ctype_alpha($value)`).   The `strlen` method is used to determine if the length of the string in `$value` is less than 21 characters (`strlen($value) < 21`).  

要了解更多的`ctype`功能，请访问: [`http://php.net/manual/en/book.ctype.php`](http://php.net/manual/en/book.ctype.php) 。

如果`$value`属性只包含字母字符，并且少于 21 个字符，那么`$dog_name`属性将被更新为已传递的值。如果有非字母字符或字符串长度超过 20 个字符，则用`FALSE`值更新`$error_message`(表示更新没有发生)。最后，`$error_message`(或者`TRUE`或者`FALSE`)中的值被返回给调用程序。

> And security-this process may be a bit confusing now. However, it is important to create a secure program. Every time an application or object receives information from an external source, such as another program or user, the information must be verified. This verification should include restrictions on the amount of information accepted, as well as other constraints. Data transmitted through the Internet (for example, from the user's browser to the network server) may be intercepted and changed. Before using information, it is very important to verify it in the application on the server. You can verify in the browser (through JavaScript) to ensure that the user has entered the correct information. However, as mentioned earlier, the packet interceptor can intercept this information and change it before the application on the web server receives it.

在查看代码更改之前，最后一点需要注意。PHP 提供了几个操作来比较两个值。下表总结了这些操作符，包括新的 PHP 7 Spaceship 操作符。

`Operation            Result – returns TRUE if...`

`$a == $b             $a and $b are equal ignoring cases`

`$a === $b            $a and $b equal if case is the same`

`$a != $b, $a <> $b   $a and $b are not equal ignoring cases`

`$a !== $b            $a and $b are not equal or not same case`

`$a < $b              $a is less than $b`

`$a <= $b             $a is less than or equal to $b`

`$a > $b              $a is greater than $b`

`$a >= $b             $a is greater than or equal to $b`

`------------------------------------------------------`

`(Available with PHP 7)  $a <=> $b            returns -1 if $a < b, returns 0   if $a equals $b`

`returns 1 if $a > $b`

此外，Null Coalesce 运算符可用于在三元运算中使用某个值之前检查该值是否“已设置”(包含某些内容)。

`$dog_name = $_POST['value'] ?? 'No Name';`

在这个例子中，如果某个东西存在于`value`中，那么它被放置在`$dog_name`中。如果没有设置`value`，则`No Name`被放置在`$dog_name`。这个操作符在 PHP 7 中是可用的。考虑到向后的能力，本书中的例子不会演示这个操作符。

让我们更新`Dog`类以包含所有需要的`set`方法。

`<?php`

`class Dog`

`{`

`// ------------------------------------ Properties -----------------------------------------`

`private $dog_weight = 0;`

`private $dog_breed = "no breed";`

`private $dog_color = "no color";`

`private $dog_name = "no name";`

`}`

Example 3-9\. Dog class with set methods in dog.php

`// ------------------------------ Set Methods ----------------------------------------------`

`function set_dog_name($value)`

`{`

`$error_message = TRUE;`

`(ctype_alpha($value) && strlen($value) <= 20) ? $this->dog_name = $value : $error_message = FALSE;`

`return $error_message;`

`}`

`function set_dog_weight($value)`

`{`

`$error_message = TRUE;`

`(ctype_digit($value) && ($value > 0 && $value <= 120)) ? $this->dog_weight = $value : $error_message = FALSE;`

`return $error_message;`

`}`

`function set_dog_breed($value)`

`{`

`$error_message = TRUE;`

`(ctype_alpha($value) && strlen($value) <= 35) ? $this->dog_breed = $value : $error_message = FALSE;`

`return $error_message;`

`}`

`function set_dog_color($value)`

`{`

`$error_message = TRUE;`

`(ctype_alpha($value) && strlen($value) <= 15) ? $this->dog_color = $value : $error_message = FALSE;`

`return $error_message;`

`}`

`}`

`function get_properties()`

`{`

`return "$this->dog_weight,$this->dog_breed,$this->dog_color.";`

`}`

`}`

`?>`

> Program design advice-when coding and testing your program, code only one `set` method. Then test the method to correct the error. When you have a successful `set` method, copy and paste it into your code, and make necessary changes. Don't try to code completely before testing the program. Program paragraph by paragraph, and then test. Although you may think this will slow down your coding speed, it is not the case. By catching every small error in the program, you can find them more easily. If you try to write a complete program, you may make many mistakes and spend a lot of time looking for each one. If it is difficult to find the error, comment out (use `//`) the new lines of code in the program, and then retest. If everything is all right, then gradually (only a few lines at a time) delete the comment line (`//`) from the code line and retest. This process should help you find lines of code that may cause problems. And security-in real world, programmers should not show users the details that cause the update to fail. Providing too much information may tell hackers what changes can be made to successfully update attributes containing invalid information. Pass the detailed information of the reason for the update failure to the security log file on the server.

代码开始变得冗长。然而，`set`的每个功能都非常相似。当您编写`set`函数时，您会发现这是一种常见现象。它还允许你通过复制粘贴工作方法并进行简单的修改，快速创建`set`方法。在示例 [3-9](#FPar12) 中，根据更新的信息类型确定不同的字符串长度。另外，`$set_dog_weight`方法检查传递的字符串中的数值，而不是字母字符。除此之外，方法几乎相同。

图 [3-2](#Fig2) 展示了当有效信息被传递到每个属性时的输出。显示“成功”消息。还要注意的是，`get_properties`方法显示了每个属性的新的更新值。在实际环境中，您可以考虑不显示成功的消息，而只显示不成功的消息。

![A978-1-4842-1730-6_3_Fig2_HTML.jpg](img/A978-1-4842-1730-6_3_Fig2_HTML.jpg)

图 3-2。

Output of successful update via set methods in Dog class—dog.php and lab.php

图 [3-3](#Fig3) 测试无效信息传递给`set`方法时产生的输出。请注意，默认值仍然在没有更新的属性中。这强调了包含默认值的需要，以防某些属性没有得到更新。在 PHP 中，显示为`NULL`(没有值)的属性通常会在输出中显示一个空格。例如，如果`$dog_weight`没有默认值，输出将显示`"Dog weight is ."`。

> Programming suggestion-Although PHP is friendly and tries to change null values to spaces when displaying, it is not a good programming method to assume this happens. Many programming languages will not do this conversion for you, and error messages will be displayed when trying to display attributes with a value of `NULL`. In addition, it is very important to set default values when using attributes for mathematical calculation. PHP will try again to convert the value of `NULL` to zero for calculation. However, in some cases, this will not happen and an error message will be displayed. In many programming languages, when trying to calculate with `NULL` value, an error message will appear. Establishing programming habits applicable to all languages will help you develop skills in multiple languages quickly.

![A978-1-4842-1730-6_3_Fig3_HTML.jpg](img/A978-1-4842-1730-6_3_Fig3_HTML.jpg)

图 3-3。

Output with invalid weight (1000) and invalid breed (‘Lab12’) in Dog class—dog.php and lab.php

### 做它

Create an additional property (`$dog_gender`) in the `Dog` class. Create a set method (`set_dog_gender`). Determine if a valid value (Male, Female) has been passed into the `set` method. You can use the following code or develop your own version to check for valid information. `($value == 'Male' || $value == 'Female') ? $this->dog_gender = $value : $error_message = FALSE;`   Go to `php.net` and search for a method that will allow the checking of any case of “Male” or “Female” from #1\. Update the conditional statement to allow any version (Male, MALE, male, Female, FEMALE, female, and so on). Hint: The characters in `$value` can be changed to all uppercase or all lowercase using the `strtoupper` or `strtolower` methods. Then check the string as all uppercase (MALE, FEMALE) or all lowercase (male, female) characters.  

## 获取方法

在我们之前的例子中，您创建了一个同时返回多个属性的`get_properties`方法。这是一个有效且有用的方法。然而，通常有一个`get`方法来匹配每个`set`方法。这为方法中的属性提供了`write` ( `set`方法)和`read` ( `get`方法)能力。在某些情况下，您可能只想提供一个没有 set 方法的`get`方法(使属性为只读)。我们可以(尽管很少这样做)提供一个没有`get`方法的`set`方法(使属性只写)。

`Get`方法实际上比`set`方法更容易编码。不需要验证数据，因为您正在读取数据，而不是更新数据。

`function get_dog_name()`

`{`

`return $this->dog_name;`

`}`

在`get`方法中所需要的就是`return`语句，它返回属性中的值，而对象的用户不需要直接访问该属性。

Example 3-10\. Dog class with set and get methods—dog.php

`<?php`

`class Dog`

`{`

`// ----------------------------------------- Properties ------------------------------------`

`private $dog_weight = 0;`

`private $dog_breed = "no breed";`

`private $dog_color = "no color";`

`private $dog_name = "no name";`

`}`

`// ---------------------------------- Set Methods ------------------------------------------`

`function set_dog_name($value)`

`{`

`$error_message = TRUE;`

`(ctype_alpha($value) && strlen($value) <= 20) ? $this->dog_name = $value : $error_message = FALSE;`

`return $error_message;`

`}`

`function set_dog_weight($value)`

`{`

`$error_message = TRUE;`

`(ctype_digit($value) && ($value > 0 && $value <= 120)) ? $this->dog_weight = $value : $error_message = FALSE;`

`return $error_message;`

`}`

`function set_dog_breed($value)`

`{`

`$error_message = TRUE;`

`(ctype_alpha($value) && strlen($value) <= 35) ? $this->dog_breed = $value : $error_message = FALSE;`

`return $error_message;`

`}`

`function set_dog_color($value)`

`{`

`$error_message = TRUE;`

`(ctype_alpha($value) && strlen($value) <= 15) ? $this->dog_color = $value : $error_message = FALSE;`

`return $error_message;`

`}`

`// ----------------------------------------- Get Methods -----------------------------------`

`function get_dog_name()`

`{`

`return $this->dog_name;`

`}`

`function get_dog_weight()`

`{`

`return $this->dog_weight;`

`}`

`function get_dog_breed()`

`{`

`return $this->dog_breed;`

`}`

`function get_dog_color()`

`{`

`return $this->dog_color;`

`}`

`function get_properties()`

`{`

`return "$this->dog_weight,$this->dog_breed,$this->dog_color.";`

`}`

`}`

`?>`

代码很长。然而，如前所述，像`set`方法一样，`get`方法彼此非常相似。一旦您创建了一个成功的`get`方法，您可以复制并粘贴它来创建其他方法。每个`get`方法需要改变的只是方法的名称和返回的属性。

Example 3-11\. The lab.php program using set and get methods

`<?php`

`require_once("dog.php");`

`$lab = new Dog;`

`// ------------------------------Set Properties--------------------------`

`$dog_error_message = $lab->set_dog_name('Fred');`

`print $dog_error_message == TRUE ? 'Name update successful<br/>' : 'Name update not successful<br/>';`

`$dog_error_message = $lab->set_dog_weight(50);`

`print $dog_error_message == TRUE ? 'Weight update successful<br />' : 'Weight update not successful<br />';`

`$dog_error_message = $lab->set_dog_breed('Lab');`

`print $dog_error_message == TRUE ? 'Breed update successful<br />' : 'Breed update not successful<br />';`

`$dog_error_message = $lab->set_dog_color('Yellow');`

`print $dog_error_message == TRUE ? 'Color update successful<br />' : 'Color update not successful<br />';`

`// ------------------------------Get Properties--------------------------`

`print $lab->get_dog_name() . "<br/>";`

`print $lab->get_dog_weight() . "<br />";`

`print $lab->get_dog_breed() . "<br />";`

`print $lab->get_dog_color() . "<br />";`

`$dog_properties = $lab->get_properties();`

`list($dog_weight, $dog_breed, $dog_color) = explode(',', $dog_properties);`

`print "Dog weight is $dog_weight. Dog breed is $dog_breed. Dog color is $dog_color.";`

`?>`

当查看示例 [3-11](#FPar14) 中的代码时，请注意`print`语句调用了`get`方法(`print $lab->get_dog_name() . "<br/>";`)。操作的顺序，将在后面的章节中详细讨论，导致方法(`get_dog_name()`)首先执行，尽管通常一行代码从左到右执行。该方法返回`dog_name`(字符串`"Fred"`)中的值。该字符串被放置在方法调用所在的相同位置。在`get`方法执行之后，代码行现在是

`print "Fred" . "<br/>";`

然后代码行从左到右执行，产生输出

`Fred <br/>`

> Programming considerations—Unlike attributes, methods cannot be enclosed in quotation marks (""or "). You must use "."to separate and join strings, as shown in the example. If a method is enclosed in quotation marks, PHP will display an error message.

如图 [3-4](#Fig4) 所示，`get`方法成功地在属性中显示了更新后的值。如果没有更新任何属性，`get`方法将显示默认值。

> Programming advice-It is a good idea to display the values in the attributes frequently during the coding and testing stages to ensure that they are updated at the appropriate time. However, when you transfer the program from test mode to production mode, you should reduce the number displayed to users. It may not be necessary to display the updated value in the attribute to the user. Generally, it is best to only indicate the success of the update to the user. Before production, you can simply comment out unnecessary lines of print code. This will help to quickly debug the future upgrade of the application by simply deleting the comments in these lines.

![A978-1-4842-1730-6_3_Fig4_HTML.jpg](img/A978-1-4842-1730-6_3_Fig4_HTML.jpg)

图 3-4。

Dog class output with set and get methods

### 做它

In addition to creating an additional property `($dog_gender`) and `set` method in the `Dog` class, create a `get` method to display the updated values. Also update the `lab.php` file to include a `print` statement (similar to the examples in this section) to call the `get` methods.  

## 构造函数方法

前面例子的一个难点是，如果您最初创建一个对象并用值填充该对象的属性，那么需要调用大量的`set`例程。`Dog`类要求您调用四个 set 方法(`set_dog_name`、`set_dog_breed`、`set_dog_color`和`set_dog_weight`)，以便在所有属性中放置值。您可以使用一种更有效的方式一次更新所有这些属性。这可以减少`lab.php`文件中的代码。在您提供初始值之后，您可以使用`Dog`类中的`set`例程来进行任何更改(也许狗增加了一些体重)。初始值不是默认值。您仍然需要默认值，以防初始值无效。

当在内存中创建一个类(对象)的实例时，操作系统执行一个构造函数方法，该方法用任何属性和方法构建对象。系统还在内存中建立表来跟踪对象的位置和对象属性中存在的值。当不再需要该对象时，操作系统的垃圾收集器将通过该对象的析构函数方法调用，这将把它从内存中移除。

您还可以包含一个构造函数方法，当对象被放入内存时，该方法将被自动调用。当创建对象`($lab = new Dog;`的代码行被执行时，它在对象中寻找一个构造函数方法。如果存在，则执行该方法。您可以通过创建对象的同一行将属性的所有初始值传递给这个构造函数方法。

`$lab = new Dog('Fred', 'Lab', 'Yellow', 50);`

这成为从`lab.php`程序中提供初始值的一种更有效的方式。

构造函数方法是一种通用格式，函数名为`__` `construct`(注意在单词 construct 之前有两个下划线)。

`<?php`

`class Dog`

`{`

`function __construct($value1, $value2, $value3, $value4)`

`{`

`// code to update properties`

`}`

`// other methods`

`}`

`?>`

您可以在构造函数中使用现有的`set`方法来更新属性。您将需要收集任何消息(`TRUE/FALSE`)并将它们返回给调用程序(`lab.php`)。您可以使用与最初编码类似的过程来处理`get_properties`方法。

Example 3-12\. Dog class with constructor—dog.php

`<?php`

`class Dog`

`{`

`// ----------------------------------------- Properties ------------------------------------`

`private $dog_weight = 0;`

`private $dog_breed = "no breed";`

`private $dog_color = "no color";`

`private $dog_name = "no name";`

`private $error_message = "??";`

`// ---------------------------------- Constructor ------------------------------------------`

`function __construct($value1, $value2, $value3, $value4)`

`{`

`$name_error = $this->set_dog_name($value1) == TRUE ? 'TRUE,' : 'FALSE,';`

`$breed_error = $this->set_dog_breed($value2) == TRUE ? 'TRUE,' : 'FALSE,';`

`$color_error = $this->set_dog_color($value3) == TRUE ? 'TRUE,' : 'FALSE,';`

`$weight_error= $this->set_dog_weight($value4) == TRUE ? 'TRUE' : 'FALSE';`

`$this->error_message = $name_error . $breed_error . $color_error . $weight_error;`

`}`

`//------------------------------------toString----------------------------------------------`

`public function __toString()`

`{`

`return $this->error_message;`

`}`

`//... There are no other code changes to dog.php below this line.`

> For more information about the `__construct` method, please visit: Example: [`http://php.net/manual/en/language.oop5.decon.php`](http://php.net/manual/en/language.oop5.decon.php) Video: `https://www.thenewboston.com/videos.php?cat=11&video=17181`

首先，让我们讨论一下在示例 [3-12](#FPar15) 中称为`__` `toString`(注意两个下划线)的特殊方法的使用。构造函数方法不允许返回信息(默认情况下)。在构造函数中不能使用`return`语句。为了将在构造函数中创建的错误消息返回给调用程序(`lab.php`)，你必须欺骗程序。`__toString`方法允许程序员决定如果试图使用带有对象名(`print $lab;`)的`print`(或`echo`)方法会发生什么。通常会出现一条错误消息，声称对象不能转换为字符串(`print`和`echo`只能显示字符串)。这可以通过在返回字符串的语句中包含一个`__toString`方法来覆盖。如果执行了`print $lab;`语句，您可以通过允许返回`$error_message`属性中的值来克服能够返回错误消息的问题。

> For more information about `__toString` method and other magic methods, please visit [`http://php.net/manual/en/language.oop5.magic.php`](http://php.net/manual/en/language.oop5.magic.php) .

由`set`方法返回的`TRUE`和`FALSE`常量也会引起问题，因为它们是常量而不是字符串。如果您试图使用一个方法(比如`strval(TRUE);`)将这些常量转换成一个字符串，它们所代表的值(1 代表`TRUE`，0 代表`FALSE`)将变成一个字符串，而不是'`TRUE'`或'`FALSE'`。因此，它们不能通过`__toString`方法返回。为了克服这个问题，我们在构造函数中创建了下面的代码来进行从`TRUE`到’`TRUE'`或者从`FALSE`到’`FALSE'`的转换。

`$name_error = $this->set_dog_name($value1) == TRUE ? 'TRUE,' : 'FALSE,';`

操作的顺序将导致`set_dog_name`方法在代码的任何部分之前执行。`set_dog_name`方法返回`TRUE`或`FALSE`(常量)。假设该方法在执行后返回一个`TRUE`，代码行现在应该是

`$name_error = TRUE == TRUE ? 'TRUE,' : 'FALSE,';`

操作顺序要求对比较(`TRUE == TRUE`)进行评估。当然，这评估为`TRUE`。使用了`?`和`:`之间的语句。

`$name_error = 'TRUE,';`

因此`$name_error`被设置为字符串`"TRUE,"`，它现在是一个字符串，而不是一个常量。

还要注意，已经添加了一个'，'，为下一个'`TRUE'`或'`FALSE'`'值做准备。传递的每个值(除了最后一个值)必须用'，'分隔，以便稍后分隔字符串。

评估其他三个类似的行，并在错误消息属性中放置一个'`TRUE`、'或'`FALSE`、'(重量错误评估不包括字符串末尾的逗号，因为它是最后一个评估的)。

计算构造函数中的最后一行代码。

`$this->error_message = $name_error . $breed_error . $color_error . $weight_error;`

这一行将每个错误属性的值放入`error_message`属性中。如果所有的更新都成功了，`$error_message`属性将包含

`"TRUE,TRUE,TRUE,TRUE"`

请注意，除了最后一项之外，传递的每一项都包含一个“，”用于分隔。这对于分解字符串的结果是必要的。

Example 3-13\. The lab.php file calling a constructor

`<?php`

`require_once("dog.php");`

`$lab = new Dog('Fred','Lab','Yellow','100');`

`list($name_error, $breed_error, $color_error, $weight_error) = explode(',', $lab);`

`print $name_error == 'TRUE' ? 'Name update successful<br/>' : 'Name update not successful<br/>';`

`print $breed_error == 'TRUE' ? 'Breed update successful<br/>' : 'Breed update not successful<br/>';`

`print $color_error == 'TRUE' ? 'Color update successful<br/>' : 'Color update not successful<br/>';`

`print $weight_error == 'TRUE' ? 'Weight update successful<br/>' : 'Weight update not successful<br/>';`

`// ------------------------------Set Properties--------------------------`

`...There are no other changes to lab.php below this line.`

示例 [3-13](#FPar16) 第三行的对象创建略有变化。

`$lab = new Dog('Fred','Lab','Yellow','100');`

您现在通过构造函数将初始值(`Fred`、`Lab`、`Yellow`和`100`)传递给对象。否则，您将不得不四次调用`set`方法(`set_dog_name`、`set_dog_breed`、`set_dog_color`和`set_dog_weight`)来完成同样的事情。这允许您使用`set`方法进行最初设置对象后所需的更新(`$lab`)。

为了确定对四个属性的更新是否成功，您必须从对象的`$error_message`属性中检索您的值(`TRUE`、`TRUE`、`TRUE`、`TRUE`)。在`Dog`类中的`__toString`方法允许你把`$lab`当作一个字符串来处理。这允许您在类似于`get_properties`方法输出的过程中使用`explode`方法。

`list($name_error, $breed_error, $color_error, $weight_error) = explode(',', $lab);`

这一行代码将把`$lab` ( `TRUE`、`TRUE`、`TRUE`、`TRUE`)的内容用逗号分开，并将每个部分放入属性`$name_error`、`$breed_error`、`$color_error`和`$weight_error`。现在，这些属性中的每一个都将包含字符串`'TRUE'`。然后，您可以评估您的消息，以类似于评估`set`方法结果的技术来查看更新是否成功。

`print $name_error == 'TRUE' ? 'Name update successful<br/>' : 'Name update not successful<br/>';`

在评估`set`方法的结果时，这种格式和类似的语句之间只有一些微小的区别。这些代码行中的每一行都使用不同的错误消息进行评估(`$name_error`、`$breed_error`、`$color_error`和`$weight_error`)。之前，您对 set 方法的所有结果使用了相同的属性(`$error_message`)。您现在评估的是字符串`'TRUE'`而不是常量`TRUE`(代码中唯一的区别是实际的引号)。

在图 [3-5](#Fig5) 中，前四行输出是通过将值传递给构造函数来为每个属性提供初始设置而产生的。当使用`set`方法更改属性中的值时，将产生接下来的四行输出。最后四行是通过执行`get`方法产生的(显示每个属性的内容)。最后一行输出是由`get_properties`方法产生的。虽然初始值(`Fred`、`Lab`、`Yellow`和`100`)被成功地传递到构造函数中，但是每个属性中的值都是使用 set 方法(传递`Sally`、`Labrador`、`Brown`和`5`)更改的。

> And security-some people think that checking for errors every time you update is redundant. However, in the current environment where people are constantly trying to destroy data, we must be as careful as possible when updating. No program can 100% avoid data corruption. I hope you have noticed that once you develop a routine to check data, your data check code lines will become very similar every time. Therefore, by copying and pasting (slightly modifying) the code lines that successfully verify the data, you can greatly improve the security without adding a lot of extra coding time.

![A978-1-4842-1730-6_3_Fig5_HTML.jpg](img/A978-1-4842-1730-6_3_Fig5_HTML.jpg)

图 3-5。

Output from dog.php and lab.php with the `constructor`, `set`, and `get` methods

### 做它

This chapter has covered a lot of PHP examples and terms. To help clarify any difficulties you might currently be experiencing in understanding the PHP language, visit this web site for additional tutorials: [`http://www.w3schools.com/php/default.asp`](http://www.w3schools.com/php/default.asp)   Update the constructor in the `Dog` class to also allow the passing of the `dog_gender` value (Male or Female). Update the `lab.php` program to pass the gender through the constructor. Also update `lab.php` to explode the `$lab` string into five parts (one more for the `dog_gender`). Then evaluate the results (`'TRUE'` or `'FALSE'`) returned from the `gender_error` to display `"Gender update successful"` or `"Gender update not successful"`.  

## 章节术语

  
| PHP 扩展 | 梨树 |
| `require` | `require_once` |
| 班级 | 性能 |
| 变量 | 方法 |
| 功能 | 目标 |
| 包装 | 私人的 |
| `set`方法 | `get`方法 |
| `$this`指针 | 串并置 |
| `Include` | `include_once` |
| `new`关键字 | `return` |
| 逗号分隔的字符串 | `explode`方法 |
| 子链 | `set`方法 |
| 布尔值 | 条件语句 |
| 三元运算符 | 整数 |
| 参数 | 零合并运算符 |
| `&&, And` | `ctype_alpha` |
| `strlen` | `ctype_digit` |
| `&#124;&#124;, Or` | 宇宙飞船操作员 |
| 空 | 操作顺序 |
| 构造函数方法 | 析构函数方法 |
| `__toString` | 列表对象 |

## 第二章问题和项目

多重选择

PHP variables begin with which symbol? ?   `!`   `$`   `&`     A valid function name can start with which of the following? A letter   An underscore   A number   Both A and B     Which conditional statement syntax is valid for PHP? `IF (condition) { execution };`   `IF (condition) { execution }`   `if (condition) { execution };`   `if (condition) {execution}`     Which of the following includes properties and actions (methods or functions) that can occur in an application? Class   `set` method   `get` method   `for` loop     Which basic function does a constructor method perform? Defines properties   Defines methods   Places an instance of a class into memory   A and B     The `&&` symbol and/or the word `AND` Are relational operators, when used, and require all statements checked to be true for the complete `if` statement to be considered `true`   Are conjunctions used in PHP to connect programs   Are relational operators, when used, and require that only one statement checked to be true for the complete `if` statement to be considered `true`   Are relational operators and conjunctions used in PHP to connect programs     An integer is which of the following? A string or text value   A floating-point number   A whole number   A fraction     A ternary operator is which of the following? An alternative to setting a variable   An alternative to using an `if-else` conditional statement   An alternative to using an embedded `if-else` conditional statement   B and C     How does one create an instance of the class `fred` and execute the constructor method in PHP? `$this->fred`   `$variable = new fred`   `$load_class = fred`   `$fred`     What purpose does the method `ctype_digit` serve? Randomly generates an integer value   Determines whether characters inputted are numeric   Determines whether a class output is numeric   Converts a string value to an integer     Pear is an acronym for PHP Extends and Applies Registry   PHP Excellence in Applied Requirements   PHP Extension and Application Repository   Properties of Extension and Application Registry     Creating `set` methods inside classes Allows properties to be changed automatically   Should not be done as it corrupts data   Provides the ability for the class to verify information before the property is updated   Provides the ability for the class to verify information after the property is updated     `if` statements Are also called conditional statements   Can compare two values to determine if they are the same or different   Use comparison operators (`==, <, >, <=, >=`) to determine if the statement is true or false   All of the above     `$x && $y` condition is `TRUE` if Both `$x` and `$y` are true   `$x` or `$y` are true   Both `$x` and `$y` are false   `$x` or `$y` are false     Select the statement about Boolean values that is false. Boolean is a data type having two possible values—TRUE and FALSE   Boolean values represent the truth values of logic   Boolean values are only associated with conditional statements   In PHP Boolean literals, TRUE and FALSE are case-sensitive     Which one of these numbers is an example of an integer? 1.01   2f   423   .002     Protecting an object’s data from code outside the class is called what? Inheritance   Encapsulation   Classification   Blocking     Which kind of methods are easier to code than `set` methods and are known as read only methods since they do not change any property values? `explode` methods   `get` methods   `constructor` methods   `match` methods     Why would you include objects in your program? To make notes in your code   To make mini mobile programs   To make your code more complex   To protect your code from direct access     How do you call a function named `myFunction`? `call myFunction();`   `myFunction();`   `call function myFunction;`   `call.myFunction();`     A class can contain all of the following except Properties   Methods or functions   Conditional statements   Machine code     When working with a comma-delimited string, which character is used to separate the data in the string? Space   Semicolon   Asterisk   Comma    

对/错

Methods are functions that belong to a class.   You would use the symbol `||` or the word `or` when you want both conditions to be true.   When a function is private, it can only be used inside the class in which it exists.   The `explode` method can be used to separate a string at the specified delimiter.   The `new` keyword tells the operating system that an instance of that class should be created in memory.   The function `Ctype_alpha` will return `true` when a number is passed into it.   `require_once` will not execute if the file has already been attached to the program.   The `ctype_digit` function determines if the characters passed are alphabetic.   The `ctype_alpha` function determines if the characters passed are alphabetic.   A PHP constructor has the same name as the class.   A ternary operator is shorthand for a `while` loop.   If a file has already been included in a program, the `require_once` function will generate only a warning and allow the program to continue.   Destructor methods are called when there are no remaining references to an object or when that object has been explicitly destroyed.   Objects are blocks of code that have already been compiled for use in an application.   The `else` statement extends an `if` statement by allowing code to execute when the `if` statement evaluates to `FALSE`.   `include` or `require` statements can only be placed at the top of an PHP program.   Programmers can pull their own libraries of code into an application via the `require` or `require_once` statement.  

简答/短文

Explain the meaning of encapsulation and how classes are encapsulated.   Why should a programmer use `set` and `get` methods?   Why should every entry on a web page from a user be validated?  

项目

Create a PHP program with a class (`Student`) with the following properties: `student_id, student_name, student_address, student_state, student_zip`, and `student_age`. The program includes `get` and `set` methods for each property. Validate the proper type and size of data passed into each property. The program also includes the ability for each property to use the constructor to set values. Create an instance of the class passing properties through the constructor. Change two of the properties using `set` methods. Display the properties using `get` methods.   Create a PHP program to keep track of inventory within a grocery store. Each item (`class`) includes an item number, description, size, self, isle, amount, and price. Each field must be verified for proper information before the entries are accepted. Item numbers range from 00000 to 99999\. The store has 16 isles (00-15). No price in the store is greater than $1000\. All entries are coded via a constructor or set methods. After all entries have correctly been accepted, the program will generate a report of the entries (using `get` methods).  

学期项目

Using the design from the [Chapter 2](2.html) Term Project, create a PHP program that will provide the interface for entering in the ABC Computer Parts Corporation inventory items for the warehouse. The PHP class must verify the contents of the information passed from each field (via the `set` methods) to ensure that no corruption has taken place. `Set` and `Get` methods for each property must exist in the class. The constructor should use the `set` methods to populate the properties. Also create an interface program that will make an instance of the class and test the ability to populate the properties. The test program should generate a report of the item placed in inventory (similar to the output shown in this chapter). The files created should use logic similar to what was shown in the examples in this chapter.