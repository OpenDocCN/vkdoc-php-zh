# 3.如何编写 PHP 脚本

这一章提供了 PHP 工作原理的快速概述，并给出了基本规则。它主要针对那些以前没有 PHP 或编码经验的读者。即使你以前使用过 PHP，也要检查一下主要的标题，看看这一章包含了什么，并复习一下你不太清楚的方面的知识。

本章涵盖

*   理解 PHP 的结构

*   在网页中嵌入 PHP

*   将数据存储在变量和数组中

*   让 PHP 做决定

*   循环重复的任务

*   使用预设任务的功能

*   显示 PHP 输出

*   理解 PHP 错误消息

## PHP:大图

乍一看，PHP 代码可能看起来很吓人，但是一旦你理解了基础，你会发现结构非常简单。如果你使用过其他计算机语言，比如 JavaScript 或 jQuery，你会发现它们有很多共同点。

每个 PHP 页面*必须*具有以下内容:

*   正确的文件扩展名，通常是`.php`

*   每个 PHP 代码块周围的 PHP 标记(如果文件只包含 PHP 代码，通常省略结束 PHP 标记)

典型的 PHP 页面将使用以下部分或全部元素:

*   变量作为未知或变化值的占位符

*   用于保存多个值的数组

*   做出决策的条件语句

*   执行重复任务的循环

*   执行预设任务的功能或对象

让我们依次快速浏览一下，从文件名和开始、结束标记开始。

### 告诉服务器处理 PHP

PHP 是一种**服务器端语言**。web 服务器——通常是 Apache——处理您的 PHP 代码，并只将结果(通常是 HTML 格式)发送给浏览器。因为所有的操作都在服务器上进行，所以您需要告诉它您的页面包含 PHP 代码。这包括两个简单的步骤:

*   给每个页面一个 PHP 文件扩展名；默认为`.php`。只有当你的主机公司明确要求你使用不同的扩展名时，才使用不同的扩展名。

*   用 PHP 标签识别所有的 PHP 代码。

开始标签是`<?php`，结束标签是`?>`。如果你把标签和周围的代码放在同一行，那么在开始标签之前或者结束标签之后不需要有空格，但是在开始标签中的`php`之后必须有一个空格，就像这样:

```
<p>This is HTML with embedded PHP<?php //some PHP code ?>.</p>

```

当插入多行 PHP 代码时，为了清晰起见，最好将开始和结束标记放在不同的行上:

```
<?php
// some PHP code
// more PHP code
?>

```

你可能会遇到`<?`作为开始标签的另一个简短版本。但是，`<?`并未在所有服务器上启用。坚持使用保证有效的`<?php`。

当一个文件只包含 PHP 代码时，强烈建议省略结束 PHP 标签。这避免了使用包含文件时的潜在问题(参见第 [5](05.html) 章)。

Note

为了节省空间，本书中的大多数例子都省略了 PHP 标签。当您编写自己的脚本或将 PHP 嵌入到网页中时，您必须始终使用它们。

### 在网页中嵌入 PHP

PHP 可以作为一种**嵌入式**语言。这意味着您可以在普通网页中插入 PHP 代码块。当有人访问您的站点并请求一个 PHP 页面时，服务器会将其发送到 PHP 引擎，该引擎会从上到下读取页面，寻找 PHP 标签。HTML 和 JavaScript 原封不动地通过，但是每当 PHP 引擎遇到一个`<?php`标签时，它就开始处理您的代码，并继续处理，直到到达结束的`?>`标签(或者如果 PHP 代码后面没有任何内容，则到达脚本的结尾)。如果 PHP 产生了任何输出，它就在那个点被插入。

Tip

一个页面可以有多个 PHP 代码块，但是它们不能嵌套在一起。

图 [3-1](#Fig1) 显示了嵌入在普通网页中的一段 PHP 代码，以及它通过 PHP 引擎后在浏览器和页面源代码视图中的样子。该代码计算当前年份，检查它是否不同于固定年份(在图左侧代码的第 26 行用`$startYear`表示)，并在版权声明中显示适当的年份范围。从图右下方的页面源代码视图中可以看到，发送到浏览器的内容中没有 PHP 的痕迹。

![../images/332054_5_En_3_Chapter/332054_5_En_3_Fig1_HTML.jpg](../images/332054_5_En_3_Chapter/332054_5_En_3_Fig1_HTML.jpg)

图 3-1

PHP 代码保留在服务器上；只有输出被发送到浏览器

Tip

PHP 并不总是为浏览器产生直接输出。例如，它可以在发送电子邮件或将信息插入数据库之前检查表单输入的内容。因此，一些代码块被放在主 HTML 代码的上面或下面，或者放在外部文件中。但是，产生直接输出的代码会出现在您希望显示输出的地方。

### 将 PHP 存储在外部文件中

除了在 HTML 中嵌入 PHP，通常的做法是将常用代码存储在单独的文件中。当一个文件只包含 PHP 代码时，开始的`<?php`标签是强制的，但是结束的`?>`标签是可选的。事实上，推荐的做法是省去结束的 PHP 标签。然而，如果外部文件在 PHP 代码后包含 HTML，你*必须*使用结束`?>`标签。

### 使用变量来表示变化的值

图 [3-1](#Fig1) 中的代码可能看起来像是一种非常冗长的显示一年或一系列年份的方式。但是从长远来看，PHP 解决方案可以节省您的时间。你不需要每年更新版权声明，PHP 代码会自动更新。你写一次代码就忘了。更重要的是，正如你将在第五章[中看到的，如果你将代码存储在一个外部文件中，对外部文件的任何更改都会反映在你网站的每一页上。](05.html)

这种自动显示年份的能力依赖于 PHP 的两个关键方面:**变量**和**函数**。顾名思义，函数做事情；它们执行预设的任务，例如获取当前日期并将其转换为人类可读的形式。稍后我将介绍函数，所以让我们先研究变量。图 [3-1](#Fig1) 中的脚本包含两个变量:`$startYear`和`$thisYear`。

Tip

一个**变量**仅仅是你给一个可能改变或者你事先不知道的东西起的名字。PHP 中的变量总是以`$`(一个美元符号)开头。

我们在日常生活中无时无刻不在使用变量，而不去思考它。当你第一次见到某人时，你可以问“你叫什么名字？”这个人是叫汤姆、迪克还是哈里特并不重要；“名”字不变。同样，你的银行账户也是，钱一直在进进出出(看起来大部分是出了)，但是如图 3-2 所示，无论你是穷困潦倒还是腰缠万贯都没关系。可用的金额总是被称为余额。

![../images/332054_5_En_3_Chapter/332054_5_En_3_Fig2_HTML.jpg](../images/332054_5_En_3_Chapter/332054_5_En_3_Fig2_HTML.jpg)

图 3-2

你的银行对账单上的余额是一个变量的日常例子——标签保持不变，尽管值可能每天都在变化

所以“名字”和“余额”是日常变量。只要在它们前面放一个美元符号，就有了两个现成的 PHP 变量，就像这样:

```
$name
$balance

```

很简单。

#### 命名变量

只要记住以下规则，您可以随意命名变量:

*   变量总是以美元符号(`$`)开头。

*   有效字符包括字母、数字和下划线。

*   美元符号后的第一个字符必须是字母或下划线(`_`)。

*   除下划线外，不允许有空格或标点符号。

*   变量名区分大小写:`$startYear`和`$startyear`不一样。

给变量命名时，选择能告诉你它的用途的东西。到目前为止，你所看到的变量——`$startYear`、`$thisYear`、`$name`和`$balance`——就是很好的例子。在组合单词时，最好将第二个或后续单词的第一个字母大写(有时称为 **camel case** )。或者，您可以使用下划线(`$start_year`、`$this_year`等)。).

Tip

西欧语言中常用的重音字符在变量中是有效的。比如`$prénom`和`$förnamn`都是可以接受的。在实践中，您也可以在变量名中使用其他字母，如西里尔字母和非字母文字，如日本汉字；但是在撰写本文时，这种使用还没有文档记录，所以我建议坚持前面的规则。

不要试图通过使用非常短的变量来节省时间。使用`$sy`、`$ty`、`$n`和`$b`而不是更具描述性的会让代码更难理解——这也让代码更难写。更重要的是，这使得错误更难发现。和往常一样，规则也有例外。按照惯例，`$i`、`$j`和`$k`经常用于记录循环运行的次数，而`$e`和`$t`用于错误检查。在本章的后面你会看到这些例子。

Caution

虽然你在变量名的选择上有相当大的自由度，但是不能用`$this`，因为它在 PHP 面向对象编程中有特殊的含义。建议避免 [`www.php.net/manual/en/reserved.php`](http://www.php.net/manual/en/reserved.php) 中列出的任何关键词。

#### 给变量赋值

变量从各种来源获取值，包括:

*   通过在线表单的用户输入

*   一个数据库

*   外部源，如新闻源或 XML 文件

*   计算的结果

*   PHP 代码中的直接赋值

无论该值来自何处，通常都会被赋予一个等号(`=`)，如下所示:

```
$variable = value;

```

变量在等号的左边，值在右边。因为等号赋值，所以称之为**赋值运算符**。

Caution

从小对等号的熟悉，让我们很难走出认为它表示“等于”的习惯。然而，PHP 使用两个等号(`==`)来表示相等。这是初学者犯错误的主要原因，而且有时也会让更有经验的开发人员犯错误。`=`和`==`之间的区别将在本章后面详细介绍。

### 以分号结束命令

PHP 被写成一系列的命令或语句。每个语句通常告诉 PHP 引擎执行一个操作，并且它后面必须总是跟一个分号，就像这样:

```
<?php
do this;
now do something else;
?>

```

与所有规则一样，有一个例外:您可以省略代码块中最后一条语句后的分号。然而，*不要这样做*，除非使用短的`echo`标签，如本章后面所述。与 JavaScript 不同，PHP 不会假定如果你省略分号，行尾就应该有分号。这有一个很好的副作用:你可以将长语句分散在几行中，以便于阅读。PHP 和 HTML 一样，忽略代码中的空白。相反，它依靠分号来指示一个命令的结束位置和下一个命令的开始位置。

Tip

缺少分号会让你的脚本嘎然而止。

### 注释脚本

PHP 将所有东西都视为要执行的语句，除非您将一段代码标记为注释。以下三个原因解释了您为什么想要这样做:

*   插入脚本功能的提醒

*   为以后添加的代码插入占位符

*   暂时禁用一段代码

当您对脚本记忆犹新时，似乎没有必要插入任何不会被处理的内容。然而，如果您需要在几个月后修改脚本，您会发现注释比试图单独遵循代码更容易阅读。当你在团队中工作时，评论也是至关重要的。他们帮助你的同事理解代码的意图。

在测试过程中，阻止一行代码，甚至整个部分运行通常是有用的。PHP 忽略任何标记为注释的东西，所以这是一种打开和关闭代码的有用方法。

添加注释有三种方式:两种用于单行注释，一种用于跨越多行的注释。

#### 单行注释

最常见的单行注释以两个正斜杠开头，如下所示:

```
// this is a comment and will be ignored by the PHP engine

```

PHP 忽略从双斜线到行尾的所有内容，所以您也可以在代码旁边放置注释(但只能放在右边):

```
$startYear = 2018; // this is a valid comment

```

注释不是 PHP 语句，所以它们不以分号结尾。但是不要忘记 PHP 语句末尾的分号，它和注释在同一行。

另一种样式使用散列或井号(`#`)，如下所示:

```
# this is another type of comment that will be ignored by the PHP engine
$startYear = 2018; # this also works as a comment

```

这种注释风格通常表示较长脚本的各个部分，如下所示:

```
##################
## Menu section ##
##################

```

Caution

PHP 8 使用`#[`作为一个名为属性的新特性的开始语法，该特性为类、函数和一些其他特性的声明提供元数据(参见 [`www.php.net/manual/en/language.attributes.overview.php`](http://www.php.net/manual/en/language.attributes.overview.php) )。如果你在`#`后面使用一个方括号作为注释，PHP 8 将会产生一个解析错误。

#### 多行注释

对于跨越几行的注释，使用与级联样式表(CSS)和 JavaScript 相同的样式。`/*`和`*/`之间的任何内容都被视为注释，如下所示:

```
/* This is a comment that stretches
   over several lines. It uses the same
   beginning and end markers as in CSS. */

```

多行注释在测试或故障排除时特别有用，因为它们可以用来禁用脚本的长部分，而无需删除它们。

Tip

好的注释和精心选择的变量名使代码更容易理解和维护。

### 使用数组存储多个值

PHP 允许你在一个特殊类型的变量中存储多个值，这个变量被称为一个**数组**。一种简单的思考数组的方式是，它们就像一个购物清单。虽然每个项目可能不同，但您可以用一个名称来统称它们。图 [3-3](#Fig3) 展示了这个概念:变量`$shoppingList`指的是所有五个项目——酒、鱼、面包、葡萄和奶酪。

![../images/332054_5_En_3_Chapter/332054_5_En_3_Fig3_HTML.jpg](../images/332054_5_En_3_Chapter/332054_5_En_3_Fig3_HTML.jpg)

图 3-3

数组是存储多个项目的变量，就像购物清单一样

单个项目——或**数组元素**——通过紧跟在变量名后面的方括号中的数字来标识。PHP 自动分配编号，但是需要注意的是编号总是从 0 开始。所以数组中的第一项，在我们的例子中是葡萄酒，被称为`$shoppingList[0]`，而不是`$shoppingList[1]`。虽然有五个项目，但最后一个(奶酪)是`$shoppingList[4]`。这个数字被称为数组**键**或**索引**，这种类型的数组被称为**索引数组**。

Caution

PHP 8 改变了自动编号的工作方式。如果你创建一个数组，第一个键是负数(如第 [4](04.html) 章所述)，后续的键将在前一个数上加 1。在 PHP 8 之前，负数之后的后续键总是从零开始。

PHP 使用另一种类型的数组，其中的关键字是一个单词(或者是字母和数字的任意组合)。例如，包含这本书的详细信息的数组可能如下所示:

```
$book['title'] = 'PHP 8 Solutions: Dynamic Web Design and Development Made Easy';
$book['author'] = 'David Powers';
$book['publisher'] = 'Apress';

```

这种类型的数组称为**关联数组**。注意数组键是用引号括起来的(单引号还是双引号，无所谓)。

数组是 PHP 重要而有用的一部分。你会经常用到它们，从第 5 章[开始，你将在一个数组中存储图像的细节，以在网页上显示一个随机的图像。当您在一系列数组中获取搜索结果时，数组也广泛用于数据库。](05.html)

Note

你可以在第 4 章中学习创建数组的各种方法。

### PHP 内置的超级全局数组

PHP 有几个内置的数组，可以自动填充有用的信息。它们被称为**超全局数组**，通常以美元符号后跟下划线开始。唯一的例外是`$GLOBALS`，它包含对脚本的**全局作用域**中所有变量的引用(参见第 [4](04.html) 章中的“变量作用域:作为黑盒的功能”了解作用域的描述)。

你会经常看到的两个超级全局变量是`$_POST`和`$_GET`。它们包含分别通过超文本传输协议(HTTP) `post`和`get`方法从表单传递的信息。超全局变量都是关联数组，`$_POST`和`$_GET`的键是从 URL 末尾的查询字符串中的表单元素或变量的名称自动派生出来的。

假设您在一个表单中有一个名为“`address`”的文本输入字段；当表单通过`post`方法提交时，PHP 自动创建一个名为`$_POST['address']`的数组元素，或者如果使用`get`方法，PHP 自动创建一个名为`$_GET['address']`的数组元素。如图 [3-4](#Fig4) 所示，`$_POST['address']`包含了访问者在文本字段中输入的任何值，使你能够在屏幕上显示它，将其插入数据库，发送到你的电子邮箱，或者做任何你想做的事情。

![../images/332054_5_En_3_Chapter/332054_5_En_3_Fig4_HTML.jpg](../images/332054_5_En_3_Chapter/332054_5_En_3_Fig4_HTML.jpg)

图 3-4

您可以通过`$_POST`数组检索用户输入的值，该数组是在使用`post`方法提交表单时自动创建的

当您通过电子邮件将在线反馈表的内容发送到您的收件箱时，您将使用第 [6](06.html) 章中的`$_POST`数组。你将在本书中使用的其他超全局数组是`$_SERVER`，在第 [5](05.html) 、 [14](14.html) 和 [15](15.html) 中从 web 服务器获取信息，在第 [8](08.html) 和`$_SESSION`章中上传文件到你的网站，在第 [11](11.html) 和 [19](19.html) 中创建一个简单的登录系统。

Caution

不要忘记 PHP 中的变量名是区分大小写的。所有超全局数组名都是大写的。比如`$_Post`或者`$_Get`就不行。

### 了解何时使用引号

如果你仔细观察图 [3-1](#Fig1) 中的 PHP 代码块，你会注意到赋给第一个变量的值没有用引号括起来。看起来是这样的:

```
$startYear = 2021;

```

然而“使用数组存储多个值”*中的所有例子都使用了引号，就像这样:*

```
$book['title'] = 'PHP 8 Solutions: Dynamic Web Design and Development Made Easy';

```

简单的规则如下:

*   **数字**:无引号

*   **文本**:需要引号

一般来说，不管是用单引号还是双引号括住文本还是用**字符串**括住文本，都没有关系，因为文本是在 PHP 和其他计算机语言中调用的。情况有点复杂，如第 4 章[中所解释的，因为 PHP 引擎处理单引号和双引号的方式有细微的差别。](04.html)

Note

“字符串”这个词是从计算机和数学科学中借来的，它的意思是一系列简单的对象——在这里是文本中的字符。

引号必须总是成对出现，所以在单引号字符串中包含撇号或者在双引号字符串中包含双引号时需要小心。检查以下代码行:

```
$book['description'] = 'This is David's latest book on PHP.';

```

乍一看，似乎没什么毛病。然而，PHP 引擎看到的东西与人眼不同，如图 [3-5](#Fig5) 所示。

![../images/332054_5_En_3_Chapter/332054_5_En_3_Fig5_HTML.jpg](../images/332054_5_En_3_Chapter/332054_5_En_3_Fig5_HTML.jpg)

图 3-5

单引号字符串中的撇号会使 PHP 引擎混淆

有两种方法可以解决这个问题:

*   如果文本包含撇号，请使用双引号。

*   在撇号前加一个反斜杠(这被称为**转义**)。

因此，以下两种情况都是可以接受的:

```
$book['description'] = "This is David's latest book on PHP.";
$book['description'] = 'This is David\'s latest book on PHP.';

```

这同样适用于双引号字符串中的双引号(尽管规则相反)。以下代码导致了一个问题:

```
$play = "Shakespeare's "Macbeth"";

```

在这种情况下，撇号没问题，因为它与双引号不冲突，但是 *Macbeth* 前面的左引号使字符串过早结束。要解决该问题，以下任一方法都是可以接受的:

```
$play = 'Shakespeare\'s "Macbeth"';
$play = "Shakespeare's \"Macbeth\"";

```

在第一个示例中，整个字符串都用单引号括起来。这绕过了麦克白的双引号问题，但是引入了对 T2 的莎士比亚的 T3 中的撇号进行转义的需要。撇号在双引号字符串中没有问题，但是*麦克白*两边的双引号都需要转义。所以，总结一下

*   单引号和撇号在双引号字符串中是可以的。

*   双引号可以出现在单引号字符串中。

*   其他任何内容都必须用反斜杠进行转义。

Tip

大多数情况下使用单引号，保留双引号用于有特殊含义的情况，如第 [4](04.html) 章所述。

#### 特殊情况:真、假和空

尽管文本应该用引号括起来，但是三个关键字——`true`、`false`和`null`——永远不应该用引号括起来，除非您想将它们视为字符串。前两个意味着你所期望的；`null`表示“不存在的价值”

Note

`True`和`false`被称为**布尔值**。它们是以 19 世纪数学家乔治·布尔的名字命名的，他的逻辑运算系统成为许多现代计算的基础。

正如下一节所解释的，PHP 根据某个东西是等于`true`还是`false`来做出决定。给`false`加上引号会产生意想不到的后果。考虑以下代码:

```
$OK = 'false';

```

这与你可能期望的正好相反:它使`$OK`成为真实！为什么呢？因为`false`周围的引号把它变成了一个字符串，而 PHP 把字符串当成了`true`。(在第四章的“PHP 真相”中有更详细的解释。)

关键字`true`、`false`、`null`为*不区分大小写*。下面的例子都是有效的:

```
$OK = TRUE;
$OK = tRuE;
$OK = true;

```

因此，概括一下，PHP 将`true`、`false`和`null`视为特例:

*   不要用引号将它们括起来。

*   它们不区分大小写。

### 做决定

决定，决定，决定…生活充满了决定。PHP 也是。它们使它能够根据情况改变输出。PHP 中的决策使用**条件语句**。这些用法中最常见的是`if`,它严格遵循正常语言的结构。在现实生活中，你可能会面临以下决定(诚然，在英国不太常见):如果天气热，我会去海滩。

在 PHP 伪代码中，相同的决定如下所示:

```
if (the weather's hot) {
    I'll go to the beach;
}

```

被测试的条件放在括号内，结果动作放在花括号内。这是基本的决策模式:

```
if (condition is true) {
    // code to be executed if condition is true
}

```

Tip

条件语句是控制结构，后面没有分号。花括号将一个或多个单独的语句放在一起，这些语句将作为一个组来执行。

如果条件是`true`，花括号内的代码只在执行*。如果是`false`，PHP 将忽略括号之间的所有内容，并继续下一段代码。PHP 如何确定条件是`true`还是`false`将在下一节描述。*

有时，`if`语句就是您所需要的，但是如果条件不满足，您通常希望调用默认操作。为此，使用`else`，就像这样:

```
if (condition is true) {
    // code to be executed if condition is true
} else {
    // default code to run if condition is false
}

```

如果你想要更多的选择，你可以像这样添加更多的条件语句:

```
if (condition is true) {
    // code to be executed if condition is true
} else {
    // default code to run if condition is false
}
if (second condition is true) {
    // code to be executed if second condition is true
} else {
    // default code to run if second condition is false
}

```

在这种情况下，*两个*条件语句都将运行。如果您只想执行一个代码块，可以像这样使用`elseif`:

```
if (condition is true) {
    // code to be executed if first condition is true
} elseif (second condition is true) {
    // code to be executed if first condition fails
    // but second condition is true
} else {
    // default code if both conditions are false
}

```

您可以在条件语句中使用任意多的`elseif`子句。*只执行第一个等于真的条件；所有其他的都将被忽略，即使它们也是真的。*这意味着你需要按照你希望它们被评估的优先顺序来构建条件语句。这是严格的先来先服务的等级制度。

Note

虽然`elseif`通常被写成一个单词，但是你也可以把`else if`作为单独的单词。

### 进行比较

条件语句只对一件事感兴趣:被测试的条件是否等于`true`。如果不是`true`，那一定是`false`。没有折衷或可能的余地。条件通常取决于两个值的比较。这个比那个大吗？它们都一样吗？诸如此类。

为了测试相等性，PHP 使用两个等号(`==`)，如下所示:

```
if ($status == 'administrator') {
    // send to admin page
} else {
    // refuse entry to admin area
}

```

Caution

在第一行使用一个等号(`$status = 'administrator'`)向所有人打开你网站的管理区。为什么呢？因为这样会自动将`$status`的值设置为`administrator`；它不会比较这两个值。这是一个常见的错误，但可能会带来灾难性的后果。要比较值，必须使用两个等号。一个更强大的比较运算符使用三个等号；在第 4 章中有描述。

使用小于(`<`)和大于(`>`)的数学符号进行数值比较。假设您在允许文件上传到您的服务器之前检查文件的大小。您可以将最大大小设置为 50 KB，如下所示(1 千字节= 1024 字节):

```
if ($bytes > 51200) {
    // display error message and abandon upload
} else {
    // continue upload
}

```

Note

第 4 章描述了如何同时测试多个条件。

### 为了清晰起见，使用缩进和空白

缩进代码有助于将语句放在逻辑组中，从而更容易理解脚本的流程。PHP 忽略代码中的任何空白，所以你可以采用任何你喜欢的风格。保持一致，这样你就能发现任何看起来不合适的地方。

大多数人发现缩进四到五个空格有助于提高代码的可读性。也许风格上最大的区别在于花括号的位置。通常将左大括号放在与前面代码相同的行上，右大括号放在代码块后的新行上，如下所示:

```
if ($bytes > 51200) {
    // display error message and abandon upload
} else {
    // continue upload
}

```

然而，其他人更喜欢这种风格:

```
if ($bytes > 51200)
{
    // display error message and abandon upload
}
else
{
    // continue upload
}

```

风格并不重要。重要的是你的代码是一致的，易读的。

### 对重复性任务使用循环

循环可以节省大量时间，因为它们一遍又一遍地执行相同的任务，而只涉及很少的代码。它们经常用于数组和数据库结果。您可以逐一查看每个项目，查找匹配项或执行特定任务。循环在与条件语句结合使用时特别强大，允许您在一次扫描中对大量数据选择性地执行操作。在真实的环境中使用循环可以更好地理解它们。所有循环结构的细节和示例在第 [4](04.html) 章中。

### 使用预设任务的功能

函数做事情……很多事情，令人难以置信的是在 PHP 中。典型的 PHP 设置允许您访问数千个内置函数。您只需要使用少数几种，但是知道 PHP 是一种全功能语言是令人放心的。

您将在本书中使用的函数确实非常有用，例如获取图像的高度和宽度，从现有图像创建缩略图，查询数据库，发送电子邮件，等等。您可以在 PHP 代码中识别函数，因为它们后面总是跟有一对括号。有时候，括号是空的，就像你在上一章的`phpversion.php`中使用的`phpversion()`的情况。不过，括号中通常包含变量、数字或字符串，如图 [3-1](#Fig1) 中的这行代码:

```
$thisYear = date('Y');

```

这段代码计算当前年份，并将其存储在变量`$thisYear`中。它通过向内置的 PHP 函数`date()`提供字符串`'Y'`来工作。像这样在括号之间放置一个值被称为**向函数传递一个参数**。该函数获取参数中的值，并对其进行处理以产生(或**返回**)结果。例如，如果您将字符串`'M'`作为参数传递给`date()`而不是`'Y'`，它将返回三个字母缩写形式的当前月份(例如，三月、四月、五月)。如下例所示，通过将函数的结果赋给适当命名的变量，可以捕获函数的结果:

```
$thisMonth = date('M');

```

Note

第 16 章深入介绍了 PHP 如何处理日期和时间。

有些函数有多个参数。出现这种情况时，请在括号内用逗号分隔参数，如下所示:

```
$mailSent = mail($to, $subject, $message);

```

不需要天才就能发现，这将发送一封电子邮件到第一个参数中存储的地址，主题行存储在第二个参数中，消息存储在第三个参数中。大多数函数都返回值，所以结果存储在变量`$mailSent`(本例中为`true`或 f `alse`，取决于成功或失败)。你会在第 [6 章](06.html)中看到这个函数是如何工作的。

Tip

您经常会遇到术语“参数”而不是“参数”从技术上讲，parameter 指的是函数定义中使用的变量，而 argument 指的是传递给函数的实际值。实际上，这两个术语往往可以互换使用。

似乎所有的内置函数还不够，PHP 允许您构建自己的自定义函数，如下一章所述。即使你不喜欢创建自己的函数，在本书中你也会用到一些我自己做的函数。您可以像使用内置函数一样使用它们。

### 显示 PHP 输出

除非你能在你的网页上显示结果，否则在幕后进行的所有这些魔术没有多大意义。在 PHP 中实现这一点的两种主要方式是使用`echo`和`print`。这两者之间有一些细微的差别，但它们是如此的细微，以至于你可以把`echo`和`print`视为相同。我更喜欢`echo`,原因很简单，因为这样可以少打一个字母。

可以将`echo`与变量、数字、字符串一起使用；简单地把它放在你想展示的东西前面，就像这样:

```
$name = 'David';
echo $name;   // displays David
echo 5;       // displays 5
echo 'David'; // displays David

```

对变量使用`echo`或`print`时，变量必须只包含一个值。您不能使用它们来显示数组或数据库结果的内容。这就是循环如此有用的地方:在循环中使用`echo`或`print`来单独显示每个元素。在本书的其余部分，您将会看到大量这样的例子。

您可能会看到使用圆括号将`echo`和`print`括起来的脚本，如下所示:

```
echo('David'); // displays David

```

括号没什么区别。除非你喜欢为了打字而打字，否则就不要用它们。

#### 使用短回显标签

当您想要显示单个变量或表达式的值(除此之外别无其他)时，您可以使用简短的`echo`标记，它由一个左尖括号、一个问号和等号组成，如下所示:

```
<p>My name is <?= $name ?>.</p>

```

这会产生与以下内容相同的输出:

```
<p>My name is <?php echo $name ?>.</p>

```

因为它是`echo`的简写，所以没有其他代码可以在同一个 PHP 块中，但是当在网页中嵌入数据库结果时，它特别有用。不用说，在使用这个快捷方式之前，变量的值必须在前面的 PHP 块中设置。

Tip

因为没有其他代码可以在同一个 PHP 块中，所以在使用短的`echo`标记时，通常会省略结束 PHP 标记前的分号。

#### 将字符串连接在一起

虽然许多其他计算机语言使用加号(`+`)来连接文本(字符串)，但是 PHP 使用句点、圆点或句号(`.`)，如下所示:

```
$firstName = 'David';
$lastName = 'Powers';
echo $firstName.$lastName; // displays DavidPowers

```

正如最后一行代码的注释所示，当两个字符串像这样连接在一起时，PHP 不会在它们之间留下任何空隙。不要误以为在句号后面加个空格就行了。不会的。你可以在周期的任何一边放尽可能多的空间；结果总是一样的，因为 PHP 会忽略代码中的空格。事实上，为了可读性，建议在句号的两边留一个空格。

要在最终输出中显示一个空格，必须在其中一个字符串中包含一个空格，或者将空格作为单独的字符串插入，如下所示:

```
echo $firstName . ' ' . $lastName; // displays David Powers

```

Tip

句点——或者说**串联操作符**,给它一个正确的名字——可能很难在其他代码中找到。确保编辑器中的字体足够大，可以看到句号和逗号之间的区别。

#### 使用数字

PHP 可以处理很多数字，从简单的加法到复杂的数学。下一章包含了可以在 PHP 中使用的算术运算符的细节。在这个阶段，你需要记住的是，除了小数点之外，数字不能包含任何标点符号。这必须是一个点或句号。在许多欧洲国家，逗号是不允许使用的。类似地，如果您使用逗号或空格作为千位分隔符，PHP 将会阻塞(尽管从 PHP 7.4.0 开始，为了可读性，您可以使用下划线——PHP 在处理代码时会去掉下划线)。

### 理解 PHP 错误消息

错误消息是生活中不幸的事实，所以你需要理解它们试图告诉你什么。下图显示了一条典型的错误消息:

![../images/332054_5_En_3_Chapter/332054_5_En_3_Figa_HTML.jpg](../images/332054_5_En_3_Chapter/332054_5_En_3_Figa_HTML.jpg)

PHP 错误消息报告 PHP 发现问题的行。大多数新人——很自然地——认为这是他们犯错的地方。错了…

大多数时候，PHP 会告诉你发生了意想不到的事情。换句话说，错误在于*先于*那一点。前面的错误消息意味着 PHP 发现了一个不应该存在的`echo`命令。

不要担心`echo`命令可能出了什么问题(可能没什么问题)，开始向后工作，寻找任何遗漏的东西，可能是前一行的分号或右引号。

有时，消息会在脚本的最后一行报告错误。这通常意味着你已经在页面的某个地方省略了右花括号。

这些是主要的错误类别，按重要性降序排列如下:

*   **致命错误**:错误之前的任何 HTML 输出都将被显示，但是一旦遇到错误——顾名思义——其他的都将被彻底杀死。致命错误通常是由引用不存在的文件或函数引起的。

*   **解析错误**:这意味着你的代码语法中有错误，比如不匹配的引号，或者缺少分号或右括号。它停止脚本运行，甚至不允许显示任何 HTML 输出。

*   **警告**:警告表示严重的问题，比如缺少包含文件。(包含文件是第五章[的主题](05.html)。)但是，该错误通常不会严重到阻止脚本的其余部分被执行。

*   **Deprecated** :警告你 PHP 未来版本中计划删除的特性。如果您看到这种类型的错误消息，您应该认真考虑更新您的脚本，因为如果您的服务器升级，它可能会突然停止工作。

*   **Strict** :这种类型的错误消息警告您使用不被认为是良好实践的技术。

*   **注意**:这是对相对较小问题的建议，比如使用未声明的变量。虽然这种类型的错误不会阻止页面的显示(并且您可以关闭通知的显示)，但是您应该总是尝试消除它们。任何错误都是对您输出的威胁。

#### 为什么我的页面是空白的？

当许多初学者将一个 PHP 页面加载到浏览器中时，却什么也看不到，这让他们摸不着头脑。没有错误信息，只有一个空白页。当有一个解析错误——换句话说，代码中的一个错误——并且`php.ini`中的`display_errors`指令被关闭时，就会发生这种情况。

如果您遵循了前一章中的建议，那么应该在您的本地测试环境中启用`display_errors`。但是，大多数托管公司都关闭了`display_errors`。这有利于安全，但会使远程服务器上的故障排除变得困难。除了解析错误之外，缺少包含文件通常会导致空白页。

通过在页面顶部添加以下代码，可以打开单个脚本的错误显示:

```
ini_set('display_errors', '1');

```

将这段代码放在开始的 PHP 标签后的第一行，或者如果 PHP 在页面下方，则放在页面顶部的一个单独的 PHP 块中。当您上传页面并刷新浏览器时，您应该会看到 PHP 生成的任何错误消息。

如果在添加这行代码后，您仍然看到一个空白页，这意味着您的语法有错误。在打开`display_errors`的情况下本地测试页面，找出导致问题的原因。

Caution

更正错误后，删除显示错误的代码。如果在以后的阶段脚本中出现了其他问题，您不希望在您的 web 站点上暴露潜在的漏洞。

## PHP 快速检查表

这一章包含了很多信息，但是希望它已经给了你一个 PHP 如何工作的广泛概述。以下是一些要点的提示:

*   总是给 PHP 页面正确的文件扩展名，通常是`.php`。

*   将 PHP 代码放在正确的标签之间:`<?php`和`?>`。

*   避免开头标签的缩写形式:`<?`。用`<?php`比较靠谱。

*   在只包含 PHP 代码的文件中省略结束 PHP 标记。

*   PHP 变量以`$`开头，后跟一个字母或下划线字符。

*   选择有意义的变量名，并记住它们区分大小写。

*   使用注释来提醒您脚本的作用。

*   数字不需要引号，但是字符串(文本)需要。

*   小数点是数字中唯一允许的标点符号。

*   您可以在字符串周围使用单引号或双引号，但外部的一对必须匹配。

*   使用反斜杠对字符串中相同类型的引号进行转义。

*   若要将相关项存储在一起，请使用数组。

*   使用条件语句，如`if`和`if . . . else`，进行决策。

*   循环简化了重复性任务。

*   函数执行预设任务。

*   用`echo`或`print`显示 PHP 输出。

*   对于大多数错误信息，从指示的位置向后操作*。*

*   保持微笑——记住 PHP 是*而不是*难的。

下一章将填充一些必要的细节，你可以在阅读本书时参考。