# 2.理解 PHP:语言基础

到目前为止，您已经绕过了创建开发环境的旧的、繁琐的方法，现在可以开始编写代码了。

但是你从哪里开始呢？在这一章中，我将介绍开始使用 PHP 创建强大的动态 web 应用程序需要遵循的步骤。你还将开始发展创建博客所需的基本技能。此外，您将学习如何完成几项任务，包括如何执行以下操作:

*   在网页中嵌入 PHP
*   将数据作为输出发送到浏览器
*   在代码中添加注释
*   使用变量
*   处理 PHP 错误
*   创建 HTML5 模板
*   使用对象
*   连接字符串
*   用`$_GET`超级全局变量访问 URL 变量
*   声明类定义
*   嵌入动态 CSS

在这一章结束时，你将会看到一些基本的 PHP 允许你创建、存储、操作和输出数据。您将使用这些技能开发一个个人投资组合网站的基本版本。

Note

本章讨论了 PHP 语言的基本方面，但不是全部细节。为了澄清，更多的例子，或者为了概念强化，访问 PHP 手册的 [`www.php.net/manual/en/`](http://www.php.net/manual/en/) 并在显示“在函数列表中搜索 _ _ _ _ _ _ _ _ _ 的字段中搜索函数或者，您可以通过导航到 [`http://php.net/function_name`](http://php.net/function_name) 来访问许多 PHP 函数的信息。不要忘记阅读评论，因为你的许多程序员同事在他们的评论中提供了见解、技巧，甚至附加功能。

## 嵌入 PHP 脚本

在第 1 章中，当我谈到 Apache 和 web 服务器时，我提到了服务器如何在将文件发送到浏览器之前处理 PHP 文件。但是您可能会好奇服务器是如何知道在哪里寻找 PHP 的。

默认情况下，服务器只在以扩展名`.php`结尾的文件中寻找 PHP。但是一个`.php`文件可能包含不属于 PHP 脚本的元素，搜索整个文件寻找潜在的脚本是令人困惑和耗费资源的。为了解决这个问题，所有的 PHP 脚本都需要包含 PHP 分隔符。要开始一个 PHP 脚本，您需要包含开始分隔符`<?php`并开始编码。最后，只需在脚本末尾添加`?>`即可。这些分隔符之外的任何内容都将被视为 HTML 或纯文本。

您可以在实践中看到这一点。首先在`/xampp/htdocs/`中创建一个新文件夹`ch2`。接下来，用 Komodo Edit 创建一个新文件`test.php`。编写以下代码:

`<p>Static Text</p>`

`<?php`

`echo "<p>This text was generated by PHP!</p>";`

`?>`

`<p>This text was not.</p>`

保存文件，在浏览器中导航到 http://localhost/ch2/test.php，您应该在浏览器中看到以下输出:

`Static Text`

`This text was generated by PHP!`

`This text was not.`

如您所见，PHP 分隔符内的文本被作为脚本处理，但外部的文本被呈现为常规的 HTML。一个页面中可以包含多少 PHP 代码块没有限制，所以下面的代码片段完全有效:

`<?php`

`echo "<p>This is some text.</p>";`

`?>`

`<p>Some of this text is static, <?php echo "but this sure isn't!"; ?></p>`

`<?php echo "<p>"; ?>`

`This text is enclosed in paragraph tags that were generated by PHP.`

`<?php echo "</p>"; ?>`

前面的代码片段将以下内容输出到浏览器:

`This is some text.`

`Some of this text is static, but this sure isn't!`

`This text is enclosed in paragraph tags that were generated by PHP.`

如果你写了一个 PHP 脚本，除了 PHP 什么都没有，你不需要结束 PHP 分隔符。如果你要在文件中写一些不是 PHP 的东西，你只需要标记一个 PHP 代码块的结尾。

### 使用回声

额外看看前面代码示例中`echo`的用法。PHP 的`echo`是一个所谓的语言构造——PHP 的基本语法单位。`echo`语句可能是从 PHP 向浏览器输出文本的最常见方法。这就是`echo`所做的一切。它将输出发送到浏览器。

请注意，在前面的代码示例中，输出字符串用双引号分隔。第一个双引号表示字符串的开始。第二个双引号标记要输出的字符串的结尾。在 PHP 中，你必须分隔你在代码中使用的任何字符串。字符串分隔符告诉 PHP 一个字符串何时开始和结束，这是 PHP 需要知道的，以便处理您的代码。

Note

字符串是“文本”的一个怪词因为计算机不是人，它不会真的看到文本，更不会看到文字。他们看到字符串。

### 什么是变量？

变量是一个关键字或短语，用作存储在系统内存中的值的标识符。这很有用，因为它允许我们编写对变量值执行一组操作的程序，这意味着您可以简单地通过更改变量来更改程序的输出，而不是更改程序本身。

#### 将值存储在变量中

在变量中存储一个值非常简单。在一行中，您可以声明一个新变量并为其赋值:

`<?php`

`$myName = "Thomas";`

`$friendsName = "Brennan";`

`echo "<p>I am $myName and I have a friend called $friendsName.</p>";`

如果您将前面几行输入到您的`test.php`文件中，并将其加载到您的浏览器中，您应该会看到如下输出:

`I am Thomas and I have a friend called Brennan.`

也许您会注意到，前面的代码只包含 PHP。因此，没有必要用 PHP 分隔符来标记 PHP 代码块的结尾。喜欢的话可以在末尾加`?>`；没什么区别。

#### 变量是一个占位符

变量在编程中被广泛使用。这是一个你必须理解的基本概念。从前面的例子中可以学到重要的一课。当您阅读 PHP 代码时，您会看到变量名:

`echo "<p>I am $myName and I have a friend called $friendsName.</p>";`

您可以在浏览器中看到 PHP 的输出。您可以看到 PHP 用字符串值替换了变量名。比如看到`$myName`，PHP 看到的是托马斯。看到`$friendsName`，PHP 看到的是布伦南。

变量是特定值的占位符。PHP 甚至不会注意到这个变量；它看到存储在里面的值。打个比方，你可以把一个变量理解为一个容器，比如一个杯子。我的电脑旁边有一个杯子，我可以在里面放各种各样的东西:咖啡、一支铅笔或一些零钱。PHP 变量就是这样。PHP 看到的是包含的内容，而不是容器。

Note

用技术术语来说，PHP 变量是通过值传递的，而不是通过引用传递的。

#### 有效的 PHP 变量名

在 PHP 中，所有变量都必须以美元符号字符($)开头。对于有效的变量名还有一些进一步的限制，但是如果您仅仅使用字母字符，您将不会遇到无效变量名的问题。因此，避免空白字符、数字和特殊字符，如！"#€%&/.

Note

你可以在变量名中使用数字，但不能在初始位置使用。因此，`$1a`是一个无效的变量名，而`$a1`是完全有效的。

### 显示 PHP 错误

在学习 PHP 的过程中，您肯定会犯一些错误。当你写了一些错误的 PHP 时，很容易认为你做了坏事。从某种意义上说，这当然是不好的。您可能更喜欢从一开始就编写完美的 PHP。

从另一个意义上说，错误是一件非常好的事情。许多这样的错误提供了一个学习的机会。如果你真正理解了错误的原因，你就不太可能重复它，即使你重复了，如果你理解了，你也可以很容易地纠正错误。

PHP 错误消息并不总是显示出来——这取决于您的开发环境是如何设置的。如果你在脚本的开头写了下面两行 PHP 代码，所有的错误信息都会显示出来。让我们产生一个错误:

`<?php`

`//these two lines tell PHP to show errors in the browser`

`error_reporting( E_ALL );`

`ini_set( "display_errors", 1 );`

`//here comes the error`

`echo "This string never ends;`

你看到错误了吗？只有一个字符串分隔符。要编写有效的 PHP，必须用字符串分隔符将字符串括起来，例如双引号。在前面的例子中，缺少结束分隔符，所以 PHP 看不到输出结束的位置。如果运行该代码，您将在浏览器中看到一条错误消息，如下所示:

`Parse error:``syntax error, unexpected $end, expecting T_VARIABLE or T_DOLLAR_OPEN_CURLY_BRACES or T_CURLY_OPEN in``/Applications/XAMPP/xamppfiles/htdocs/ch2/test.php``on line`T4】

错误消息是友好的，但并不总是像您希望的那样精确。当 PHP 无法处理您的代码时，就会触发一个错误。PHP 将对问题可能是什么做出有根据的猜测。在前面的例子中，PHP 在第 4 行遇到了“意外结束”。你的剧本里有一个“bug”。请通过添加缺少的双引号来调试脚本。

我建议你养成强制显示错误信息的习惯，并尝试阅读你遇到的所有错误信息。如果你遇到一个你不理解的错误信息，你可以在网上搜索解释。像 [`www.stackoverflow.com`](http://www.stackoverflow.com/) 这样的网站很可能会对你的错误信息给出解释。

## 用 PHP 创建 HTML5 页面

PHP 是创建动态 HTML 页面的绝佳语言。只需一点点 PHP，您就可以创建一个有效的 HTML5 页面，在内存中包含可变内容，并让 PHP 将创建的页面输出到浏览器。让我们为个人投资组合网站制作一个基本框架。在`XAMPP/htdocs/ch2`中创建一个名为`index.php`的新 PHP 文件:

`<?php`

`error_reporting( E_ALL );`

`ini_set( "display_errors", 1 );`

`$title = "Test title";`

`$content = "<h1>Hello World</h1>";`

`$page = "`

`<!DOCTYPE html>`

`<html>`

`<head>`

`<title>$title</title>`

`<meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>`

`</head>`

`<body>`

`$content`

`</body>`

`</html>";`

`echo $page;`

如果您在浏览器中保存并加载 http://localhost/ch2/index.php，您应该会看到一个格式良好的 HTML5 页面，带有一个标题和一个标题。检查 PHP 生成的 HTML 页面的源代码是一个好习惯。这样做，您应该会看到变量已经被 PHP 替换为相应的值。HTML 源代码应该如下所示:

`<!DOCTYPE html>`

`<html>`

`<head>`

`<title>Test title</title>`

`<meta http-equiv='Content-Type' content='text/html;charset=utf-8' />`

`</head>`

`<body>`

`Hello World</h1>`

`</body>`

`</html>`

### 包括一个简单的页面模板

用 PHP 创建一个有效的 HTML5 页面是一个非常非常普通的任务。理解前面的代码应该没什么问题。让我们尝试以一种更容易在其他项目中重用的方式创建相同的输出。如果您可以在其他项目中重用您的代码，您就可以更快、更有效地开发解决方案。让我们将 HTML5 页面模板保存在一个单独的文件中。

在现有的 PHP 项目中创建一个名为`templates`的新文件夹。在 templates 文件夹中创建一个名为`page.php`的新 PHP 文件，如下所示:

`<?php`

`return "<!DOCTYPE html>`

`<html>`

`<head>`

`<title>$title</title>`

`<meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>`

`</head>`

`<body>`

`$content`

`</body>`

`</html>";`

### 返回值

PHP 中的`return`语句非常有用。它只是停止脚本的执行。将返回紧跟在`return`语句之后的任何值。在前面的示例中，将返回一个有效的 HTML5 页面。

### 包括模板

要使用索引中的模板，您必须将脚本加载到 PHP 的内存中。您可以用另一个 PHP 语句来做这件事:`include_once`。更新您的`index.php`文件，如下所示:

`<?php`

`//complete code for index.php`

`error_reporting( E_ALL );`

`ini_set( "display_errors", 1 );`

`$title = "Test title";`

`$content = "<h1>Hello World</h1>";`

`//indicate the relative path to the file to include`

`$page = include_once "templates/page.php";`

`echo $page;`

上述代码的输出将与您第一次创建页面时的输出相同。没有功能上的变化，但是在代码架构上有一些美学上的变化。可重用的页面模板现在保存在一个单独的文件中。需要时，模板包含在`index.php`中。我们实际上是将代码的不同部分拆分到不同的文件中。结果是更多的代码可以在其他项目中重用。这个分离不同部分的过程也称为关注点分离。

### 注释您的代码

在代码中写注释对你的学习过程很有帮助。这样的注释应该提醒你代码做了什么以及为什么。用你自己的语言解释代码会加快你的学习过程。此外，如果您发现自己与一组开发人员一起工作，代码注释将帮助您有效地协作，因为您可以将注释作为代码注释写给共同开发人员。

#### 块注释和单行注释

您可以在代码中编写注释。注释可以提醒你和其他阅读你的代码的人，代码的不同部分是做什么的。您必须清楚地界定注释，这样 PHP 就不会试图将注释解释为实际的产品代码。你应该知道用 PHP 编写代码注释的两种方式:块注释和单行注释。

`<?php`

`//this is a single-line comment`

`/*`

`This is a comment block`

`It may span across`

`several lines`

`*/`

### 避免命名冲突

你很快就会发现自己用数百行代码编写 PHP 项目。您将需要许多变量，每个变量都必须有唯一且有意义的名称。您必须避免命名冲突，如下例所示:

`<?php`

`$title = "Welcome to my blog";`

`/*`

`hundreds lines of code later`

`*/`

`$title = "Web developer";`

看到问题了吗？最初，名为`$title`的变量用于指示 HTML 页面的`<title>`元素的值。很久以后，在同一个系统中，一个名为`$title`的变量被用来存储职位名称。具有这种变量名的系统易受攻击。使用该变量时，您可能会看到不需要的系统行为。更好的解决方案是清楚地指出`$title`的上下文。一种方法是使用对象。

`<?php`

`$pageData = new StdClass();`

`$pageData->title = "Welcome to my blog";`

`/*`

`hundreds lines of code later`

`*/`

`$jobData = new StdClass();`

`$jobData->title = "Web developer";`

您可以通过使用 PHP 的 native `StdClass`创建一个新的标准 PHP 对象。PHP 对象就像一个变量，它可以存储值。一个普通的 PHP 变量可以存储一个值。一个对象可以存储任意多的值。每个单独的值都可以存储为唯一的对象特性。

在前面的代码示例中，您可以看到两个不同的对象，每个对象都有一个 title 属性。应该清楚的是，`$pageData->title`不同于`$jobData->title`，即使两个属性都被命名为`title`。

该对象提供了一个上下文，这将使您更容易在代码中的正确位置使用正确的标题。您可以使用对象将代码组织成有意义的单元。你可以说一个对象和它的属性很像一个文件夹和里面的文件。

Note

对象的意义远不止于此——远不止于此。在代码中使用对象是处理系统复杂性的事实标准，不会在代码中引入不必要的复杂性。在整本书中，你会学到更多关于用对象编程的知识。

#### 对象运算符

通过提供清晰的上下文，对象可以用作属性的命名空间，以避免命名冲突。要从对象属性中获取值，您必须指定两件事:要获取哪个对象及其属性。为此，您使用 PHP 的对象操作符。一般语法如下所示:

`$objectName->propertyName;`

PHP 的对象操作符看起来像一个箭头。它表示您正在获取特定对象中的特定属性。

#### 对页面数据使用 StdClass 对象

让我们用一个对象重构`index.php`和页面模板，以防止烦人的命名冲突。以下是`index.php`的一些变化:

`<?php`

`//complete code for index.php`

`error_reporting( E_ALL );`

`ini_set( "display_errors", 1 );`

`$pageData = new stdClass();`

`$pageData->title = "New, object-oriented test title";`

`$pageData->content = "<h1>Hello from an object</h1>";`

`$page = include_once "templates/page.php";`

`echo $page;`

您还必须更新`templates/page.php`，以便它在正确的位置使用新创建的对象及其属性:

`<?php`

`return "<!DOCTYPE html>`

`<html>`

`<head>`

`<title>``$pageData->title`T2】

`<meta http-equiv='Content-Type' content='text/html;charset=utf-8' />`

`</head>`

`<body>`

`$pageData->content`

`</body>`

`</html>";`

保存文件并在浏览器中重新加载`index.php`。期望在`<title>`和`<body>`元素中看到改变的值。

#### 对象属性就像变量一样

普通 PHP 变量是值的简单占位符。对象显然更复杂，因为一个对象可以保存几个值。前面的`StdClass`对象保存两个独立的值。每个值都存储在唯一的对象特性中。对象属性的行为类似于 PHP 变量。它们是值的简单占位符。一个对象可以有许多属性。每个属性可以包含一个值。在前面的示例中，您可以看到，为了获取值，您必须同时指定对象和属性。

PHP 属性可以理解为 cups。它们所包含的价值可以理解为杯子里的咖啡(或任何东西)。打个比方，你可以把一个对象看作一个托盘，把它的属性看作托盘上的几个杯子。要得到你的咖啡，你必须从正确的托盘中得到正确的杯子。

在前面的代码示例中，您可以看到在`<title>`中使用了`$pagedata`对象的`title`属性，在`<body>`元素中使用了`$pageData`对象的`content`属性。

## 页面视图

一个个人作品集网站可能会有几个不同的页面。也许一页是关于你的技能和教育背景，另一页是你工作实例的链接。

因为您正在创建一个动态网站，所以您不必创建两个完整的 HTML 页面。您可以使用页面模板显示两种不同的页面视图。页面视图是看起来像单个页面的东西。一个页面视图可能由几个较小的视图组成。你可以把一个页面视图想象成一个乐高房子，把一个视图想象成一个乐高积木:把较小的部分组合起来，就可以建造出更大的东西。

让我们将所有视图保存在一个文件夹中。在现有的项目文件夹中创建一个名为`views`的新文件夹。创建一个新文件，`views/skills.php`。

`<?php`

`return "<h1>Skills and educational background</h1>`

`<p>Read all about my skills and my formal training</p>`

`";`

这是完整的文件。这是一个非常小的观点。开发代码时，从小处着手通常是个好主意。任何潜在的错误都将更容易在更少的代码行中被发现。您需要在`views/projects.php`中查看另一个小视图。

`<?php`

`return "<h1>Projects I have worked on</h1>`

`<ul>`

`<li>Ahem, this will soon be updated</li>`

`</ul>";`

### 制作动态网站导航

你必须在正确的时间展示正确的观点。您可以创建一个全局的、持久的站点导航，即，在网站的每个页面上都是相同的导航。因为 PHP 可以包含文件，所以您可以简单地将导航代码保存在一个文件中，并在每个需要它的脚本中包含它。一个明显的优点是你可以在一个文件中改变导航，这种改变会反映在每个站点页面上，不管有多少个页面。在`views/navigation.php`中创建一个新文件。

`<?php`

`return "`

`<nav>`

`<a href='index.php?page=skills'>My skills and background</a>`

`<a href='index.php?page=projects'>Some projects</a>`

`</nav>`

`";`

注意，整个导航字符串用双引号分隔。使用单引号来分隔`href`属性值，因此，不能在导航字符串中使用双引号。第三个双引号将触发 PHP 错误。所以你。

要查看索引页面上的导航，您必须从`index.php`开始包含它。

`<?php`

`//complete code for index.php`

`error_reporting( E_ALL );`

`ini_set( "display_errors", 1 );`

`$pageData = new stdClass();`

`//changes begin here`

`$pageData->title = "Thomas Blom Hansen: Portfolio site";`

`$pageData->content = include_once "views/navigation.php";`

`//end of changes`

`$page = include_once "templates/page.php";`

`echo $page;`

保存并运行这段代码，您应该会看到一个带有导航的页面。现在还不要期望看到任何视图。

### 用 PHP 传递信息

传递数据是区分动态网页和静态网页的关键。通过根据用户的选择定制体验，您可以为网站增加全新的价值。可以通过 URL 变量将信息传递给 PHP。URL 变量就是在 URL 中声明的变量。您可以在导航中看到两个 URL 变量。仔细看看导航`<a>`元素中的`href`属性。

`index.php?page=skills`

`index.php?page=projects`

`href`表示点击导航项将加载`index.php`并编码一个名为`page`的 URL 变量。如果你点击一个链接，名为`page`的 URL 变量将得到一个值`skills`。如果点击另一个链接，`page`会得到一个值`projects`。

PHP 可以访问 URL 变量并使用它们，例如，在正确的时间加载正确的页面视图。URL 变量是动态网站的生命线。

### 访问 URL 变量

要访问 URL 变量，可以使用`$_GET`超全局数组。以下是您在`index.php`中如何使用它:

`<?php`

`error_reporting( E_ALL );`

`ini_set( "display_errors", 1 );`

`$pageData = new stdClass();`

`$pageData->title = "Thomas Blom Hansen: Portfolio site";`

`$pageData->content = include_once "views/navigation.php";`

`//changes begin here`

`$navigationIsClicked = isset($_GET['page']);`

`if ($navigationIsClicked ) {`

`$fileToLoad = $_GET['page'];`

`$pageData->content .= "<p>Will soon load $fileToLoad.php</p>";`

`}`

`//end of changes`

`$page = include_once "templates/page.php";`

`echo $page;`

那是相当多的一口！PHP 可以通过`$_GET`访问 URL 变量。要访问名为`page`的 URL 变量的值，您需要编写`$_GET['page']`。只有当用户点击了一个导航项目时，才会有一个名为`page`的 URL 变量。

### 使用 isset()测试变量是否已设置

如果你试图使用一个不存在的变量，你将触发一个 PHP 错误。所以，在你试图访问一个变量之前，你必须确保这个变量已经设置好了。PHP 为此构建了一种语言。您已经看到了它的作用。

`$navigationIsClicked = isset($_GET['page']);`

如果括号内的变量被设置，`isset()`函数将返回`TRUE`。所以，如果用户点击了一个导航项，`$navigationIsClicked`将会是`TRUE`；如果不是，那就是`FALSE`。

如果`$navigationIsClicked`是`TRUE`，那么声明一个名为`$fileToLoad`的 PHP 变量，来存储名为`page`的 URL 变量的值。接下来，向`$pageData->content`属性添加一个字符串，以显示名为`page`的 URL 变量的值。保存并运行代码。在浏览器中加载后，单击“我的技能”导航项目。这应该会在您的浏览器中产生以下输出:

`Will soon load skills.php`

如果您单击另一个导航项目，您可以看到输出的变化。您会看到，根据用户与站点的交互方式，输出会动态变化。

### $_GET，一个超全局数组

PHP 可以通过一个叫做`$_GET`的所谓超全局数组来访问 URL 变量。PHP 还有一些用于其他目的的超全局数组。使用`$_GET`，您可以通过名称访问 URL 变量。在导航中，你有两个`<a>`元素。单击其中任何一个都会为一个名为`page`的 URL 变量编码一个唯一的值。

在图 [2-1](#Fig1) 中可以看到浏览器地址栏中的一个 URL 变量。注意 URL 变量`page`的值在输出中是如何表示的？要用 PHP 获取 URL 变量的值，您需要编写

`$_GET['the name of the url variable'];`

![A978-1-4302-6814-7_2_Fig1_HTML.jpg](A978-1-4302-6814-7_2_Fig1_HTML.jpg)

图 2-1。

A URL variable in action

### 动态包含页面视图

动态站点导航即将完成。它工作得很好，除了当导航项目被点击时页面视图没有被加载。让我们通过更新`index.php`中的代码来改变这一点，如下所示:

`<?php`

`error_reporting( E_ALL );`

`ini_set( "display_errors", 1 );`

`$pageData = new stdClass();`

`$pageData->title = "Thomas Blom Hansen: Portfolio site";`

`$pageData->content = include_once "views/navigation.php";`

`$navigationIsClicked = isset($_GET['page']);`

`if ($navigationIsClicked ) {`

`$fileToLoad = $_GET['page'];`

`//change one line to load page views dynamically`

`$pageData->content .=include_once "views/$fileToLoad.php";`

`}`

`$page = include_once "templates/page.php";`

`echo $page;`

保存更改并在浏览器中重新加载`index.php`。当您单击一个导航项目时，您会看到输出发生了变化。将加载并显示相应的页面视图。是您的`index.php`文件动态地改变了它的外观。名为`page`的 URL 变量将决定加载哪个文件。

就是这样！这是一个基本的，动态的网站，具有持久的，全球性的导航。

### 串联

你注意到上面代码中的`.=`了吗？它是 PHP 的增量连接运算符，和基本赋值运算符`=`有一点不同。

这里有一个例子来说明不同之处:

`<?php`

`$test = "<p>Hello ";`

`$test = "world</p>";`

`echo $test;`

`$concatenationTest = "<p>Hello ";`

`$concatenationTest .= "world</p>";`

`echo $concatenationTest;`

上例的 HTML 源代码输出清楚地显示了赋值和增量连接之间的区别。

`world</p>`

`<p>Hello world</p>`

赋值操作符为变量赋值一个新的字符串值，并覆盖该过程中任何以前的字符串。因此，变量`$test`中的初始`"<p>Hello "`被覆盖。

增量连接操作符将`$concatenationTest`中的现有字符串与一个新字符串合并。增量串联在现有字符串的末尾添加新字符串。

### 严格的命名约定

很高兴看到你的第一个动态网站工作，不是吗？它是可行的，并且依赖于严格的命名约定。导航项目为名为`page`的 URL 变量编码不同的值。相应的页面视图文件必须同名，并保存在`views`文件夹中。

<colgroup><col> <col> <col></colgroup> 
| 超链接 | 可变 URL | 视图文件 |
| --- | --- | --- |
| index.php？page =技能 | page =技能 | view/skills . PHP |
| index.php？页面=项目 | 页面=项目 | views/projects.php |

### 显示默认页面

动态导航非常好用，但是它有一个缺点:当用户导航到`index.php`时，没有显示默认的页面视图，在这种情况下，名为`page`的 URL 变量没有值。在`index.php`很容易改变。您只需稍微改变一下`if`语句。

`//partial code for index.php`

`if ($navigationIsClicked ) {`

`$fileToLoad = $_GET['page'];`

`} else {`

`$fileToLoad = "skills";`

`}`

`$pageData->content .=include_once "views/$fileToLoad.php";`

显著的变化是`$fileToLoad`从 URL 变量`page`中获取它的值，如果设置了的话。如果没有设置，`$fileToLoad`将有一个默认值`skills`。一旦`$fileToLoad`有了值，你就可以用它来加载用户请求的页面视图或者关于“我的技能”的默认页面视图

## 验证您的 HTML

生成 HTML 页面的过程有点抽象。如果在正确的时间显示正确的页面视图，很容易认为一切都是完美的。如果你看到了正确的动作，你的 PHP 脚本就会完美地工作。但这并不意味着你的 HTML 是完全有效的。动态网页应该符合 web 标准，就像静态 HTML 页面一样。您应该像验证任何其他 HTML 一样验证生成的 HTML。

Note

您可以在浏览器中加载一个动态页面，并通过浏览器查看生成的 HTML 源代码。当您看到生成的 HTML 源代码时，您可以选择它，复制它，并将其粘贴到在线 HTML 验证服务中。我一般用 [`http://validator.w3.org/#validate_by_input`](http://validator.w3.org/#validate_by_input) 。

## 用 CSS 设计网站样式

当所有页面视图的 HTML 都有效时，你就可以开始用 CSS 来设计你的站点了。您完全可以像通常样式化静态 HTML 站点那样做:为站点的视觉设计创建一个带有样式规则的外部样式表。为了对 portfolio 站点进行这样的操作，您可以在您的项目文件夹中创建一个名为`css`的新文件夹。在`css`文件夹中创建一个名为`layout.css`的新文件:

`nav {`

`background-color: #CCCCDE;`

`padding-top: 10px;`

`}`

`nav a{`

`display:inline-block;`

`text-decoration:none;`

`color: #000;`

`margin-left: 10px;`

`}`

`nav a:hover{text-decoration: underline;}`

您可以更改或添加您喜欢的任何样式规则。前面的`css`只是让你开始。您可能想要设计所有动态 HTML 页面的样式，那么为什么不将这个功能构建到页面模板中呢？您只需为指向外部样式表的`<link>`元素添加一个新的占位符。让我们更新`templates/page.php`:

`<?php`

`return "<!DOCTYPE html>`

`<html>`

`<head>`

`<title>$pageData->title</title>`

`<meta http-equiv='Content-Type' content='text/html;charset=utf-8' />`

`$pageData->css`

`</head>`

`<body>`

`$pageData->content`

`</body>`

`</html>";`

注意，新属性被用作引用外部样式表的`<link>`元素的占位符。要使用更新的页面模板，您必须更新`index.php`并为新属性声明一个值:

`<?php`

`//partial code listing for index.php`

`error_reporting( E_ALL );`

`ini_set( "display_errors", 1 );`

`$pageData = new stdClass();`

`$pageData->title = "Thomas Blom Hansen: Portfolio site";`

`$pageData->content = include_once "views/navigation.php";`

`//one line of code added here`

`$pageData->css = "<link href='css/layout.css' rel='stylesheet' />";`

保存文件并在浏览器中加载`index.php`。期待看到你的风格规则生效。

## 声明 Page_Data 类

有时，使用内部的嵌入式样式表来补充外部样式表会非常有用。您可以很容易地用一个`<style>`元素的占位符来更新页面模板。更新`templates/page.php`。

`<?php`

`return "<!DOCTYPE html>`

`<html>`

`<head>`

`<title>$pageData->title</title>`

`<meta http-equiv='Content-Type' content='text/html;charset=utf-8' />`

`$pageData->css`

`$pageData->embeddedStyle`

`</head>`

`<body>`

`$pageData->content`

`</body>`

`</html>";`

从`index.php`声明一个属性值同样容易，但是让我们做一些不同的事情。问题是有时你不需要任何嵌入的`<style>`元素，而有时你需要。

既然您的模板有了一个用于嵌入 CSS 的占位符，那么该属性必须始终有一个值。你不想浪费时间为一个多余的`<style>`元素声明一个值，所以让我们做一个更智能的解决方案。让我们朝着面向对象编程迈出下一步，为页面数据创建一个自定义类。在您的项目文件夹中创建一个名为`classes`的新文件夹。在`classes`文件夹中创建一个名为`Page_Data.class.php`的新文件。

`<?php`

`class Page_Data {`

`public $title = "";`

`public $content = "";`

`public $css = "";`

`public $embeddedStyle = "";`

`}`

就是这样—一个定制的类，为页面模板所需的属性预定义了空字符串值。关键字`class`表示后面的名称是自定义类名。

PHP 类名可以以字母或下划线开头。习惯上以大写字母开头。如果类名是一个复合词，通常用下划线字符分隔各个单词，并以大写字母开始下一个单词，例如`My_Custom_Class_Name`。

我通常将我的每个自定义 PHP 类定义保存在一个单独的文件中，其名称类似于类名。我也喜欢用可选的后缀`.class.php`来结束文件名。因此，`My_Custom_Class_Name`的文件将被称为`My_Custom_Class_Name.class.php`。

在类名后面是一组花括号，用来为类定义划分代码块。看一下`Page_Data`的代码块。在花括号内，使用关键字`public`声明了四个属性。结果是`Page_Data`类将会有四个默认属性，每个属性都声明了一个默认值。

### 类制造对象

您可以使用来自`index.php`的新类定义。这将是一个微小的变化。更新`index.php`如下:

`//Partial code listing for index.php`

`include_once "classes/Page_Data.class.php";`

`$pageData = new Page_Data();`

`//delete or comment out the previous object`

`//$pageData = new stdClass();`

`//no changes below this point`

在浏览器中加载 http://localhost/ch2/index.php，以测试您的代码。您的网站应该完全像以前一样工作。你知道你对代码做了一些改动，但是这些改动普通用户是看不到的。您已经重构了代码。

要使用自定义的类，必须首先包含类定义。接下来，您必须使用`new`关键字用类定义创建一个新对象。`Page_Data`类使我们能够在页面模板中为嵌入的样式保留一个占位符，并且只要您需要一个带有嵌入的`<style>`元素的页面，就只为该属性分配一个实际值。

### 用动态样式规则突出显示当前导航项目

您有一个页面模板和一个`Page_Data`对象，它们准备好处理嵌入的样式。您通常希望将样式规则保存在外部样式表中。对于动态网站，这个约定仍然适用，但是因为您可以将样式嵌入到`index.php`中，所以您可以很容易地使用动态样式。大多数时候，好的 ole 外部样式表可以很好地完成工作。但是在少数情况下，动态样式非常强大。您可以使用动态样式规则来突出显示当前导航项目。这真的很简单，一旦你明白了。更新`index.php`如下:

`<?php`

`//complete code listing for index.php`

`error_reporting( E_ALL );`

`ini_set( "display_errors", 1 );`

`include_once "classes/Page_Data.class.php";`

`$pageData = new Page_Data();`

`$pageData->title = "Thomas Blom Hansen: Portfolio site";`

`$pageData->content = include_once "views/navigation.php";`

`$pageData->css = "<link href='css/layout.css' rel='stylesheet' />";`

`$navigationIsClicked = isset($_GET['page']);`

`if ($navigationIsClicked ) {`

`$fileToLoad = $_GET['page'];`

`} else {`

`$fileToLoad = "skills";`

`}`

`$pageData->content .=include_once "views/$fileToLoad.php";`

`//new code below: dynamic style added below`

`$pageData->embeddedStyle = "`

`<style>`

`nav a[href *= '?page=$fileToLoad']{`

`padding:3px;`

`background-color:white;`

`border-top-left-radius:3px;`

`border-top-right-radius:3px;`

`}`

`</style>";`

`$page = include_once "templates/page.php";`

`echo $page;`

保存您的工作并将索引加载到浏览器中。您应该会看到一个简单的选项卡式导航，当前导航项目清晰地突出显示。在下面的例子中，我点击了“一些项目”导航项。由于突出显示的导航选项卡，用户可以清楚地看到显示的是哪个页面。你可以在图 [2-2](#Fig2) 中看到我的例子。

你懂一些 PHP，所以你知道这一切的发生是因为名为`page`的 URL 变量有一个值`skills`。它可能还不是一个很好的视觉设计，但是它应该足够让你应用你所有的 CSS 技能来设计一个漂亮的用户界面。

![A978-1-4302-6814-7_2_Fig2_HTML.jpg](A978-1-4302-6814-7_2_Fig2_HTML.jpg)

图 2-2。

Current navigation item highlighted with a dynamic style rule

#### 仔细看看动态 CSS

所使用的 CSS 属性选择器并不常用。让我们仔细看看。

`nav a[href *= '?page=$fileToLoad']`

首先，注意 PHP 变量`$fileToLoad`。它是实际值的占位符。例如，当用户点击“一些项目”导航项时，`$fileToLoad`的值为`projects`，因为名为`page`的 URL 变量的值为`projects`。你可以在上图浏览器截图的地址栏看到。因此，当浏览器解释 CSS 时，它实际上会看到以下内容:

`nav a[href *= '?page=projects']`

选择器告诉浏览器类似“寻找一个`<nav>`元素，在这个元素中你会找到一个`<a>`元素，它的`href`属性包含字符串`?page=projects`

假装你是浏览器。看看你的`<nav>`元素。寻找一个具有包含`?page=projects`的`href`属性的`<a>`元素。

您和浏览器将只找到一个这样的`<a>`元素。浏览器将对这个`<a>`元素应用一个特殊的样式规则，这个规则将突出显示这个元素。

## 摘要

现在您已经看到了如何使用一点基本的 PHP 来构建一个非常动态的站点。在这一点上，你的学习过程可能会受益于一些实验。

你可以尝试建立一个个人作品集网站。添加您认为合适的页面视图，并相应地更新您的导航。

你可以尝试创建一些更全面的页面视图。在这个过程中，你会逐渐适应动态站点结构，页面视图会返回到`index.php`上显示。

你可以利用你现有的 CSS 技能为你的作品集开发一个一致的网站设计。在这个动态网站的新环境中使用你现有的 HTML 和 CSS 技能将是一个非常好的练习。这对你来说可能相对容易，因为作品集网站相当简单。在你工作的网站很简单的时候做这个练习是个好主意。你开发的动态网站很快就不再简单了。

当你觉得准备好了，翻页学习 HTML 表单、PHP 函数和条件语句，所有这些你都会在第 3 章中遇到。