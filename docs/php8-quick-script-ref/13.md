# 13.常数

一个*常量*是一个变量，它的值不能被脚本改变。因此，必须在创建常数的同时分配这样的值。PHP 提供了两种创建常量的方法:`const`修饰符和`define`函数。

## 常数

`const`修饰符用于创建类常量。与常规属性不同，类常量没有指定的访问级别，因为它们总是公开可见的。它们也不使用美元符号解析器标记(`$`)。常量的命名约定都是大写，用下划线分隔每个单词。

```
class MyCircle
{
  const PI = 3.14;
}

```

常量在创建时必须赋值。像静态属性一样，常量只能用常量值初始化，而不能用表达式或变量初始化。类常量的引用方式与静态属性相同，只是它们不使用美元符号。

```
echo MyCircle::PI; // "3.14"

```

`const`修饰符可能不适用于局部变量或参数。但是，从 PHP 5.3 开始，`const`可以用来创建全局常量。这种常量是在全局范围内定义的，可以在脚本中定义它之后的任何地方访问。

```
const PI = 3.14;
echo PI; // "3.14"

```

## 规定

`define`函数可以创建全局和局部常量，但不能创建类常量。这个函数的第一个参数是常量的名称，第二个参数是它的值。

```
define('DEBUG', 1);

```

就像用`const`创建的常量一样，`define`常量在使用时没有美元符号，它们的值不能修改。

```
echo DEBUG; // "1"

```

像用`const`生成的常量一样，`define`的值可以是任何标量数据类型:整数、浮点数、字符串或布尔值。然而，与`const`不同的是，`define`函数允许在赋值中使用表达式，比如变量或数学表达式的结果。

```
define('ONE', 1);     // 1
define('TWO', ONE+1); // 2

```

默认情况下，常量区分大小写。然而，`define`函数接受第三个可选参数，该参数可以设置为`true`来创建一个不区分大小写的常量。

```
define('DEBUG', 1, true);
echo debug; // "1"

```

要检查常量是否已经存在，可以使用`defined`功能。该功能适用于用`const`或`define`创建的常量。

```
if (!defined('PI'))
  define('PI', 3.14);

```

PHP 7 使得使用`define`函数创建常量数组成为可能。对用`const`创建的常量数组的支持从 PHP 5.6 开始就存在了。

```
const CA = [1, 2, 3];    // PHP 5.6 or later
define('DA', [1, 2, 3]); // PHP 7 or later

```

## 构建和定义

`const`修饰符创建了一个编译时常量，所以编译器用它的值替换了常量的所有用法。相反，`define`创建一个运行时常量，直到运行时才设置。这就是为什么定义常量可以被赋予表达式值，而`const`需要在编译时已知的常量值。

```
const PI = 3.14;   // compile-time constant
define('E', 2.72); // run-time constant

```

只有`const`可用于类常量，只有`define`可用于局部常量。然而，当创建全局常量时，`const`和`define`都是允许的。在这些情况下，使用`const`通常更好，因为编译时常数比运行时常数稍快。主要的例外是当常量是有条件定义的，或者需要一个表达式值时，在这种情况下必须使用`define`。

## 不变准则

通常，如果常量的值不需要更改，那么创建常量而不是变量是一个好主意。这确保了脚本中的变量不会被错误地更改，从而有助于防止错误。

## 魔法常数

PHP 提供了八个预定义的常量，如表 [13-1](#Tab1) 所示。这些被称为*魔法常数*，因为它们的值会随着使用场合的不同而变化。

表 13-1

魔法常数

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"></colgroup> 
| 

名字

 | 

描述

 |
| --- | --- |
| __ 行 _ _ | 文件的当前行号。 |
| __FILE__ | 文件的完整路径和文件名。 |
| __DIR__ | 文件的目录。 |
| __ 函数 _ _ | 函数名。 |
| __CLASS__ | 包括命名空间的类名。 |
| __ 特征 _ _ | 包括名称空间的特征名称。 |
| __ 方法 _ _ | 类方法名。 |
| __ 名称空间 _ _ | 当前名称空间。 |

幻常数对于调试特别有用。例如，`__LINE__`的值取决于它出现在脚本中的哪一行。

```
if(!isset($var))
{
  echo '$var not set on line ' . __LINE__;
}

```