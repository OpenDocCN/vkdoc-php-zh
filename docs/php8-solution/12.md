# 12.数据库入门

与数据库相结合，动态网站有了全新的含义。从数据库中提取内容使您能够以静态网站无法实现的方式呈现材料。浮现在脑海中的例子有网店，比如`Amazon.com`；新闻网站，如 BBC([`www.bbcnews.com`](http://www.bbcnews.com))；以及大型搜索引擎，包括谷歌和必应。数据库技术允许这些网站呈现数千个，通常是数百万个独特的页面。即使你的野心没有那么大，一个数据库也可以不费吹灰之力增加网站内容的丰富性。

PHP 支持所有主流数据库，包括 Microsoft SQL Server、Oracle 和 PostgreSQL，但它最常与开源 MySQL 数据库结合使用。根据 DB-Engines ( [`https://db-engines.com/en/ranking`](https://db-engines.com/en/ranking) )，MySQL 在 2021 年年中被列为第二大最广泛使用的数据库，它已经保持了多年。然而，围绕 MySQL 的未来存在争议，谷歌和维基媒体已经放弃了 MySQL，转而支持 MariaDB ( [`https://mariadb.org/`](https://mariadb.org/) )，后者在数据库引擎排名中排名第 12。几个领先的 Linux 发行版也用 MariaDB 取代了 MySQL。本章首先简要讨论了这两个数据库之间竞争的含义。

在本章中，您将了解以下内容:

*   了解数据库如何存储信息

*   选择图形界面与数据库交互

*   创建用户帐户

*   用适当的数据类型定义数据库表

*   备份数据并将数据传输到另一台服务器

## MySQL 还是 MariaDB？

MySQL 最初是由瑞典的 MySQL AB 作为一个免费的开源数据库开发的。它很快在个人开发者中流行起来，并被主要参与者采用，如维基百科和 BBC 新闻。然而，MySQL AB 在 2008 年被出售给 Sun Microsystems，该公司在两年后被主要的商业数据库供应商 Oracle 收购。许多人认为这威胁到了 MySQL 作为一个免费开源数据库的持续生存。甲骨文曾公开表示“MySQL 是甲骨文完整、开放和集成战略的一部分。”但这并没有给 MySQL 的创始人之一 Michael“Monty”wide nius 留下什么印象，他指责甲骨文从 MySQL 中删除了一些功能，并且在修复安全问题上行动迟缓。

由于 MySQL 代码是开源的，Widenius 将其分叉以创建 MariaDB，它被描述为“MySQL 的增强替代产品。”从那以后，MariaDB 开始实现自己的新特性。尽管中断了，这两个数据库系统实际上是可以互换的。MariaDB 可执行文件使用与 MySQL 相同的名称(在 macOS 和 Linux 上使用`mysqld`，在 Windows 上使用`mysqld.exe`)。主特权表也被称为`mysql`，默认的存储引擎将自己标识为 InnoDB，尽管它实际上是 InnoDB 的一个分支，名为 Percona XtraDB。

就本书中的代码而言，使用 MariaDB 还是 MySQL 应该没什么区别。MariaDB 理解所有 MySQL 特有的 PHP 代码。MySQL 的 phpMyAdmin 图形界面也支持它，我将在后面的章节中使用它。

Note

为了避免不断重复，您应该假设所有对 MySQL 的引用同样适用于 MariaDB，除非我特别提到了 MariaDB。

## 数据库如何存储信息

关系数据库(如 MySQL)中的所有数据都存储在表中，非常类似于电子表格，信息组织成行和列。图 [12-1](#Fig1) 显示了您将在本章稍后构建的数据库表，如 phpMyAdmin 中所示。

![../images/332054_5_En_12_Chapter/332054_5_En_12_Fig1_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Fig1_HTML.jpg)

图 12-1

数据库表像电子表格一样以行和列的形式存储信息

每个**列**都有一个名称(`image_id`、`filename`和`caption`)，表明它存储的内容。

这些行没有被标记，但是第一列(`image_id`)包含一个唯一的值，称为**主键**，它标识与该行相关的数据。每行包含一个单独的**记录**的相关数据。

存储数据的行和列的交叉点称为**字段**。例如，图 [12-1](#Fig1) 中第三条记录的`caption`字段包含值“京都金阁”，该记录的主键是 3。

Note

术语“字段”和“列”经常互换使用，尤其是在 phpMyAdmin 的旧版本中。字段为单个记录保存一条信息，而列为所有记录包含相同的字段。

### 主键如何工作

尽管图 [12-1](#Fig1) 将`image_id`显示为从 1 到 8 的连续序列，但它们不是行号。图 [12-2](#Fig2) 显示了标题按字母顺序排序的相同表格。图 [12-1](#Fig1) 中高亮显示的字段已经移动到第七行，但是它仍然有相同的`image_id`和`filename`。

![../images/332054_5_En_12_Chapter/332054_5_En_12_Fig2_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Fig2_HTML.jpg)

图 12-2

主键标识行，即使表是以不同的顺序排序的

虽然很少显示主键，但它标识记录和存储在其中的所有数据。一旦知道了记录的主键，就可以更新、删除它，或者用它在单独的页面中显示数据。不要担心你如何找到主键。使用**结构化查询语言** (SQL)很容易做到，这是与所有主要数据库通信的标准手段。要记住的重要事情是为每条记录分配一个主键。

Tip

有些人将 SQL 发音为“sequel”其他人把它拼成“ess-queue-ell”MySQL 的官方发音是“My-ess-queue-ell”

*   主键不必是数字，但*必须是唯一的*。

*   产品号是很好的主键。它们可能由数字、字母和其他字符组成，但总是唯一的。社会保障和员工 ID 号也是唯一的，但可能会导致个人数据泄露，因为在检索或更新数据时，主键会附加到查询字符串中。

*   MySQL 可以自动为你生成一个主键。

*   一旦分配了主键，它就不应该重复，也不应该更改。

因为主键必须是唯一的，所以当记录被删除时，MySQL 通常不会重用这个数字。尽管这在序列中留下了间隙，但这并不重要。主键的目的是识别记录。任何填补空白的尝试都会给数据库的完整性带来严重的风险。

Tip

有些人希望消除序列中的间隔，以便跟踪表中的记录数。这是不必要的，你将在下一章中发现。

### 用主键和外键链接表

与电子表格不同，大多数数据库将数据存储在几个较小的表中，而不是一个大表中。这可以防止重复和不一致。假设你正在建立一个你最喜欢的引语的数据库。与其每次都键入作者的名字，不如将作者的名字放在一个单独的表中，并在每次引用时存储一个对作者主键的引用，这样效率会更高。正如你在图 [12-3](#Fig3) 中看到的，左边表格中用`author_id 32`标识的每一条记录都是引用自威廉·莎士比亚的话。

![../images/332054_5_En_12_Chapter/332054_5_En_12_Fig3_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Fig3_HTML.jpg)

图 12-3

外键用于链接存储在不同表中的信息

因为名称只存储在一个地方，所以它保证拼写总是正确的。如果您确实犯了拼写错误，只需进行一处更正，就可以确保更改在整个数据库中得到反映。

将一个表中的主键存储在另一个表中被称为创建一个**外键**。使用外键来链接不同表中的信息是关系数据库最强大的方面之一。在早期阶段也很难掌握，所以我们将使用单个表，直到第 [17](17.html) 和 [18](18.html) 章，这两章详细介绍了外键。同时，请记住以下几点:

*   当用作表的主键时，该值在列中必须是唯一的。所以图 [12-3](#Fig3) 右侧表格中的每个`author_id`只使用一次。

*   当用作外键时，同一值可以有多个引用。所以`32`在左边表格的`author_id`列出现了几次。

### 将信息分解成小块

你可能已经注意到，图 [12-3](#Fig3) 中右边的表格为每个作者的名和姓提供了单独的列。这是关系数据库的一个重要原则:*将复杂的* *信息分解成组成部分，并分别存储每个部分。*

决定这个过程要走多远并不总是容易的。除了名和姓之外，您可能需要单独的标题列(先生、夫人、女士、博士等)。)和中间名或首字母。地址最好分成街道、城镇、县、州、邮政编码等等。尽管将信息分解成小块可能很麻烦，但您总是可以使用 SQL 和/或 PHP 将它们再次连接在一起。然而，一旦您有了很多记录，尝试将存储在单个字段中的复杂信息分离出来是一项重大任务。

### 良好数据库设计的检查点

设计数据库没有正确的方法——每一个都是不同的。但是，以下指南应该为您指明正确的方向:

*   给表中的每条记录一个唯一的标识符(主键)。

*   将每组关联的数据放在自己的表中。

*   通过将一个表中的主键用作其他表中的外键来交叉引用相关信息。

*   在每个字段中只存储一项信息。

*   保持干燥(不要重复自己)。

在早期阶段，你很可能会犯一些设计上的错误，然后你会后悔。试着预测未来的需求，让你的桌子结构更灵活。您可以随时添加新的表来响应新的需求。

这是目前足够的理论。让我们从第 [5](05.html) 章和第 [6](06.html) 章开始，通过为 Japan Journey 网站建立一个数据库，来讨论一些更实际的东西。

## 使用图形界面

与 MySQL 数据库交互的传统方式是通过命令提示符窗口或终端。但是使用第三方图形界面要容易得多，比如 phpMyAdmin，MySQL 的基于浏览器的前端(见图 [12-4](#Fig4) )。

![../images/332054_5_En_12_Chapter/332054_5_En_12_Fig4_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Fig4_HTML.jpg)

图 12-4

phpMyAdmin 是一个免费的 MySQL 图形界面，可以在浏览器中运行

因为 phpMyAdmin ( [`www.phpmyadmin.net`](http://www.phpmyadmin.net) )是与 XAMPP、MAMP 和其他大多数免费的一体化软件包一起自动安装的，所以它是本书选择的 UI。它易于使用，并具有设置和管理 MySQL 数据库所需的所有基本功能。它可以在 Windows、macOS 和 Linux 上运行。许多主机公司将其作为 MySQL 的标准接口。

如果您经常使用数据库，您可能希望最终探索其他图形界面。值得一提的是 Navicat ( [`www.navicat.com/en/`](http://www.navicat.com/en/) )，这是一款可用于 Windows、macOS 和 Linux 的付费产品。Navicat 云服务还允许您从 iPhone 或 iPad 管理数据库。Navicat 在 web 开发人员中特别受欢迎，因为它能够执行从远程服务器到本地计算机的数据库定时备份。Navicat for MySQL 同时支持 MySQL 和 MariaDB。

### 正在启动 phpMyAdmin

如果您在 Windows 上运行 XAMPP，有三种方法可以启动 phpMyAdmin:

*   在浏览器地址栏输入`http://localhost/phpMyAdmin/`。

*   点击 XAMPP 控制面板中的 MySQL `Admin`按钮。

*   在 XAMPP 管理页面(`http://localhost/xampp/`)中点击`Tools`下的`phpMyAdmin`链接。

如果你在 macOS 上安装了 MAMP，点击 MAMP 起始页顶部菜单中的`Tools` ➤ `phpMyAdmin`(点击 MAMP 控件中的`WebStart`)。

如果您手动安装了 phpMyAdmin 或者使用了不同的 all-in-one 软件包，请遵循软件包的说明或者在浏览器地址栏中输入适当的地址(通常是`http://localhost/phpmyadmin/`)。

Tip

如果您收到一条消息，说服务器没有响应或套接字配置不正确，请确保 MySQL 服务器正在运行。

如果您安装了 XAMPP，您可能会看到一个要求输入用户名和密码的屏幕。如果是这样，请以超级用户的身份登录 phpMyAdmin。输入`root`作为用户名，并在设置 XAMPP 时使用您为 root 用户创建的密码。

Caution

当在远程服务器上访问 phpMyAdmin 时，总是使用安全连接(https)。任何窃听不安全连接的人都有可能控制您的宝贵数据，窃取、破坏甚至完全删除这些数据。

## 设置 phpsols 数据库

在本地测试环境中，可以在 MySQL 中创建的数据库数量没有限制，您可以随意命名它们。我将假设您在本地测试环境中工作，并向您展示如何建立一个名为`phpsols`的数据库，以及两个名为`psread`和`pswrite`的用户帐户。

Note

在共享主机上，你可能只限于一个由主机公司建立的数据库。如果你在远程服务器上进行测试，并且没有建立新数据库和用户账户的自由，那么用你的托管公司分配的名字和用户名分别代替`phpsols`和`pswrite`。

### MySQL 命名规则

数据库、表和列的基本 MySQL 命名规则如下:

*   名称最长可达 64 个字符。

*   合法字符包括数字、字母、下划线和美元。

*   名称可以以数字开头，但不能全部由数字组成。

一些托管公司似乎很幸运地忽略了这些规则，并给客户分配名称中包含一个或多个连字符(非法字符)的数据库。如果数据库、表或列名包含空格或非法字符，则在 SQL 查询中必须始终用反斜杠(```php)将其括起来。注意，这不是单引号(`'`)，而是一个单独的字符。在我的 Windows 键盘上，它就在 Tab 键的正上方。在我的 Mac 键盘上，它与波浪号(`~`)位于同一个键上的左 Shift 键旁边。

在选择名字的时候，你可能会不小心选择了 MySQL 众多保留字中的一个( [`https://dev.mysql.com/doc/refman/8.0/en/keywords.html`](https://dev.mysql.com/doc/refman/8.0/en/keywords.html) )，比如`date`或者`time`。避免这种情况的一个技巧是使用复合词，比如`arrival_date`、`arrival_time`等等。或者，用反斜杠将所有名称括起来。phpMyAdmin 自动完成这项工作，但是在 PHP 脚本中编写自己的 SQL 时，您需要手动完成这项工作。

Note

因为很多人使用`date`、`text`、`time`和`timestamp`作为列名，所以 MySQL 允许使用它们而不加反斜杠。但是，您应该避免使用它们。这是一种糟糕的做法，如果您将数据迁移到不同的数据库系统，这种做法也不太可能奏效。

#### 名称区分大小写

Windows 和 macOS 将 MySQL 名称视为不区分大小写。然而，Linux 和 Unix 服务器尊重区分大小写。为了避免将数据库和 PHP 代码从本地计算机传输到远程服务器时出现问题，我强烈建议您在数据库、表和列名中只使用小写。当用一个以上的单词组成名字时，用下划线将它们连接起来。

### 使用 phpMyAdmin 创建新的数据库

在 phpMyAdmin 中创建新数据库很容易。

Note

phpMyAdmin 有一个频繁的发布周期，这通常会导致用户界面的微小变化。偶尔，变化会更显著。这些说明和附带的截图是基于 phpMyAdmin 5.1.1 的。尽管您使用的版本可能会有所不同，但基本过程应该大致相同。

1.  启动 phpMyAdmin 并选择主窗口顶部的`Databases`选项卡。

2.  在`Create database`下的第一个字段中输入新数据库的名称(`phpsols`)。字段右侧的下拉菜单设置数据库的**排序规则**。归类决定了数据的排序顺序。如下图所示，我的安装的默认设置是`utf8mb4_general_ci`。这实际上支持每一种人类语言，除非您对自己的语言有特殊需求，否则应该是合适的。`ci`表示排序顺序不区分大小写。在 phpMyAdmin 的旧版本中，缺省值是`latin1_swedish_ci`。这反映了 MySQL 的瑞典血统。英语使用相同的排序顺序。然后点击`Create`:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figa_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figa_HTML.jpg)

1.  屏幕上应该会出现数据库已创建的确认信息，随后会出现一个屏幕，邀请您创建一个表:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figb_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figb_HTML.jpg)

1.  在新数据库中创建表之前，最好为它创建用户帐户。让 phpMyAdmin 保持打开，因为您将在下一节中继续使用它。

### 创建特定于数据库的用户帐户

新安装的 MySQL 通常只有一个注册用户——名为“root”的超级用户帐户，它拥有对一切的完全控制权。(XAMPP 还创建了一个名为“pma”的用户帐户，phpMyAdmin 用它来实现本书没有涉及的高级功能。)root 用户应该*永远不要*用于除顶级管理之外的任何事情，例如创建和删除数据库、创建用户帐户以及导出和导入数据。每个单独的数据库应该至少有一个(最好是两个)具有有限权限的专用用户帐户。

当您将一个数据库联机时，您应该授予用户他们需要的最少的特权，而不是更多。有四种重要的特权，都是以等效的 SQL 命令命名的:

*   `SELECT`:从数据库表中检索记录

*   `INSERT`:将记录插入数据库

*   `UPDATE`:修改现有记录

*   `DELETE`:删除记录，但不删除表格或数据库(命令为`DROP`)

大多数情况下，访问者只需要检索信息，因此`psread`用户帐户只有`SELECT`权限，并且是只读的。但是，对于用户注册或站点管理，您需要所有四种权限。这些将提供给`pswrite`账户。

#### 授予用户权限

1.  在 phpMyAdmin 中，通过单击屏幕左上角的小房子图标返回到主屏幕。然后单击`User accounts`选项卡(在 phpMyAdmin 的旧版本中，它被称为`Users`):

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figc_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figc_HTML.jpg)

1.  在`User accounts overview`页面上，点击页面中间的`Add user account`链接。

2.  在打开的页面上，在`User name`字段中输入`pswrite`(或者您想要创建的用户帐户的名称)。从`Host name`下拉菜单中选择`Local`。这将自动在旁边的字段中输入`localhost`。选择此选项允许`pswrite`用户仅从同一台计算机连接到 MySQL。然后在`Password`字段输入密码，并在`Re-type`字段再次输入确认密码。

    Note

    在本书的示例文件中，我使用了`0Ch@Nom1$u`作为密码。MySQL 密码区分大小写。

3.  在`Login Information`桌子下面是标有`Database for user account`和`Global privileges`的区域。两个都不理。向下滚动到页面底部并点击`Go`按钮。

4.  这将向您确认用户已经创建，并提供编辑用户权限的选项。点击`Edit privileges`上方的`Database`按钮:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figd_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figd_HTML.jpg)

1.  在`Database-specific privileges`下，从列表中选择`phpsols`(如有必要，激活标有`Add privileges on the following database(s))`的下拉菜单并点击`Go`:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Fige_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Fige_HTML.jpg)

Note

MySQL 有三个默认数据库:`information_schema`，一个只读的虚拟数据库，包含同一服务器上所有其他数据库的详细信息；`mysql`，包含所有用户账号和权限的详细信息；还有`test`，那是空的。除非你确定自己在做什么，否则永远不要直接编辑`mysql`数据库。

1.  下一个屏幕允许您设置这个用户在`phpsols`数据库上的权限。您希望`pswrite`拥有前面列出的所有四个特权，所以单击`SELECT, INSERT, UPDATE`和`DELETE`旁边的复选框。

如果将鼠标指针悬停在每个选项上，phpMyAdmin 会显示一个工具提示，描述该选项的用法，如图所示。选择四种权限后，点击`Go`:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figf_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figf_HTML.jpg)

Caution

phpMyAdmin 中的许多屏幕都有不止一个`Go`按钮。始终单击要设置选项的部分底部或旁边的按钮。

1.  phpMyAdmin 向您确认用户帐户`pswrite`的权限已经更新；该页面再次显示`Database-specific privileges`表，以防您需要更改任何内容。点击页面顶部的`User accounts`选项卡，返回`User accounts overview`。

2.  点击`Add user account`并重复第 3 步到第 8 步，创建名为`psread`的第二个用户帐户。这个用户将有更多受限的特权，所以当你到第 7 步时，只选择`SELECT`选项。示例文件中用于`psread`的密码是`K1yoMizu^dera`。

### 创建数据库表

现在您已经有了一个数据库和专用的用户帐户，可以开始创建表了。让我们首先创建一个保存图像细节的表格，如本章开头的图 [12-1](#Fig1) 所示。在开始输入数据之前，需要定义表结构。这包括决定以下事项:

*   表的名称

*   它将有多少列

*   每列的名称

*   每列将存储什么类型的数据

*   列是否必须在每个字段中都有数据

*   哪一列包含表的主键

如果你查看图 [12-1](#Fig1) ，你可以看到该表包含三列:`image_id`(主键)、`filename`和`caption`。因为它包含图像的细节，所以这是一个很好的表名。存储没有标题的文件名没有多大意义，所以每一列都必须包含数据。太好了。除了数据类型，所有的决定都已经做出。我将一边进行一边解释数据类型。

#### 定义图像表

这些说明展示了如何在 phpMyAdmin 中定义一个表。如果您喜欢使用 Navicat 或不同的 MySQL 用户界面，请使用表 [12-1](#Tab1) 中的设置。

表 12-1

图像表的设置

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"> <col class="tcol4 align-left"> <col class="tcol5 align-left"> <col class="tcol6 align-left"> <col class="tcol7 align-left"></colgroup> 
| 

田

 | 

类型

 | 

长度/值

 | 

属性

 | 

空

 | 

索引

 | 

A_I

 |
| --- | --- | --- | --- | --- | --- | --- |
| `image_id` | `INT` |   | `UNSIGNED` | 取消选择 | `PRIMARY` | 挑选 |
| `filename` | `VARCHAR` | `25` |   | 取消选择 |   |   |
| `caption` | `VARCHAR` | `120` |   | 取消选择 |   |   |

1.  启动 phpMyAdmin(如果它还没有打开),并从屏幕左侧的数据库列表中选择`phpsols`。这将打开`Structure`选项卡，报告在数据库中没有找到表。

2.  在`Create table`部分中，在`Name`字段中键入新表的名称(`images`，并在`Number of columns`字段中输入`3`。然后点击`Go`按钮。

3.  下一个屏幕是您定义表的地方。选项很多，但并不是都需要填写。表 [12-1](#Tab1) 列出了`images`表的设置。

第一列`image_id`，定义为类型`INT`，代表整数。它的属性被设置为`UNSIGNED`，这意味着只允许正数。当您从 Index 下拉菜单中选择`PRIMARY`时，phpMyAdmin 会打开一个模式面板，您可以在其中指定高级选项。接受默认设置，然后单击“Go”关闭面板。然后，选择`A_I` ( `AUTO_INCREMENT`)复选框。这告诉 MySQL 每当插入新记录时，在该列中插入下一个可用的数字(从 1 开始)。

下一列`filename`，被定义为类型`VARCHAR`，长度为`25`。这意味着它最多接受 25 个字符的文本。

最后一列`caption`也是`VARCHAR`，长度为`120`，因此它最多接受 120 个字符的文本。

取消选择所有列的`Null`复选框，因此它们必须总是包含一些内容。然而，这个“东西”可以小到一个空字符串。我将在本章后面的“在 MySQL 中选择正确的数据类型”一节中更详细地描述列类型。

下面的截图显示了在 phpMyAdmin 中设置后的选项(因为不需要填写，所以省略了`A_I`右边的列):

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figg_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figg_HTML.jpg)

屏幕下方是`Storage Engine`的一个选项。这决定了内部用来存储数据库文件的格式。从 MySQL 5.5 开始，InnoDB 就是默认的了。在此之前，MyISAM 是默认值。我将在第 17 章中解释这些存储引擎之间的区别。同时，使用 InnoDB。从一个存储引擎转换到另一个非常简单。

完成后，点击屏幕底部的`Save`按钮。

Tip

如果你点击`Go`而不是`Save`，phpMyAdmin 会增加一个额外的列供你定义。如果发生这种情况，只需点击`Save`。只要不在字段中输入值，phpMyAdmin 就会忽略多余的列。

1.  下一个屏幕显示您刚刚创建的表的详细信息(如果您没有看到这个屏幕，请单击`Structure`选项卡):

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figh_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figh_HTML.jpg)

`image_id`右边的金色键表示它是表的主键。要编辑任何设置，请单击相应行中的`Change`。这将打开上一个屏幕，并允许您更改数值。

Tip

如果你弄得一团糟，想重新开始，点击屏幕顶部的`Operations`标签。然后，在`Delete data or table`部分，点击`Delete the table (DROP)`并确认您想要删除该表。(在 SQL 中，*删除*仅指记录。你*删除*一个列、表格或数据库。)

### 将记录插入表中

现在您有了一个表，您需要将一些数据放入其中。最终，您将需要使用 HTML 表单、PHP 和 SQL 构建自己的内容管理系统，但是快速简单的方法是使用 phpMyAdmin。

#### 使用 phpMyAdmin 手动插入记录

这些指令展示了如何通过 phpMyAdmin 接口向`images`表添加记录。

1.  如果 phpMyAdmin 仍然显示上一节末尾的`images`表的结构，请跳到第 2 步。否则，启动 phpMyAdmin 并从左边的列表中选择`phpsols`数据库。然后点击`images`右侧的`Structure`，如下截图所示:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figi_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figi_HTML.jpg)

Tip

主框架顶部的面包屑轨迹为页面顶部的选项卡提供了上下文。前面截图左上角的`Structure`选项卡指的是`phpsols`数据库的结构。要访问单个表格的结构，请单击表格名称旁边的`Structure`链接。

1.  点击页面顶部中间的`Insert`选项卡。这将显示以下屏幕，您可以插入最多两条记录:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figj_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figj_HTML.jpg)

1.  这些表单显示每列的名称和详细信息。您可以忽略`Function`字段。MySQL 有大量的函数，您可以将这些函数应用于存储在表中的值。在接下来的章节中，你会学到更多。`Value`字段是您输入想要插入表格的数据的地方。

    因为您已经将`image_id`定义为`AUTO_INCREMENT`，所以 MySQL 会自动插入下一个可用的数字。所以你*必须*将`image_id Value`字段留空。如下填写接下来的两个`Value`字段:

    *   `filename` : `basin.jpg`

    *   `caption` : `Water basin at Ryoanji temple, Kyoto`

2.  在第二个表单中，将`image_id`的`Value`字段留空，并像这样填写接下来的两个字段:

    *   `filename` : `fountains.jpg`

    *   `caption` : `Fountains in central Tokyo`

通常情况下，当您向第二个表单添加值时，`Ignore`复选框会被自动取消选中，但如果需要，也可以取消选中。

1.  点击第二个表单底部的`Go`按钮。用于插入记录的 SQL 显示在页面顶部。我将在剩余的章节中解释基本的 SQL 命令，但是研究 phpMyAdmin 显示的 SQL 是学习如何构建自己的查询的好方法。SQL 与人类语言紧密相关，因此学习起来并不困难。

2.  点击页面左上角的`Browse`标签。您现在应该会看到`images`表中的前两个条目，如下所示:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figk_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figk_HTML.jpg)

如您所见，MySQL 在`image_id`字段中插入了`1`和`2`。

您可以继续输入其余六幅图像的细节，但是让我们使用一个包含所有必要数据的 SQL 文件来加快速度。

#### 从 SQL 文件加载图像记录

因为`images`表的主键已经被设置为`AUTO_INCREMENT`，所以需要删除该表及其所有数据。SQL 文件自动完成这项工作，并从头开始构建表。这些指令假设 phpMyAdmin 已经打开了上一节第 6 步中的页面。

1.  如果您愿意覆盖`images`表中的数据，请跳到第 2 步。但是，如果您输入了不想丢失的数据，请将数据复制到不同的表中。单击页面顶部的`Operations`选项卡(根据屏幕的大小，操作可能隐藏在选项卡行最右侧的`More`中)，在标题为`Copy table to (database.table)`的部分的空白字段中键入新表的名称，然后单击`Go`。以下截图显示了将`images`表的结构和数据复制到`phpsols`数据库中的`images_backup`的设置:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figl_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figl_HTML.jpg)

点击`Go`后，您应该会看到表格已被复制的确认。页面顶部的面包屑痕迹表明 phpMyAdmin 仍然在`images`表中，因此您可以继续执行步骤 2，即使您在屏幕上有一个不同的页面。

1.  点击页面顶部的`Import`选项卡。在下一个屏幕上，点击`File to import`中的`Browse`(或`Choose File`)按钮，然后导航到`ch12`文件夹中的`images.sql`。保留所有选项的默认设置，并点击页面底部的`Go`:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figm_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figm_HTML.jpg)

1.  phpMyAdmin 删除原始表，创建一个新版本，并插入所有记录。当您看到文件已导入的确认信息时，单击页面左上角的`Browse`按钮。你现在应该会看到与本章开头的图 [12-1](#Fig1) 所示相同的数据。

如果您在文本编辑器中打开`images.sql`，您会看到它包含创建`images`表并用数据填充它的 SQL 命令。该表是这样构建的:

```
DROP TABLE IF EXISTS `images`;
CREATE TABLE `images` (
  `image_id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `filename` varchar(25) NOT NULL,
  `caption` varchar(120) NOT NULL,
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

```php

主键是在单独的 SQL 命令中设置的。像这样从 SQL 文件中导入数据就是将数据从本地测试环境传输到网站所在的远程服务器的方法。假设您的托管公司为您提供 phpMyAdmin 来管理您的远程数据库，您需要做的就是在您的远程服务器上启动 phpMyAdmin 版本，单击`Import`选项卡，在您的本地计算机上选择 SQL 文件，然后单击`Go`。

下一节将描述如何创建 SQL 文件。

### 创建用于备份和数据传输的 SQL 文件

MySQL 不把你的数据库存储在一个文件中，你可以简单地把它上传到你的网站上。即使你找到了正确的文件，除非关闭 MySQL 服务器，否则你很可能会损坏它们。无论如何，大多数托管公司不会允许你上传原始文件，因为这也涉及到关闭他们的服务器，给每个人都带来了很大的不便。

然而，将数据库从一个服务器移动到另一个服务器是很容易的。它只需要创建数据的备份**转储**，并使用 phpMyAdmin 或任何其他数据库管理程序将它加载到另一个数据库中。转储是一个文本文件，包含填充单个表甚至整个数据库所需的所有 SQL 命令。phpMyAdmin 可以创建整个 MySQL 服务器、单个数据库、选定的表或单个表的备份。

Tip

在准备好将数据传输到另一台服务器或创建备份之前，您不需要阅读如何创建转储文件的详细信息。

为了简单起见，这些说明显示了如何只备份一个数据库。

1.  在 phpMyAdmin 中，从左边的列表中选择`phpsols`数据库。如果已经选择了数据库，单击屏幕顶部的`Database: phpsols`面包屑，如下所示:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Fign_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Fign_HTML.jpg)

1.  从屏幕顶部的选项卡中选择`Export`。

2.  有两种导出方法:快速和自定义。快速方法对于导出文件的格式只有一个选项。缺省值是 SQL，所以你所要做的就是点击`Go`，phpMyAdmin 创建 SQL 转储文件并保存到你的浏览器的缺省文件夹`Downloads`。该文件与数据库同名，因此对于`phpsols`数据库，它被称为`phpsols.sql`。

3.  Quick 方法适用于导出少量数据，但是您通常需要对导出选项进行更多的控制；选择`Custom`单选按钮。选项很多，我们一节一节来看。

4.  `Format`部分默认为 SQL，但提供了一系列其他格式，包括 CSV、JSON 和 XML。

5.  `Table(s)`部分列出了数据库中的所有表格。默认情况下，所有选项都被选中，但您可以通过取消选中不需要的选项的复选框来选择要导出的选项。在下面的截图中，只选择了`images`表结构和数据，所以`images_backup`不会被导出:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figo_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figo_HTML.jpg)

Tip

备份单个表而不是整个数据库通常是一个好主意，因为大多数 PHP 服务器被配置为将上传限制在 2 MB。如下一步所述，压缩转储文件也有助于避开大小限制。

1.  `Output`部分有几个有用的选项。

选择标记为`Rename exported databases/tables/columns`的复选框启动一个模态面板，您可以在其中指定新名称。

`Use LOCK TABLES statement`复选框添加命令，防止任何人在使用转储文件导入数据和/或结构时插入、更新或删除记录。

还有一些单选按钮，您可以选择将 SQL 转储保存到文件中(这是默认设置)，或者以文本形式查看输出。如果您想在创建文件之前检查正在生成的 SQL，以文本形式查看会很有用:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figp_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figp_HTML.jpg)

文件名模板包含一个位于`@`标记之间的值。这将从服务器、数据库或表中自动生成文件名。一个非常酷的特性是你可以使用 PHP 的`strftime()`格式化字符(参见 [`www.php.net/manual/en/function.strftime.php`](http://www.php.net/manual/en/function.strftime.php) )来增强模板。例如，您可以将当前日期自动添加到文件扩展名之前，如下所示:

```
@DATABASE@_%Y-%m-%d

```

`Character set of the file`的默认值是 utf-8。只有当您的数据以特定的区域格式存储时，才需要更改这一点。

默认情况下，转储文件是不压缩的，但是下拉菜单提供了使用 zipped 或 gzipped 压缩的选项。这可以大大减小转储文件的大小，加快数据传输速度。当导入一个压缩文件时，phpMyAdmin 会自动检测压缩类型并将其解压缩。

最后一个选项允许您跳过大于指定 MB 数的文件。

1.  在`Format-specific options`中，选项由步骤 5 中选择的格式决定。对于 SQL，您可以选择在转储文件中显示注释，并将导出包含在事务中。使用事务的价值在于，如果错误导致导入被放弃，数据库将回滚到以前的状态。

其他选项包括禁用外键检查、将视图导出为表以及导出元数据。最后，您可以选择最大限度地兼容不同的数据库系统或旧版本的 MySQL。通常情况下，该值应设置为默认值:`NONE`。

1.  `Object creation options`部分允许您微调用于创建数据库和表的 SQL。以下屏幕截图显示了默认设置:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figq_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figq_HTML.jpg)

创建备份时，选择`Add DROP TABLE / VIEW / PROCEDURE / FUNCTION / EVENT / TRIGGER`语句复选框通常是个好主意，因为备份通常用于替换已损坏的现有数据。

默认情况下选中的最后一个复选框将表名和列名用反引号(反勾号)括起来，以避免包含无效字符或使用保留字的名称出现问题。我建议总是选择这个。

1.  `Data creation options`部分控制如何将数据插入表格。在大多数情况下，默认设置就可以了。但是，您可能有兴趣更改前四个，如下图所示:

![../images/332054_5_En_12_Chapter/332054_5_En_12_Figr_HTML.jpg](../images/332054_5_En_12_Chapter/332054_5_En_12_Figr_HTML.jpg)

第一个复选框允许您在插入数据之前截断表。如果您想要替换现有数据(可能是已损坏的数据),这将非常有用。

另外两个复选框影响如何执行`INSERT`命令。`INSERT DELAYED`不支持默认的 InnoDB 表。此外，从 MySQL 5.6.6 开始，它已被弃用，所以最好避免使用它。

`INSERT IGNORE`跳过错误，例如重复的主键。我个人觉得最好是有错误提示，所以不建议使用。

标有`Function to use when dumping data`的下拉菜单让你选择`INSERT, UPDATE`或`REPLACE`。默认是用`INSERT`插入新记录。如果选择`UPDATE`，仅更新现有记录。`REPLACE`必要时进行更新，如果记录不存在，则插入新记录。

1.  完成所有选择后，点击页面底部的`Go`。现在您有了一个备份，可以用来将数据库的内容传输到另一台服务器上。

Tip

默认情况下，phpMyAdmin 创建的文件只包含创建和填充数据库表的 SQL 命令。它不包括创建数据库的命令，除非您选择自定义选项来创建数据库。这意味着您可以将表导入到任何数据库中。它不需要与本地测试环境中的名称相同。

## 在 MySQL 中选择正确的数据类型

当选择`image_id`列的`Type`时，您可能会感到有点震惊。phpMyAdmin 列出了所有可用的数据类型——在 MySQL 8 和 MariaDB 10 中有 40 多种。为了不让你被不必要的细节所迷惑，我将只解释那些最常用的。

您可以在位于 [`https://dev.mysql.com/doc/refman/8.0/en/data-types.html`](https://dev.mysql.com/doc/refman/8.0/en/data-types.html) 的 MySQL 文档中找到所有数据类型的完整细节。

### 存储文本

主要文本数据类型之间的差异归结为单个字段中可以存储的最大字符数、尾随空格的处理以及是否可以设置默认值。

*   `CHAR`:定长字符串。您必须在`Length/Values`字段中指定所需的长度。最大允许值为 255。在内部，字符串用空格向右填充到指定的长度，但是当您检索值时，尾部空格被删除。您可以定义默认值。

*   `VARCHAR`:变长字符串。您必须指定计划使用的最大字符数(在 phpMyAdmin 中，在`Length/Values`字段中输入数字)。最大字符数为 65，535。如果字符串存储时带有尾随空格，则在检索时会保留这些空格。接受默认值。

*   `TEXT`:存储最多 65，535 个字符的文本(比本章大约长 50%)。无法定义默认值。

`TEXT`之所以方便，是因为你不需要指定一个最大尺寸(事实上你也不能)。虽然`VARCHAR`和`TEXT`的最大大小是 65，535 个字符，但有效数量更少，因为一行中所有列可以存储的最大数量是 65，535 个字节。

Tip

保持简单:使用`VARCHAR`处理短文本项目，使用`TEXT`处理长文本项目。`VARCHAR`和`TEXT`列只占用存储输入值所需的磁盘空间。`CHAR`列总是分配声明为所需长度的全部空间，即使是空的。

### 存储数字

最常用的数字列类型如下:

*   `INT`:介于 2147483648 和 2147483647 之间的任意整数(整数)。如果列声明为`UNSIGNED`，则范围是从 0 到 4，294，967，295。

*   `FLOAT`:浮点数。您可以选择指定两个逗号分隔的数字来限制范围。第一个数字指定最大位数，第二个数字指定小数点后应该有多少位数。由于 PHP 会在计算后格式化数字，我建议您使用不带可选参数的`FLOAT`。

*   `DECIMAL`:带分数的数；小数点后包含固定位数。定义表格时，您需要指定最大位数以及小数点后应该有多少位数。在 phpMyAdmin 中，在`Length/Values`字段中输入用逗号分隔的数字。例如，6，2 允许范围从 9999.99 到 9999.99 的数字。如果不指定大小，当值存储在这种类型的列中时，小数部分将被截断。

`FLOAT`和`DECIMAL`的区别在于精度。浮点数被视为近似值，可能会出现舍入误差(详细解释请参见 [`https://dev.mysql.com/doc/refman/8.0/en/problems-with-float.html`](https://dev.mysql.com/doc/refman/8.0/en/problems-with-float.html) )。

使用`DECIMAL`存储货币。

Caution

不要使用逗号或空格作为千位分隔符。除了数字，数字中唯一允许的字符是负运算符(–)和小数点(。).

### 存储日期和时间

MySQL 只以一种格式存储日期:`YYYY-MM-DD`。这是 ISO(国际标准化组织)批准的标准，避免了不同国家惯例中固有的模糊性。我将在第 16 章回到日期的话题。最重要的日期和时间列类型如下:

*   `DATE`:存储为`YYYY-MM-DD`的日期。范围是 1000-01-01 到 9999-12-31。

*   `DATETIME`:以`YYYY-MM-DD HH:MM:SS`格式显示的组合日期和时间。

*   `TIMESTAMP`:时间戳(通常由计算机自动生成)。合法值的范围从 1970 年初到 2038 年 1 月。

Caution

MySQL 时间戳使用与`DATETIME`相同的格式，这意味着它们与 Unix 和 PHP 时间戳不兼容，后者基于自 1970 年 1 月 1 日以来的秒数。不要混淆它们。

### 存储预定义列表

MySQL 允许您存储两种类型的预定义列表，它们可以被视为单选按钮和复选框状态的数据库等价物:

*   `ENUM`:该列类型存储预定义列表中的一个选项，例如“是，否，不知道”或“100–110V，220–240V”。预定义列表中可以存储的最大项目数是令人难以置信的 65，535，这是一个单选按钮组！

*   `SET`:该列类型存储预定义列表中的零个或多个选项。该列表最多可包含 64 个选项。

虽然`ENUM`非常有用，但是`SET`往往不那么有用，主要是因为它违反了每个字段只存储一条信息的原则。它可能有用的情况类型是当记录汽车上的可选附加物或调查中的多项选择时。

### 存储二进制数据

存储二进制数据，如图像，不是一个好主意。它会使你的数据库膨胀，而且你不能直接从数据库中显示图像。但是，下列列类型是为二进制数据设计的:

*   `TINYBLOB`:最多 255 字节

*   `BLOB`:最大 64 KB

*   `MEDIUMBLOB`:高达 16 MB

*   `LONGBLOB`:最高 4 GB

有了这些异想天开的名字，发现`BLOB`代表**二进制大物体**有点令人失望。

## 第三章回顾

这一章的大部分内容都致力于理论，解释良好的数据库设计的基本原则。您需要仔细规划数据库的结构，将重复的信息移动到单独的表中，而不是像电子表格一样将所有想要存储的信息都放在一个大表中。只要给表中的每条记录一个唯一的标识符(即它的主键)，就可以跟踪信息，并通过使用外键将其链接到其他表中的相关记录。使用外键的概念在一开始可能很难理解，但在本书结束时应该会变得更加清晰。

您还学习了如何创建具有有限权限的 MySQL 用户帐户，以及如何定义表和使用 SQL 文件导入和导出数据。在下一章中，您将使用 PHP 连接到`phpsols`数据库，以显示存储在`images`表中的数据。